"use strict";(self["webpackChunkstorage"]=self["webpackChunkstorage"]||[]).push([[8],{8731:function(e,t,s){s.d(t,{Z:function(){return b}});var l=s(3396),i=s(7139),o=s(9242);const a=e=>((0,l.dD)("data-v-1986e9d2"),e=e(),(0,l.Cn)(),e),n={class:"v-select"},c=a((()=>(0,l._)("div",null,null,-1))),d=[c],r=["onClick"],_={key:0,class:"material-icons-outlined opacity-50"};function u(e,t,s,a,c,u){return(0,l.wg)(),(0,l.iD)("div",n,[a.showOptions?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"backdrop",onClick:t[0]||(t[0]=e=>a.close())})):(0,l.kq)("",!0),(0,l._)("div",{class:(0,i.C_)(["title",{title_checked:a.showOptions,disabled:s.disabled}]),onClick:t[1]||(t[1]=e=>a.toggleOptions())},[(0,l._)("p",null,(0,i.zw)(s.placeholder),1),s.disabled?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("button",{key:0,class:(0,i.C_)(["arrow",{rotate_arrow:a.showOptions}])},d,2))],2),(0,l.Wm)(o.uT,{name:"list"},{default:(0,l.w5)((()=>[a.showOptions?((0,l.wg)(),(0,l.iD)("div",{key:0,class:(0,i.C_)(["options",{"right-0":s.rightSideSticky}])},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.list,(e=>((0,l.wg)(),(0,l.iD)("p",{key:e.value,class:(0,i.C_)({optgroup:"optgroup"===e.value,selected:e.selected}),style:(0,i.j5)({backgroundColor:e.color}),onClick:t=>a.select(e)},[e.selected&&(e.color||s.withTick)?((0,l.wg)(),(0,l.iD)("span",_," check ")):(0,l.kq)("",!0),e.optgroup?((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Uk)("     "+(0,i.zw)(e.name),1)],64)):((0,l.wg)(),(0,l.iD)(l.HY,{key:2},[(0,l.Uk)((0,i.zw)(e.name),1)],64))],14,r)))),128))],2)):(0,l.kq)("",!0)])),_:1})])}var p=s(6413);const h={props:{list:{type:Array,default(){return[]},required:!0},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default(){return""}},rightSideSticky:{type:Boolean,required:!1,default(){return!1}},withTick:{type:Boolean,required:!1,default(){return!1}}},emits:{select:null},setup(e,t){const[s,l]=(0,p.OT)(),i=()=>{s.value=!1},o=()=>{e.disabled||l()},a=e=>{"optgroup"!=e.value&&t.emit("select",e)};return{toggleOptions:o,showOptions:s,select:a,close:i}}},m=()=>{(0,o.sj)((e=>({"35e1d753":e.animationTime})))},f=h.setup;h.setup=f?(e,t)=>(m(),f(e,t)):m;var v=h,g=s(89);const w=(0,g.Z)(v,[["render",u],["__scopeId","data-v-1986e9d2"]]);var b=w},1624:function(e,t,s){s.d(t,{Z:function(){return ke}});var l=s(3396),i=s(9242),o=s(7139);const a=e=>((0,l.dD)("data-v-6ed1b88e"),e=e(),(0,l.Cn)(),e),n={class:"menu"},c={class:"ref ref_center"},d=a((()=>(0,l._)("span",{class:"material-icons"}," splitscreen ",-1))),r=[d],_={class:"tasks"},u={class:"ref ref_center"},p={key:0,class:"material-icons-round"},h={key:1,class:"material-icons-outlined"},m={class:"import_file"},f=a((()=>(0,l._)("label",{for:"xlsx"},"Загрузить файл",-1))),v={key:0,class:"ref"},g={key:0,class:"material-icons"},w={key:1,class:"material-icons-outlined"},b={class:"modal_settings modal_sync"},y={key:0},k={class:"ref"},C=a((()=>(0,l._)("span",{class:"material-icons"}," settings ",-1))),S=[C],D={key:0},x={key:1},T={key:2},F={key:3},U={key:4},V={key:5},q={key:1,class:"ref"},L=a((()=>(0,l._)("span",{class:"material-icons-outlined text-2xl"}," account_circle ",-1))),I=[L];function Z(e,t,s,a,d,C){const L=(0,l.up)("TaskCenter"),Z=(0,l.up)("HomeMenuUser");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l._)("div",c,[(0,l._)("button",{class:"ref_2_logo btn",onClick:t[0]||(t[0]=e=>a.openTaskCenter()),title:"Список задач"},r),(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[(0,l._)("div",_,[a.showTaskCenter?((0,l.wg)(),(0,l.j4)(L,{key:0,onClose:t[1]||(t[1]=e=>a.closeTaskCenter())})):(0,l.kq)("",!0)])])),_:1})]),(0,l._)("div",u,[(0,l._)("button",{class:"ref_2_logo btn",onClick:t[2]||(t[2]=e=>a.openImportXlsl()),title:"Настройки импорта"},[(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[a.showImportXlsx?((0,l.wg)(),(0,l.iD)("span",p," sim_card_download ")):((0,l.wg)(),(0,l.iD)("span",h," sim_card_download "))])),_:1})]),a.showImportXlsx?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",{class:"backdrop",onClick:t[3]||(t[3]=e=>a.closeImportXlsl())}),(0,l._)("div",m,[f,(0,l._)("input",{type:"file",accept:".xlsx",id:"xlsx",onChange:t[4]||(t[4]=e=>a.getFile(e))},null,32)])],64)):(0,l.kq)("",!0)]),a.isColored?((0,l.wg)(),(0,l.iD)("div",v,[(0,l._)("button",{class:"ref_2_logo btn",onClick:t[5]||(t[5]=e=>a.open_close_sync()),title:"Синхронизация товаров"},[(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[a.show_sync?((0,l.wg)(),(0,l.iD)("span",g," cloud_sync ")):((0,l.wg)(),(0,l.iD)("span",w," cloud_sync "))])),_:1})]),a.show_sync?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",{class:"backdrop",onClick:t[6]||(t[6]=e=>a.open_close_sync())}),(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[(0,l._)("div",b,[(0,l._)("a",{class:(0,o.C_)({disable:a.is_empty_amo_product_list})},[(0,l._)("div",{class:"modal_container",onClick:t[7]||(t[7]=e=>a.is_empty_amo_product_list?null:(a.syncAmoGs(),a.open_close_sync()))}," Синхронизировать товары amoCRM -> GoСклад ")],2),(0,l._)("a",{class:(0,o.C_)({disable:a.is_empty_amo_product_list})},[(0,l._)("div",{class:"modal_container",onClick:t[8]||(t[8]=e=>a.is_empty_amo_product_list?null:(a.syncGsAmo(),a.open_close_sync()))}," Синхронизировать товары GoСклад -> amoCRM ")],2),a.oneC?((0,l.wg)(),(0,l.iD)("a",y,[(0,l._)("div",{class:"modal_container",onClick:t[9]||(t[9]=e=>(a.sync1C(),a.open_close_sync()))}," Синхронизировать остатки с 1C ")])):(0,l.kq)("",!0)])])),_:1})],64)):(0,l.kq)("",!0)])):(0,l.kq)("",!0),(0,l._)("div",k,[(0,l._)("button",{class:(0,o.C_)(["settings_btn",{settings_btn_rotate:a.show_settings}]),onClick:t[10]||(t[10]=e=>a.open_close_settings()),title:"Настройки"},S,2),a.show_settings?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",{class:"backdrop",onClick:t[11]||(t[11]=e=>a.close_settings())}),(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[(0,l._)("div",{class:"modal_settings",onClick:t[22]||(t[22]=e=>a.close_settings())},[(0,l._)("a",null,[(0,l._)("div",{class:"modal_container",onClick:t[12]||(t[12]=e=>a.open_edit_stuff())}," Общие настройки ")]),(0,l._)("a",null,[(0,l._)("div",{class:"modal_container",onClick:t[13]||(t[13]=e=>a.open_product_category())}," Категории товаров ")]),a.isTest?((0,l.wg)(),(0,l.iD)("a",D,[(0,l._)("div",{class:"modal_container",onClick:t[14]||(t[14]=e=>a.openSettingEntities())}," Настройка сущностей ")])):(0,l.kq)("",!0),(0,l._)("a",null,[(0,l._)("div",{class:"modal_container",onClick:t[15]||(t[15]=e=>a.open_product_properties())}," Свойства товаров ")]),!a.oneC&&a.isColored?((0,l.wg)(),(0,l.iD)("a",x,[(0,l._)("div",{class:"modal_container",onClick:t[16]||(t[16]=e=>a.openSyncSettings())}," Настройки синхронизации товаров ")])):(0,l.kq)("",!0),(0,l._)("a",null,[(0,l._)("div",{class:"modal_container",onClick:t[17]||(t[17]=e=>a.open_close_document_setting(!0))}," Документы ")]),a.isColored?((0,l.wg)(),(0,l.iD)("a",T,[(0,l._)("div",{class:"modal_container",onClick:t[18]||(t[18]=e=>a.openThirdPpartyIntegrations())}," Интеграции ")])):(0,l.kq)("",!0),a.isTest?((0,l.wg)(),(0,l.iD)("a",F,[(0,l._)("div",{class:"modal_container",onClick:t[19]||(t[19]=e=>a.openAccountSattings())}," Настройки аккаунта ")])):(0,l.kq)("",!0),a.isTest?((0,l.wg)(),(0,l.iD)("a",U,[(0,l._)("div",{class:"modal_container",onClick:t[20]||(t[20]=e=>a.openClientsFieldsSettings())}," Настройки полей клиентов ")])):(0,l.kq)("",!0),a.isTest?((0,l.wg)(),(0,l.iD)("a",V,[(0,l._)("div",{class:"modal_container",onClick:t[21]||(t[21]=e=>a.openArchive())},"Архив")])):(0,l.kq)("",!0)])])),_:1})],64)):(0,l.kq)("",!0)]),a.isTest||a.amoTest?((0,l.wg)(),(0,l.iD)("div",q,[(0,l._)("button",{class:"ref_2_logo btn hover:scale-110",onClick:t[23]||(t[23]=e=>a.toggleShowUserMenu()),title:"Настройки юзера"},I),a.showUserMenu?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",{class:"backdrop",onClick:t[24]||(t[24]=e=>a.toggleShowUserMenu())}),(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[(0,l.Wm)(Z)])),_:1})],64)):(0,l.kq)("",!0)])):(0,l.kq)("",!0)])}const W=e=>((0,l.dD)("data-v-95ef3cfa"),e=e(),(0,l.Cn)(),e),O={class:"container"},P={key:1,class:"text"},N=W((()=>(0,l._)("h4",null,"Нет задач в процессе",-1))),E=[N];function H(e,t,s,i,o,a){const n=(0,l.up)("TaskCard");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",{class:"backdrop",onClick:t[0]||(t[0]=e=>a.close())}),(0,l._)("div",O,[a.isTasksInProgress?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(a.tasks,(e=>((0,l.wg)(),(0,l.j4)(n,{task:e,key:e.id},null,8,["task"])))),128)):((0,l.wg)(),(0,l.iD)("div",P,E))])],64)}const $={class:"bar"},M={ref:"result",class:"result"};function A(e,t,s,i,a,n){return(0,l.wg)(),(0,l.iD)("div",{class:(0,o.C_)(["card",{done:2==s.task.status,in_progress:1==s.task.status,not_started:0==s.task.status,error:3==s.task.status}])},[(0,l._)("div",$,[(0,l._)("div",{class:"active_bar",style:(0,o.j5)({width:s.task.progress+"%"})},null,4)]),(0,l._)("p",null,(0,o.zw)(s.task.name),1),(0,l._)("div",M,null,512)],2)}var j={props:{task:Object},computed:{resultRef(){return this.$refs.result},result(){return this.task.result}},mounted(){this.result&&(this.resultRef.innerHTML=this.result)},watch:{result(){this.result&&(this.resultRef.innerHTML=this.result)}}},Y=s(89);const B=(0,Y.Z)(j,[["render",A],["__scopeId","data-v-3a38f9c8"]]);var z=B,K={components:{TaskCard:z},data(){return{interval:null}},mounted(){this.getTasks(),this.startTracking()},unmounted(){clearInterval(this.interval)},computed:{tasks(){return this.$store.state.tasks.tasks},isTasksInProgress(){let e=this.tasks.filter((e=>0==e.status||1==e.status)).length>0;return e}},methods:{close(){this.$emit("close")},getTasks(){this.$store.dispatch("getTasks")},startTracking(){this.interval=setInterval((()=>{this.getTasks(),this.isTasksInProgress||clearInterval(this.interval)}),2e3)}}};const R=(0,Y.Z)(K,[["render",H],["__scopeId","data-v-95ef3cfa"]]);var G=R;const J={class:"cont z-[999] flex flex-col items-stretch rounded-xl absolute top-[200%] right-0 min-w-[300px] overflow-hidden shadow-lg shadow-slate-500/10 bg-white origin-top"},X={class:"head bg-big-stone-100 w-full p-3 flex flex-row gap-3 items-center min-h-[72px]"},Q={key:0,src:"https://cdn1.iconfinder.com/data/icons/people-49/512/_formal_mustache_man-01-1024.png",ref:"img",class:"rounded-full w-12"},ee={key:1,class:"material-icons-outlined text-slate-600",style:{"font-size":"50px"}},te={class:"whitespace-nowrap font-bold text-xl text-slate-700"},se={class:"main"},le={class:"text-slate-600"},ie=(0,l._)("li",null,[(0,l._)("span",{class:"material-icons-outlined"}," settings "),(0,l._)("span",null,"Права доступа")],-1),oe=(0,l._)("span",{class:"material-icons-outlined"}," logout ",-1),ae=(0,l._)("span",null,"Выйти",-1),ne=[oe,ae];function ce(e,t,s,i,a,n){return(0,l.wg)(),(0,l.iD)("div",J,[(0,l._)("div",X,[i.isImgLoaded?((0,l.wg)(),(0,l.iD)("img",Q,null,512)):((0,l.wg)(),(0,l.iD)("span",ee," account_circle ")),(0,l._)("h1",te,(0,o.zw)(i.userName),1)]),(0,l._)("div",se,[(0,l._)("ul",le,[ie,i.inFrame?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("li",{key:0,onClick:t[0]||(t[0]=e=>i.logOut())},ne))])])])}var de=s(4870),re=s(9299),_e=s(2450);function ue(){const e=()=>{localStorage.removeItem(_e.O_),location.replace("/")};return{logOut:e}}var pe=s(1952),he={setup(){const{logOut:e}=ue(),t=(0,l.Fl)((()=>re.Z.state.account.user?.name)),s=(0,de.iH)(!0),i=(0,de.iH)(null);return(0,l.bv)((()=>{i.value.onerror=()=>s.value=!1})),{userName:t,img:i,isImgLoaded:s,logOut:e,inFrame:pe.V}}};const me=(0,Y.Z)(he,[["render",ce]]);var fe=me,ve=s(2524),ge=s(6413),we=s(1120),be={components:{TaskCenter:G,HomeMenuUser:fe},setup(){const{addNotification:e}=(0,ve.l)(),t=(0,l.Fl)((()=>re.Z.state.shows.showTaskCenter)),s=(0,l.Fl)((()=>re.Z.state.shows.show_sync)),i=(0,l.Fl)((()=>re.Z.state.shows.show_settings)),o=(0,l.Fl)((()=>re.Z.state.account.account?.config?.g_enabled)),a=(0,l.Fl)((()=>re.Z.state.account.account)),n=(0,l.Fl)((()=>re.Z.state.account.user?.name)),c=(0,l.Fl)((()=>1==re.Z.state.account?.account?.id)),d=(0,l.Fl)((()=>454==re.Z.state.account?.account?.id)),r=(0,l.Fl)((()=>!a.value?.config?.amo_product_list||"-1"==a.value?.config?.amo_product_list)),_=(0,l.Fl)((()=>re.Z.state.account.account.is_colored)),u=(0,de.iH)(!1),p=()=>u.value=!0,h=()=>u.value=!1,m=async t=>{const s=t.target.files[0],l=new FormData;l.append("file",s),l.append("name",s.name);const i=await re.Z.dispatch("importStuff",l);i.error?e(3,"Ошибка",i.error):re.Z.commit("openCloseImportStuff",!0),h()},f=()=>re.Z.commit("openCloseTaskCenter",!0),v=()=>re.Z.commit("openCloseTaskCenter",!1),g=()=>re.Z.commit("open_close_sync"),w=()=>{re.Z.dispatch("syncAmoGs"),e(0,"Добавлена задача","Синхронизировать товары amoCRM -> GoСклад")},b=()=>{re.Z.dispatch("syncGsAmo"),e(0,"Добавлена задача","Синхронизировать товары GoСклад -> amoCRM")},y=()=>{re.Z.dispatch("sync1C"),e(0,"Добавлена задача","Синхронизировать остатки с 1C")},k=()=>re.Z.commit("open_close_settings"),C=()=>re.Z.commit("close_settings"),S=()=>re.Z.commit("open_close_edit_stuff",!0),D=()=>re.Z.commit("open_close_product_category",!0),x=()=>re.Z.commit("openCloseThirdPpartyIntegrations",!0),T=()=>re.Z.commit("openCloseAccountSattings",!0),F=()=>re.Z.commit("openCloseClientsFieldsSettings",!0),U=()=>re.Z.commit("openCloseSyncSettings",!0),V=()=>re.Z.commit("open_close_product_properties",!0),q=e=>re.Z.commit("open_close_document_setting",e),L=()=>re.Z.commit("toggleSettingEntities",!0),I=()=>we.Z.push("/archive"),[Z,W]=(0,ge.OT)(!1);return{showTaskCenter:t,show_sync:s,oneC:o,is_empty_amo_product_list:r,isTest:c,show_settings:i,openTaskCenter:f,closeTaskCenter:v,open_close_sync:g,syncAmoGs:w,syncGsAmo:b,sync1C:y,open_close_settings:k,close_settings:C,open_edit_stuff:S,open_product_category:D,openThirdPpartyIntegrations:x,openAccountSattings:T,openClientsFieldsSettings:F,openSyncSettings:U,open_product_properties:V,open_close_document_setting:q,getFile:m,showImportXlsx:u,openImportXlsl:p,closeImportXlsl:h,isColored:_,openArchive:I,openSettingEntities:L,userName:n,showUserMenu:Z,toggleShowUserMenu:W,amoTest:d}}};const ye=(0,Y.Z)(be,[["render",Z],["__scopeId","data-v-6ed1b88e"]]);var ke=ye},2145:function(e,t,s){s.d(t,{Z:function(){return Vp}});var l=s(3396),i=s(9242);const o={key:0,class:"table_setings"},a={key:0,class:"edit_staff"},n={key:0,class:"product_category"},c={key:0,class:"thirdPpartyIntegrations"},d={key:0,class:"SyncSettings"},r={key:0,class:"import_stuff"},_={key:0,class:"product_properties"},u={key:0,class:"AccountSattings"},p={key:0,class:"new_position"},h={key:0,class:"cancel_position"},m={key:0,class:"move_products_between_whs"},f={key:0,class:"document_setting"},v={key:0,class:"ClientsFieldsSettings"},g={key:0,class:"SettingEntities"};function w(e,t,s,w,b,y){const k=(0,l.up)("table-settings"),C=(0,l.up)("edit-stuff"),S=(0,l.up)("product-category"),D=(0,l.up)("ThirdPpartyIntegrations"),x=(0,l.up)("SyncSettings"),T=(0,l.up)("ImportStuff"),F=(0,l.up)("product-properties"),U=(0,l.up)("AccountSattings"),V=(0,l.up)("new-position"),q=(0,l.up)("cancel-position"),L=(0,l.up)("MoveProductsBetweenWhs"),I=(0,l.up)("document-setting"),Z=(0,l.up)("ClientsFieldsSettings"),W=(0,l.up)("SettingEntities");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_table_settings?((0,l.wg)(),(0,l.iD)("div",o,[(0,l.Wm)(k,{selectedWH:s.selectedWH},null,8,["selectedWH"])])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_edit_stuff?((0,l.wg)(),(0,l.iD)("div",a,[(0,l.Wm)(C)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_product_category?((0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(S)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showThirdPpartyIntegrations?((0,l.wg)(),(0,l.iD)("div",c,[(0,l.Wm)(D)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showSyncSettings?((0,l.wg)(),(0,l.iD)("div",d,[(0,l.Wm)(x)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showImportStuff?((0,l.wg)(),(0,l.iD)("div",r,[(0,l.Wm)(T)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_product_properties?((0,l.wg)(),(0,l.iD)("div",_,[(0,l.Wm)(F)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showAccountSattings?((0,l.wg)(),(0,l.iD)("div",u,[(0,l.Wm)(U)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_new_position?((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(V,{currentItems:s.currentItems,onClose:y.updateProducts},null,8,["currentItems","onClose"])])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_cancel_position?((0,l.wg)(),(0,l.iD)("div",h,[(0,l.Wm)(q,{currentItems:s.currentItems,onClose:y.updateProducts},null,8,["currentItems","onClose"])])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showMoveProductsBetweenWhs?((0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(L,{currentItems:s.currentItems,onClose:y.updateProducts},null,8,["currentItems","onClose"])])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.show_document_setting?((0,l.wg)(),(0,l.iD)("div",f,[(0,l.Wm)(I)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showClientsFieldsSettings?((0,l.wg)(),(0,l.iD)("div",v,[(0,l.Wm)(Z)])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(i.uT,{name:"modal_window"},{default:(0,l.w5)((()=>[e.showSettingEntities?((0,l.wg)(),(0,l.iD)("div",g,[(0,l.Wm)(W)])):(0,l.kq)("",!0)])),_:1})],64)}var b=s(7139);const y=e=>((0,l.dD)("data-v-b8617ef8"),e=e(),(0,l.Cn)(),e),k={class:"modal"},C={class:"wrapper"},S=y((()=>(0,l._)("div",{class:"modal-header"},[(0,l._)("div",{class:"head-text"},"Настройка таблицы")],-1))),D={class:"modal-body"},x=y((()=>(0,l._)("div",{class:"text"},[(0,l._)("small",{class:"small-text"},"Перетаскивайте колонки для изменения очередности")],-1))),T=["onUpdate:modelValue","id","disabled"],F=["for"],U={class:"modal-footer"};function V(e,t,s,o,a,n){const c=(0,l.up)("draggable"),d=(0,l.up)("btns-save-close");return(0,l.wg)(),(0,l.iD)("div",k,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>o.close())}),(0,l._)("div",C,[S,(0,l._)("div",D,[x,(0,l.Wm)(c,{class:"dragArea",list:o.list},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.list,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"item",key:e.name},[(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t=>e.visible=t,id:e.code,class:"checkbox",disabled:2===e.visible||-1===e.visible},null,8,T),[[i.e8,e.visible]]),(0,l._)("label",{for:e.code},null,8,F),(0,l.Uk)(" "+(0,b.zw)(e.name),1)])))),128))])),_:1},8,["list"])]),(0,l._)("div",U,[(0,l.Wm)(d,{onClose:o.close,onSave:o.save},null,8,["onClose","onSave"])])])])}var q=s(4038),L=s(8249),I=s(4870),Z=s(9299);function W(e){const t=(0,I.qj)({orders:{stateName:"orders",stateConfigField:"tableConfig",getStateReqName:"getOrdersTableConfig",updateStateReqName:"updateOrdersConfigTable",haveWH:!1},stock:{stateName:"account",stateConfigField:"tableConfig",getStateReqName:"getTableConfig",updateStateReqName:"update_config_table",haveWH:!0}}),s=(0,l.Fl)((()=>t[e]||{}));return{currentConfig:s}}var O={components:{draggable:L.J,BtnsSaveClose:q.Z},props:{selectedWH:{type:Object}},emits:{},setup(e){const{currentConfig:t}=W("orders"===e.selectedWH.value?"orders":"stock"),s=(0,I.iH)([]),i=(0,l.Fl)((()=>Z.Z.state[t.value.stateName]?.[t.value.stateConfigField])),o=(0,l.Fl)((()=>"whs"!=e.selectedWH.value?e.selectedWH.value:""));(0,l.bv)((async()=>{await Z.Z.dispatch(t.value.getStateReqName,o.value);const e=[];Object.entries(i.value).map((([t,s])=>{s.code=t,e.push(s)})),s.value=JSON.parse(JSON.stringify(e)),s.value.map((e=>e.visible=Boolean(e.visible)))}));const a=()=>{s.value.map(((e,t)=>e.sort=t+1));const e={value:{config:[]}};t.value.haveWH&&(e.wh=o.value,e.value.code=o.value),s.value.forEach((t=>{t.visible&&e.value.config.push(t.code)})),Z.Z.dispatch(t.value.updateStateReqName,e),n()},n=()=>{Z.Z.commit("close_table_settings")};return{list:s,tableConfig:i,save:a,close:n}}},P=s(89);const N=(0,P.Z)(O,[["render",V],["__scopeId","data-v-b8617ef8"]]);var E=N;const H=e=>((0,l.dD)("data-v-441b1c6c"),e=e(),(0,l.Cn)(),e),$={class:"wrapper"},M={class:"bgc"},A={class:"container"},j={class:"header"},Y={class:"top"},B=H((()=>(0,l._)("label",null,"Общие настройки",-1))),z=(0,l.Uk)("Назад"),K=H((()=>(0,l._)("br",null,null,-1))),R={class:"bottom"},G={class:"permits"},J={class:"permit"},X=H((()=>(0,l._)("label",{for:"q1"}," Разрешать добавлять товары из резерва в другие сделки ",-1))),Q={class:"permit"},ee=["disabled"],te=H((()=>(0,l._)("label",{for:"q3"}," Разрешать добавлять в сделки товар с нулевым остатком ",-1))),se={class:"permit"},le=H((()=>(0,l._)("label",{for:"q4"}," Товары в сделке только из одного склада ",-1))),ie={class:"content"},oe=H((()=>(0,l._)("h6",null,"Этапы резервирования товаров со склада",-1))),ae=H((()=>(0,l._)("div",{class:"small"}," Внимание! В рамках одной воронки этап резерирования должен быть раньше этапа списания. Если этап презервирования не выбран, то резерирование будет происходить в момент добавления товара в сделку. ",-1))),ne={class:"mt-4"},ce=H((()=>(0,l._)("label",{for:"lock_reserved_products_edit"}," Блокировать изменения товаров в этапах резервирования ",-1))),de={class:"steps"},re=H((()=>(0,l._)("h6",null,"Этапы списания товаров со склада",-1))),_e=H((()=>(0,l._)("div",{class:"small"}," Внимание! В рамках одной воронки этап списания должен быть позже этапа резерирования. ",-1))),ue={class:"steps"},pe=H((()=>(0,l._)("h6",null,"Привязка полей сделок",-1))),he={class:"steps"},me={class:"label_input"},fe=H((()=>(0,l._)("label",null," Не заполнять бюджет сделки ",-1))),ve=H((()=>(0,l._)("label",{for:"not_fill_budget"},null,-1))),ge={key:0},we={class:"footer"},be=(0,l.Uk)("Назад");function ye(e,t,s,o,a,n){const c=(0,l.up)("btns-save-close"),d=(0,l.up)("AppMultiSelect"),r=(0,l.up)("SelectorVue");return(0,l.wg)(),(0,l.iD)("div",$,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close())}),(0,l._)("div",M,[(0,l._)("div",A,[(0,l._)("div",j,[(0,l._)("div",Y,[B,(0,l.Wm)(c,{onClose:n.close,onSave:n.save},{close:(0,l.w5)((()=>[z])),_:1},8,["onClose","onSave"])]),K,(0,l._)("div",R,[(0,l._)("div",G,[(0,l._)("div",J,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"q1","onUpdate:modelValue":t[1]||(t[1]=e=>a.copyConfing.allow_add_reserve=e),onChange:t[2]||(t[2]=()=>a.copyConfing.allow_add_reserve?null:a.copyConfing.allow_add_with_zero_count=!1)},null,544),[[i.e8,a.copyConfing.allow_add_reserve]]),X]),(0,l._)("div",Q,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"q3",disabled:!a.copyConfing.allow_add_reserve,"onUpdate:modelValue":t[3]||(t[3]=e=>a.copyConfing.allow_add_with_zero_count=e)},null,8,ee),[[i.e8,a.copyConfing.allow_add_with_zero_count]]),te]),(0,l._)("div",se,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"q4","onUpdate:modelValue":t[4]||(t[4]=e=>a.copyConfing.one_wh_per_lead=e)},null,512),[[i.e8,a.copyConfing.one_wh_per_lead]]),le])])])]),(0,l._)("div",ie,[oe,ae,(0,l._)("div",ne,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"lock_reserved_products_edit","onUpdate:modelValue":t[5]||(t[5]=e=>a.lock_reserved_products_edit=e)},null,512),[[i.e8,a.lock_reserved_products_edit]]),ce]),(0,l._)("div",de,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.copyPipelinesListV2,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"label_input",key:e},[(0,l._)("label",null,' Воронка "'+(0,b.zw)(e?.name)+'" ',1),(0,l.Wm)(d,{list:[{name:"Все",value:"all"},...e?.statuses],placeholder:e?.statuses.filter((e=>e.selected)).length?"Выбрано: "+e?.statuses.filter((e=>e.selected&&"all"!==e.value)).length:"Не выбрано",onSelect:t=>n.optionSelectSteps(t,e?.value,"reserve_off")},null,8,["list","placeholder","onSelect"])])))),128))]),re,_e,(0,l._)("div",ue,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.copyPipelinesListV2,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"label_input",key:e},[(0,l._)("label",null,' Воронка "'+(0,b.zw)(e?.name)+'" ',1),(0,l.Wm)(r,{options_props:[{name:"Не выбрано",value:-1},...e?.statuses],onSelect:t=>n.optionSelectSteps(t,e?.value,"write_off"),selected_option:e.selectedWriteOff},null,8,["options_props","onSelect","selected_option"])])))),128))]),pe,(0,l._)("div",he,[(0,l._)("div",me,[fe,(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"not_fill_budget","onUpdate:modelValue":t[6]||(t[6]=e=>a.not_fill_budget=e)},null,512),[[i.e8,a.not_fill_budget]]),ve]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.leadsDeals,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"label_input",key:e},[(0,l._)("label",null,[(0,l.Uk)(' Поле "'+(0,b.zw)(e?.name)+'" ',1),t>=2?((0,l.wg)(),(0,l.iD)("span",ge,"(число)")):(0,l.kq)("",!0)]),(0,l.Wm)(r,{options_props:a.leadsDealsList,onSelect:t=>n.optionSelectLeadsDeals(t,e?.code),selected_option:e?.selected},null,8,["options_props","onSelect","selected_option"])])))),128))])]),(0,l._)("div",we,[(0,l.Wm)(c,{onClose:n.close,onSave:n.save},{close:(0,l.w5)((()=>[be])),_:1},8,["onClose","onSave"])])])])])}var ke=s(7720),Ce=s(8731),Se={components:{SelectorVue:ke.Z,BtnsSaveClose:q.Z,AppMultiSelect:Ce.Z},data(){return{copyConfing:{reserve_off:[],write_off:[]},copyPipelinesListV2:[],copyLeadFieldsList:[],leadsDeals:[{name:"Товары",code:"field_products",selected:{name:"Не выбрано",value:-1}},{name:"Поле для поиска товаров",code:"field_search_products",selected:{name:"Не выбрано",value:-1}},{name:"Себестоимость",code:"field_cost_price",selected:{name:"Не выбрано",value:-1}},{name:"Прибыль",code:"field_profit",selected:{name:"Не выбрано",value:-1}},{name:"Общий бюджет",code:"field_budget",selected:{name:"Не выбрано",value:-1}},{name:"НДС сумма",code:"field_nds_sum",selected:{name:"Не выбрано",value:-1}}],leadsDealsList:[],not_fill_budget:!1,lock_reserved_products_edit:!1}},async mounted(){await Promise.all([this.$store.dispatch("get_account"),this.$store.dispatch("getPipelinesListV2"),this.$store.dispatch("getLeadFieldsList")]),this.copyConfing=JSON.parse(JSON.stringify(this.$store.state.account.account.config)),this.copyConfing.reserve_off_v2||(this.copyConfing.reserve_off_v2=[]),this.not_fill_budget=Boolean(this.copyConfing?.not_fill_budget),this.lock_reserved_products_edit=Boolean(this.copyConfing?.lock_reserved_products_edit),this.copyPipelinesListV2=this.pipelinesListV2,this.copyLeadFieldsList=this.leadFieldsList,this.fillLeadsDealsList(),this.searchSelectedPipelines(),this.searchSelectedLeadsDeals()},computed:{pipelinesListV2(){const e=[];return Object.entries(this.$store.state.account.pipelinesListV2).map((t=>{const s=[];t[1].statuses.forEach((e=>s.push({name:e.name,value:e.id,color:e.color,selected:!1}))),t[1].statuses=[...s],t[1].selectedWriteOff={name:"Не выбрано",value:-1},e.push({value:t[0],...t[1]})})),e},leadFieldsList(){const e=[];return Object.entries(this.$store.state.account.leadFieldsList).map((t=>{const s=[];Object.entries(t[1].fields).forEach((e=>s.push({name:e[1],value:e[0]}))),t[1].fields=s,t[1].fields.unshift({name:"Не выбрано",value:-1}),t[1].selected={name:"Не выбрано",value:-1},e.push({value:t[0],...t[1]})})),e}},methods:{save(){const e={not_fill_budget:this.not_fill_budget,lock_reserved_products_edit:this.lock_reserved_products_edit},t=this.$store.state.account.account.config;Object.entries(this.copyConfing).forEach((s=>{t[s[0]]!==s[1]&&(e[s[0]]=s[1])})),this.$store.dispatch("update_account",e),this.close()},close(){this.$store.commit("open_close_edit_stuff",!1)},optionSelectLeadsDeals(e,t){-1==e.value?this.copyConfing[t]="0":this.copyConfing[t]=e.value,this.leadsDeals.map((s=>{s.code==t&&(s.selected=e)}))},include(e,t,s){let l=!1;return e.forEach((e=>{e[s]==t&&(l=!0)})),l},optionSelectSteps(e,t,s){let l=!0;if("reserve_off"!==s){this.include(this.copyConfing[s],t,"field")&&(this.copyConfing[s].map((s=>{s.field==t&&(s.value=e.value)})),l=!1);const i={field:t,value:e.value};l&&this.copyConfing[s].push(i),-1==e.value&&this.copyConfing[s].forEach(((e,l)=>{e.field==t&&this.copyConfing[s].splice(l,1)}))}if(this.copyPipelinesListV2.map((l=>{l.value==t&&"write_off"==s&&(l.selectedWriteOff=e),l.value==t&&"reserve_off"==s&&("all"===e.value&&l.statuses?.forEach((t=>{"all"!==t.value&&(t.selected=!e.selected)})),e.selected=!e.selected)})),"reserve_off"===s){const e=this.copyPipelinesListV2.find((e=>e.value===t)),s=[];if(e?.statuses?.forEach((e=>e.selected&&"all"!=e.value?s.push(e.value):null)),this.copyConfing.reserve_off_v2.find((e=>e.field===t))&&(l=!1),l)this.copyConfing.reserve_off_v2.push({field:t,values:s});else{const e=this.copyConfing.reserve_off_v2.find((e=>e.field===t));e&&(e.values=s)}}},searchSelectedInArr(e,t,s){let l={name:"Не выбрано",value:-1};return t.forEach((t=>{t[s]==e&&(l=t)})),l},searchSelectedPipelines(){this.copyPipelinesListV2.map((e=>{const t=this.copyConfing.write_off.find((t=>t.field==e.value));t&&(e.selectedWriteOff=this.searchSelectedInArr(t.value,e.statuses,"value"));const s=this.copyConfing?.reserve_off_v2?.find((t=>t.field==e.value));e.statuses.map((e=>{s?.values?.includes(e.value)&&(e.selected=!0)}));const l=e.statuses.filter((e=>!e.selected));1===l.length&&"all"===l[0].value&&(e.statuses.find((e=>"all"===e.value)).selected=!0)}))},fillLeadsDealsList(){this.leadsDealsList.push({name:"Не выбрано",value:-1}),this.copyLeadFieldsList.forEach((e=>{const t=e.name;this.leadsDealsList.push({name:t,value:"optgroup"});const s=e.fields.splice(1,999);s.forEach((e=>this.leadsDealsList.push({...e,optgroup:!0})))}))},searchSelectedLeadsDeals(){this.leadsDeals.map((e=>{e.selected=this.searchSelectedInArr(this.copyConfing[e.code],this.leadsDealsList,"value")}))}}};const De=(0,P.Z)(Se,[["render",ye],["__scopeId","data-v-441b1c6c"]]);var xe=De;const Te=e=>((0,l.dD)("data-v-2e9102a7"),e=e(),(0,l.Cn)(),e),Fe={class:"wrapper"},Ue={class:"container max-w-none"},Ve=Te((()=>(0,l._)("div",{class:"header"},[(0,l._)("label",null,"Добавление товаров")],-1))),qe={class:"content"},Le={class:"table_wrapper",ref:"tableWrapper"},Ie={class:"table"},Ze={class:"row title"},We=Te((()=>(0,l._)("td",{class:"item"},null,-1))),Oe={class:"item"},Pe=["onUpdate:modelValue","onFocusin","onFocusout","onInput","title","disabled"],Ne=["onUpdate:modelValue","onFocusin","onFocusout","onInput","title","disabled"],Ee={class:"item"},He={class:"select_input"},$e=["onUpdate:modelValue","title","disabled"],Me={class:"item"},Ae={class:"item"},je=["onUpdate:modelValue","disabled","title"],Ye={class:"item"},Be={class:"item"},ze=["onUpdate:modelValue","title","disabled"],Ke={class:"item"},Re={class:"item"},Ge=["onUpdate:modelValue","disabled"],Je={class:"nds"},Xe={key:0},Qe=["onUpdate:modelValue","id","disabled"],et=["for"],tt={key:1,class:"hiden"},st={class:"checkboxes"},lt=["onUpdate:modelValue","id","disabled"],it=["for"],ot=["onUpdate:modelValue","id","disabled"],at=["for"],nt=["onUpdate:modelValue","id","disabled"],ct=["for"],dt=["onUpdate:modelValue","disabled"],rt={class:"item"},_t={class:"item"},ut=["onUpdate:modelValue"],pt={class:"item"},ht=["onClick"],mt={class:"content_footer"},ft={class:"autocomplete_teleport"},vt=["onClick"],gt={class:"footer"};function wt(e,t,s,o,a,n){const c=(0,l.up)("ImportStuffSelector"),d=(0,l.up)("btns-save-close");return(0,l.wg)(),(0,l.iD)("div",Fe,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close())}),(0,l._)("div",Ue,[Ve,(0,l._)("div",qe,[(0,l._)("div",Le,[(0,l._)("table",Ie,[(0,l._)("thead",null,[(0,l._)("tr",Ze,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.title,((e,t)=>((0,l.wg)(),(0,l.iD)("td",{class:"item",key:e,style:(0,b.j5)({width:100/n.totalTitleWidth*a.titleWidth[t]})},(0,b.zw)(e),5)))),128)),We])]),(0,l._)("tbody",null,[(0,l.Wm)(i.W3,{name:"row"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.new_items,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:t},[(0,l._)("td",Oe,[(0,l.Wm)(c,{options_props:a.options_type,onSelect:(e,t)=>n.option_select(e,t,"type"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.type,idx:t,disabled:!e.new},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","idx","disabled"])]),(0,l._)("td",{class:"item",ref_for:!0,ref:e=>a.selected_field_autocomplete.idx==t&&"article"==a.selected_field_autocomplete.field?a.targetAutocomplete=e:null},[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t=>e.article=t,onFocusin:s=>n.set_selected_field_autocomplete("article",e.article,t),onFocusout:e=>n.set_selected_field_autocomplete("","",t),onInput:s=>n.set_selected_field_autocomplete("article",e.article,t),class:(0,b.C_)(["input",{not_valid:(""===e.article||void 0===e.article)&&a.try_accept}]),title:""!==e.article&&void 0!==e.article||!a.try_accept?null:"Пустое поле",disabled:!e.new},null,42,Pe),[[i.nr,e.article]])],512),(0,l._)("td",{class:"item",ref_for:!0,ref:e=>a.selected_field_autocomplete.idx==t&&"name"==a.selected_field_autocomplete.field?a.targetAutocomplete=e:null},[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t=>e.name=t,onFocusin:s=>n.set_selected_field_autocomplete("name",e.name,t),onFocusout:e=>n.set_selected_field_autocomplete("","",t),onInput:s=>n.set_selected_field_autocomplete("name",e.name,t),class:(0,b.C_)(["input",{not_valid:(""===e.name||void 0===e.name)&&a.try_accept}]),title:""!==e.name&&void 0!==e.name||!a.try_accept?null:"Пустое поле",disabled:!e.new},null,42,Ne),[[i.nr,e.name]])],512),(0,l._)("td",Ee,[(0,l._)("div",He,[(0,l.Wm)(c,{options_props:e.new?a.batch_category_options:e.batch_category_options,onSelect:(e,t)=>n.option_select(e,t,"batch_category"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.batch_category,idx:t,disabled:2==e.type.value},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","idx","disabled"]),(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t=>e.batch=t,class:(0,b.C_)(["input",{not_valid:(""===e.batch||void 0===e.batch)&&a.try_accept&&2!=e.type.value&&!1}]),title:""!==e.batch&&void 0!==e.batch||!a.try_accept||2==e.type.value?null:"Пустое поле",disabled:2==e.type.value||-1!=e.batch_category?.value},null,10,$e),[[i.nr,e.batch]])])]),(0,l._)("td",Me,[(0,l.Wm)(c,{options_props:e.wh_options,onSelect:(e,t)=>n.option_select(e,t,"wh"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.wh,idx:t,disabled:2==e.type.value},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","idx","disabled"])]),(0,l._)("td",Ae,[(0,l.wy)((0,l._)("input",{type:"number","onUpdate:modelValue":t=>e.count=t,class:(0,b.C_)(["input",{not_valid:(""===e.count||void 0==e.count)&&a.try_accept&&2!=e.type}]),disabled:2==e.type.value,min:"0",title:""!==e.count&&void 0!=e.count||!a.try_accept?null:"Пустое поле"},null,10,je),[[i.nr,e.count]])]),(0,l._)("td",Ye,[(0,l.Wm)(c,{options_props:a.units_options,onSelect:(e,t)=>n.option_select(e,t,"units"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.units,idx:t,disabled:2==e.type.value||!e.new&&!e.newBatch},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","idx","disabled"])]),(0,l._)("td",Be,[(0,l.wy)((0,l._)("input",{type:"number","onUpdate:modelValue":t=>e.cost_price=t,class:(0,b.C_)(["input",{not_valid:(""===e.cost_price||void 0===e.cost_price)&&a.try_accept}]),min:"0",title:""!==e.cost_price&&void 0!==e.cost_price||!a.try_accept?null:"Пустое поле",disabled:!e.new&&!e.newBatch},null,10,ze),[[i.nr,e.cost_price]])]),(0,l._)("td",Ke,[(0,l.Wm)(c,{options_props:e.price_cat_options,onSelect:(e,t)=>n.option_select(e,t,"price_cat"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.price_cat,disabled:!e.new&&!e.newBatch,idx:t},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","disabled","idx"])]),(0,l._)("td",Re,[(0,l.wy)((0,l._)("input",{type:"number","onUpdate:modelValue":t=>e.price.cost=t,class:"input",min:"0",disabled:!e.new&&!e.newBatch},null,8,Ge),[[i.nr,e.price.cost]])]),(0,l._)("td",{class:(0,b.C_)(["item",{long:e.price.is_nds}])},[(0,l._)("div",Je,[e.price.is_nds?((0,l.wg)(),(0,l.iD)("div",tt,[(0,l._)("div",st,[(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t=>e.price.is_nds=t,class:"checkbox",id:t+"nq",disabled:!e.new&&!e.newBatch},null,8,lt),[[i.e8,e.price.is_nds]]),(0,l._)("label",{for:t+"nq"},"НДС",8,it),(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t=>e.price.is_price_include_nds=t,class:"checkbox",id:t+"nw",disabled:!e.new&&!e.newBatch},null,8,ot),[[i.e8,e.price.is_price_include_nds]]),(0,l._)("label",{for:t+"nw"},"включен в цену",8,at),(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t=>e.price.is_manager_can_change_nds=t,class:"checkbox",id:t+"ne",disabled:!e.new&&!e.newBatch},null,8,nt),[[i.e8,e.price.is_manager_can_change_nds]]),(0,l._)("label",{for:t+"ne"},"можно менять %",8,ct)]),(0,l.wy)((0,l._)("input",{type:"number",class:"input","onUpdate:modelValue":t=>e.price.nds=t,placeholder:"% НДС",min:"0",disabled:!e.new&&!e.newBatch},null,8,dt),[[i.nr,e.price.nds]])])):((0,l.wg)(),(0,l.iD)("div",Xe,[(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t=>e.price.is_nds=t,class:"checkbox",id:t+"nq",disabled:!e.new&&!e.newBatch},null,8,Qe),[[i.e8,e.price.is_nds]]),(0,l._)("label",{for:t+"nq"},null,8,et)]))])],2),(0,l._)("td",rt,[(0,l.Wm)(c,{options_props:a.categories_options,onSelect:(e,t)=>n.option_select(e,t,"category"),onToggleShowOptions:n.toggleShowOptions,selected_option:e.category,idx:t,disabled:!e.new&&!e.newBatch},null,8,["options_props","onSelect","onToggleShowOptions","selected_option","idx","disabled"])]),(0,l._)("td",_t,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t=>e.description=t,class:"input"},null,8,ut),[[i.nr,e.description]])]),(0,l.Wm)(i.uT,{name:"row"},{default:(0,l.w5)((()=>[(0,l._)("td",pt,[(0,l.wy)((0,l._)("button",{class:"del_btn",onClick:e=>n.del_item(t)}," X ",8,ht),[[i.F8,a.new_items.length>1]])])])),_:2},1024)])))),128))])),_:1})])])],512),(0,l._)("div",mt,[(0,l._)("button",{class:"add_new_button",onClick:t[1]||(t[1]=e=>n.push_new_item())},"+")])]),a.selected_field_autocomplete_list.length?((0,l.wg)(),(0,l.j4)(l.lR,{key:0,to:a.targetAutocomplete},[(0,l._)("ul",ft,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.selected_field_autocomplete_list,(e=>((0,l.wg)(),(0,l.iD)("li",{key:e.id,onClick:t=>n.select_current_product(e)},(0,b.zw)(e.fields.name)+" | "+(0,b.zw)(e.fields.article)+" | "+(0,b.zw)(e.fields.batch),9,vt)))),128))])],8,["to"])):(0,l.kq)("",!0),(0,l._)("div",gt,[(0,l.Wm)(d,{onClose:n.close,onSave:n.save,disabledSave:a.acceptBtnDisable},null,8,["onClose","onSave","disabledSave"])])])])}const bt={class:"v-select"},yt={class:"options",key:"a1"},kt=["onClick"];function Ct(e,t,s,o,a,n){return(0,l.wg)(),(0,l.iD)("div",bt,[(0,l._)("div",{class:(0,b.C_)(["title",{title_checked:o.show_options,disabled:s.disabled}]),onClick:t[0]||(t[0]=e=>o.open_close_options()),ref:"title",tabindex:"0"},[(0,l._)("p",null,(0,b.zw)(s.selected_option.name),1),s.disabled?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",{key:0,class:(0,b.C_)(["arrow",{rotate_arrow:o.show_options}])},null,2))],2),o.show_options?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",{class:"backdrop",onClick:t[1]||(t[1]=(0,i.iM)((e=>o.handleFocusOut()),["stop"]))}),(0,l.Wm)(i.uT,{name:"list"},{default:(0,l.w5)((()=>[(0,l._)("div",yt,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.options,(e=>((0,l.wg)(),(0,l.iD)("p",{key:e.value,class:(0,b.C_)({optgroup:"optgroup"===e.value,selected:e.value==s.selected_option.value}),onClick:t=>o.select_option(e)},[e.optgroup?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.Uk)("     "+(0,b.zw)(e.name),1)],64)):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Uk)((0,b.zw)(e.name),1)],64))],10,kt)))),128))])])),_:1})],64)):(0,l.kq)("",!0)])}const St={props:{options_props:{type:Array,default(){return[]},required:!0},selected_option:{type:Object,required:!0,default(){return{}}},disabled:{type:Boolean,required:!1,default:!1},idx:{type:Number,required:!1}},emits:{select:null,toggleShowOptions:null},setup(e,t){const s=(0,I.iH)([]);(0,l.bv)((()=>{window.addEventListener("scroll",r),(0,l.Y3)((()=>{i()}))}));const i=()=>{s.value=[],e.options_props?.forEach((e=>s.value.push(e)))};(0,l.YP)((()=>e.options_props),(()=>{i()}),{deep:!0});const o=(0,I.iH)(!1);(0,l.YP)(o,(()=>t.emit("toggleShowOptions",o.value)));const a=()=>{o.value=!1},n=()=>{e.disabled||(r(),o.value=!o.value)},c=()=>{a()},d=s=>{"optgroup"!=s.value&&(t.emit("select",s,e.idx),a())};(0,l.Ah)((()=>window.removeEventListener("scroll",r)));const r=()=>{const e=_.value?.getBoundingClientRect();u.value=e.width-2+"px",p.value=e.x+"px",h.value=e.bottom+"px"},_=(0,I.iH)(null),u=(0,I.iH)(null),p=(0,I.iH)(null),h=(0,I.iH)(null);return{open_close_options:n,handleFocusOut:c,show_options:o,options:s,select_option:d,title:_,optionsWidth:u,optionsX:p,optionsY:h}}},Dt=()=>{(0,i.sj)((e=>({"77739cb6":e.optionsWidth,"1eaa6852":e.optionsX,"1eaa6850":e.optionsY})))},xt=St.setup;St.setup=xt?(e,t)=>(Dt(),xt(e,t)):Dt;var Tt=St;const Ft=(0,P.Z)(Tt,[["render",Ct],["__scopeId","data-v-1235c32f"]]);var Ut=Ft,Vt={components:{ImportStuffSelector:Ut,BtnsSaveClose:q.Z},props:{currentItems:{type:Array,required:!1,default(){return[]}}},data(){return{title:["Тип","Артикул","Название","№ партии","Склад","Кол-во","Единицы измерений","Себестоимость","Цена","Цена","НДС","Категория","Описание"],titleWidth:[1,1,10,1,1,1,1,1,1,1,1,1],new_items:[],options_type:[{name:"Товар",value:1},{name:"Услуга",value:2}],batch_category_options:[],wh_options:[],price_cat_options:[],units_options:[],categories_options:[],selected_field_autocomplete:{idx:null,field:"",value:""},selected_field_autocomplete_list:[],currentItemsBatchs:{},timer:0,targetAutocomplete:null,copyCurrentItems:[],fieldsForValidation:["article","name","count","cost_price"],fieldsServiceForValidation:["article","name","cost_price"],try_accept:!1,acceptBtnDisable:!1}},computed:{totalTitleWidth(){return this.titleWidth.reduce(((e,t)=>e+t),0)},fields(){return this.$store.state.fields.all_fields},categories(){const e=[];return this.new_items.forEach((t=>e.push(t.category))),e},batch_categories(){const e=[];return this.new_items.forEach((t=>e.push(t.batch_category))),e},isValid(){let e=!0;const t=[this.fieldsForValidation,this.fieldsServiceForValidation];return this.new_items.forEach((s=>{const l=2==s.type.value;let i=[];i=l?t[1]:t[0],i.forEach((t=>{const l=t.split(".");e=l[1]?e&&this.validation(s[l[0]][l[1]]):e&&this.validation(s[t])}))})),e}},async mounted(){await Promise.all([this.$store.dispatch("get_fields_properties"),this.$store.dispatch("get_all_fields")]),this.tocopyCurrentItems(this.currentItems),this.get_categories_options(),this.get_options("batch",this.batch_category_options,"Новая"),this.fillWhs(),this.fillPriceCat(),this.get_options("units",this.units_options,"Не выбрано"),this.currentItems.length?this.pushCurrentItems():this.push_new_item()},watch:{selected_field_autocomplete:{async handler(){clearTimeout(this.timer),this.timer=setTimeout((async()=>{const e=this.selected_field_autocomplete;if(this.selected_field_autocomplete_list=[],""!==e.field&&e.value.length>2&&" "!=e.value.split("").at(-1)&&" "!=e.value.split("")[0]){const t=await this.$store.dispatch("autocomplete_"+e.field,e.value);void 0!=t&&(this.selected_field_autocomplete_list=[...t])}}),500)},deep:!0},categories:{handler(){this.new_items.map((e=>{e.wh_options=this.searchCatArr(this.wh_options,this.searchParentsCat(e.category)),e.price_cat_options=this.searchCatArr(this.price_cat_options,this.searchParentsCat(e.category))}))},deep:!0},batch_categories:{handler(){this.new_items.map((e=>{-1===e.batch_category?.value?(e.newBatch=!0,e.batch=""):e.newBatch=!1}))},deep:!0}},methods:{push_new_item(){const e={new:!0,type:{name:"Товар",value:1},article:"",name:"",description:"",batch_category:{name:"Новая",value:-1},batch:"",wh:{name:"Основной склад",value:"wh"},count:0,units:{name:"Не выбрано",value:-1},cost_price:0,category:this.searchBaseCategory(),price_cat:{name:"Цена",value:"price"},price:{cost:0,currency:"RUB",is_manager_can_change_nds:!1,is_nds:!1,is_price_include_nds:!1,nds:0},wh_options:this.searchCatArr(this.wh_options,this.searchParentsCat(this.searchBaseCategory())),price_cat_options:this.searchCatArr(this.price_cat_options,this.searchParentsCat(this.searchBaseCategory()))};this.new_items.push(e)},pushCurrentItems(){this.currentItems.forEach((async e=>{let t=[];t=e?.fields?.article.length>0?await this.$store.dispatch("autocomplete_article",e?.fields?.article):[e];const s=t.filter((e=>e.fields.name==e.fields.name&&e.fields.article==e.fields.article));this.currentItemsBatchs[e.fields.article]=s,this.pushCurrentItem(e,this.selected_field_autocomplete.idx)}))},pushCurrentItem(e,t){const s={new:!1,id:e.id,type:{name:"Товар",value:1},article:e.fields.article,name:e.fields.name,description:e.fields?.description,batch_category:{name:"",value:-2},batch_category_options:[{name:"Новая",value:-1}],batch:e.fields.batch,wh:{name:"Основной склад",value:"wh"},count:0,units:{...this.units_options.find((t=>t.name==e.fields.units))},cost_price:e.fields.cost_price,category:{...this.categories_options.find((t=>t.value==e.fields.category))},price_cat:{name:"Цена",value:"price"},price:{...e.fields.price},wh_options:this.searchCatArr(this.wh_options,this.searchParentsCat(e.category)),price_cat_options:this.searchCatArr(this.price_cat_options,this.searchParentsCat(e.category))};this.currentItemsBatchs[e.fields.article]?.forEach((e=>s.batch_category_options.push({name:e.fields.batch,value:e.fields.batch}))),s.batch_category=s.batch_category_options.find((t=>t.value==e.fields.batch)),void 0!=t?(Object.assign(this.new_items[t],s),this.copyCurrentItems.push(e)):this.new_items.push(s)},del_item(e){this.new_items.splice(e,1)},fillWhs(){this.fields.filter((e=>13==e.type&&"whs"!=e.code)).forEach((e=>this.wh_options.push({name:e.name,value:e.code})))},fillPriceCat(){this.fields.filter((e=>11==e.type)).forEach((e=>this.price_cat_options.push({name:e.name,value:e.code})))},searchCatArr(e,t){const s=[];return e.forEach((e=>{t.includes(this.fields.find((t=>e.value==t.code)).category_id)&&s.push(e)})),s},searchParentsCat(e){let t=[];this.$store.state.categories.fields_properties.forEach((s=>{s.id==e?.value&&(t=[...s.levels])}));const s=t.indexOf(0);return t=t.slice(0,s),t},searchBaseCategory(){const e=this.$store.state.categories.fields_properties.find((e=>0==e.parent_id));return{name:e.name,value:e.id}},set_selected_field_autocomplete(e,t,s){""==e&&(this.targetAutocomplete=null),this.selected_field_autocomplete={field:e,value:t,idx:s}},select_current_product(e){const t=this.selected_field_autocomplete_list.filter((t=>t.fields.name==e.fields.name&&t.fields.article==e.fields.article));this.currentItemsBatchs[e.fields.article]=t,this.pushCurrentItem(e,this.selected_field_autocomplete.idx),this.set_selected_field_autocomplete("","",null)},get_options(e,t,s){t.push({name:s,value:-1}),this.search_type_options(this.fields,e).forEach(((e,s)=>t.push({name:e,value:s})))},get_categories_options(){this.$store.state.categories.fields_properties.forEach((e=>{let t="";for(let s=1;s<e.level;s++)t+="    ";this.categories_options.push({name:t+e.name,value:e.id})}))},search_type_options(e,t){let s=[];return e.forEach((e=>{e.code==t&&e.data&&(s=e.data)})),s},validation(e,t){let s=void 0!=e&&""!==e;return void 0!=t&&t.forEach((t=>{"length"==t.type&&(s=s&&e.length>t.value)})),s},option_select(e,t,s){if(this.new_items[t][s]={...e},"batch_category"===s&&-1!=e.value){const s=this.new_items[t].article,l=this.currentItemsBatchs[s].find((t=>t.fields.batch==e.value));this.pushCurrentItem(l,t)}},close(){this.$emit("close"),this.$store.commit("open_close_new_position",!1)},tocopyCurrentItems(e){this.copyCurrentItems=e},async save(){if(this.try_accept=!0,this.acceptBtnDisable=!0,this.isValid){const e={products:[]},t={products:[]};this.new_items.forEach((s=>{const l={is_service:s.type.value-1,fields:{name:s.name,description:s.description,article:s.article,batch:s.batch,units:s.units.name,cost_price:s.cost_price,category:s.category.value}};s.new||(l.id=s.id),l.fields[s.wh.value]={count:s.count,reserve:0},l.fields[s.price_cat.value]=s.price,s.new||s?.newBatch?t.products.push(l):e.products.push(l)})),t.products.length&&await this.$store.dispatch("add_product",t),e.products.length&&(e.products.map((e=>{const t=this.new_items.find((t=>t.name==e.fields.name));let s=this.copyCurrentItems.find((t=>t.fields.name==e.fields.name)).fields[t.wh.value]?.count;!s&&(s=0),e.fields[t.wh.value]={count:t.count+s}})),await this.$store.dispatch("update_product",e)),this.close()}this.acceptBtnDisable=!1},toggleShowOptions(e){const t=e=>{document.body.style.overflowY=e,this.$refs.tableWrapper.style.overflowX=e};t(e?"hidden":"auto")}}};const qt=(0,P.Z)(Vt,[["render",wt],["__scopeId","data-v-2e9102a7"]]);var Lt=qt;const It=e=>((0,l.dD)("data-v-9eeaf338"),e=e(),(0,l.Cn)(),e),Zt={class:"wrapper"},Wt={class:"container"},Ot=It((()=>(0,l._)("div",{class:"header"},[(0,l._)("label",null,"Списание товаров")],-1))),Pt={class:"content"},Nt={class:"table"},Et={class:"row title"},Ht={class:"item"},$t=["onUpdate:modelValue"],Mt={class:"item"},At=["onUpdate:modelValue"],jt={class:"item"},Yt={class:"select_input"},Bt={class:"item"},zt={class:"select_input"},Kt={class:"item"},Rt=["onUpdate:modelValue","max"],Gt={class:"item"},Jt=["onUpdate:modelValue"],Xt={class:"footer"};function Qt(e,t,s,o,a,n){const c=(0,l.up)("selector-vue"),d=(0,l.up)("btns-save-close");return(0,l.wg)(),(0,l.iD)("div",Zt,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close_modal())}),(0,l._)("div",Wt,[Ot,(0,l._)("div",Pt,[(0,l._)("table",Nt,[(0,l._)("thead",null,[(0,l._)("tr",Et,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.title,(e=>((0,l.wg)(),(0,l.iD)("td",{class:"item",key:e},(0,b.zw)(e),1)))),128))])]),(0,l._)("tbody",null,[(0,l.Wm)(i.W3,{name:"row"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.items_to_cancel,((t,s)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:t},[(0,l._)("td",Ht,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":e=>t.fields.article=e,class:"input",disabled:""},null,8,$t),[[i.nr,t.fields.article]])]),(0,l._)("td",Mt,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":e=>t.fields.name=e,class:"input",disabled:""},null,8,At),[[i.nr,t.fields.name]])]),(0,l._)("td",jt,[(0,l._)("div",Yt,[(0,l.Wm)(c,{options_props:[],onSelect:e.option_select1,selected_option:{name:t.fields?.batch,value:-1},disabled:!0},null,8,["onSelect","selected_option"])])]),(0,l._)("td",Bt,[(0,l._)("div",zt,[(0,l.Wm)(c,{options_props:n.calcWhsOptions[t.id],onSelect:n.option_select,selected_option:t.fields.whToCancel,idx:s},null,8,["options_props","onSelect","selected_option","idx"])])]),(0,l._)("td",Kt,[(0,l.wy)((0,l._)("input",{type:"number","onUpdate:modelValue":e=>t.fields.countToCancel=e,max:t.fields?.whToCancel?.count,class:(0,b.C_)(["input",{not_valid:""==t.fields?.countToCancel&&a.try_accept}])},null,10,Rt),[[i.nr,t.fields.countToCancel]])]),(0,l._)("td",Gt,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":e=>t.fields.rison=e,class:(0,b.C_)(["input",{not_valid:""==t.fields?.rison&&a.try_accept}])},null,10,Jt),[[i.nr,t.fields.rison]])])])))),128))])),_:1})])])]),(0,l._)("div",Xt,[(0,l.Wm)(d,{onClose:n.close_modal,onSave:n.save},null,8,["onClose","onSave"])])])])}var es={components:{SelectorVue:ke.Z,BtnsSaveClose:q.Z},props:{currentItems:{type:Array,required:!0,default(){return[]}}},data(){return{title:["Артикул","Название","№ партии","Склад","Кол-во","Причина списания"],items_to_cancel:[],whs_options:[],try_accept:!1}},async mounted(){await this.$store.dispatch("get_all_fields"),(0,l.Y3)((()=>{this.items_to_cancel=[...this.currentItems],this.items_to_cancel.map((e=>{e.fields.countToCancel=0,e.fields.rison="",e.fields.whs_options=[],e.fields.whToCancel={name:"Не выбрано",value:-1}})),this.fillWhs()}))},computed:{fields(){return this.$store.state.fields.all_fields},countToCancel(){const e=[];return this.items_to_cancel.forEach((t=>e.push(t.fields.countToCancel))),e},calcWhsOptions(){const e={};return this.items_to_cancel.forEach((t=>{const s=[];t.fields.whs_options&&t.fields.whs_options.forEach((e=>{const l={};if(t.fields[e.value]){const s=this.allow_add_reserve?t.fields[e.value].count:t.fields[e.value].count-t.fields[e.value].reserve;l.name=e.name+" | "+s,l.value=e.value}s.push(l)})),e[t.id]=s})),e},allow_add_reserve(){return this.$store.state.account.account.config.allow_add_reserve}},watch:{countToCancel:{handler:function(){this.items_to_cancel.map((e=>{if(e.fields.whToCancel){let t=e.fields?.[e.fields.whToCancel?.value]?.count;void 0==t&&(t=0),e.fields.countToCancel>t&&(e.fields.countToCancel=t),e.fields.countToCancel<0&&(e.fields.countToCancel=0)}}))},deep:!0}},methods:{fillWhs(){this.fields.filter((e=>13==e.type&&"whs"!=e.code)).forEach((e=>this.whs_options.push({name:e.name,value:e.code}))),this.items_to_cancel.map((e=>{e.fields.whs_options=this.searchCatArr(this.whs_options,this.searchParentsCat(e.fields.category))}))},searchCatArr(e,t){const s=[];return e.forEach((e=>{t.includes(this.fields.find((t=>e.value==t.code)).category_id)&&s.push(e)})),s},searchParentsCat(e){let t=[];this.$store.state.categories.fields_properties.forEach((s=>{s.id==e&&(t=[...s.levels])}));const s=t.indexOf(0);return t=t.slice(0,s),t},async save(){this.try_accept=!0;let e=!0;if(this.items_to_cancel.forEach((t=>{e=e&&""!=t.fields.countToCancel&&""!=t.fields.rison&&void 0!=t.fields.countToCancel&&void 0!=t.fields.rison})),e){const e={products:[]};this.items_to_cancel.forEach((t=>{const s={id:t.id,fields:t.fields,comment:t.fields.rison};s.fields[t.fields.whToCancel.value].count=s.fields[t.fields.whToCancel.value].count-s.fields.countToCancel,delete s.fields.countToCancel,delete s.fields.rison,delete s.fields.whs_options,delete s.fields.whToCancel,e.products.push(s)})),await this.$store.dispatch("update_product",e),this.close_modal()}},close_modal(){this.items_to_cancel=[],this.try_accept=!1,this.$emit("close"),this.$store.commit("open_close_cancel_position",!1)},option_select(e,t){this.items_to_cancel[t].fields.whToCancel=e}}};const ts=(0,P.Z)(es,[["render",Qt],["__scopeId","data-v-9eeaf338"]]);var ss=ts;const ls=e=>((0,l.dD)("data-v-5b5ec65e"),e=e(),(0,l.Cn)(),e),is={key:0},os={key:1},as={class:"container"},ns={class:"header"},cs={class:"left"},ds=ls((()=>(0,l._)("div",{class:"title"},"Настройки документов",-1))),rs={key:0,class:"autorization"},_s={key:1,class:"autorization"},us=(0,l.Uk)(" Вы не авторизированы в сервисе Google Drive "),ps=["href"],hs={class:"right"},ms={class:"modal_settings"},fs={class:"content"},vs={key:0,class:"binding"},gs={class:"header"},ws=(0,l.Uk)(" Привязка полей документов "),bs={class:"save"},ys={class:"main"},ks={class:"column"},Cs={class:"label_select"},Ss=ls((()=>(0,l._)("label",null,'Поле "Документы"',-1))),Ds={class:"label_select"},xs=ls((()=>(0,l._)("label",null,"Поряд имен контактов",-1))),Ts={class:"patterns"},Fs=ls((()=>(0,l._)("div",{class:"header mb-2"},"Хуки",-1))),Us={class:"main mb-4"},Vs={class:"column"},qs={class:"grid grid-cols-[3fr_4fr] items-center"},Ls=ls((()=>(0,l._)("label",null,"Хук при загрузке документа в сделку",-1))),Is={class:"grid grid-cols-[3fr_4fr] items-center"},Zs=ls((()=>(0,l._)("label",null,"Хук при генерации документа в сделке",-1))),Ws=ls((()=>(0,l._)("div",{class:"header"},[(0,l._)("div",null,"Шаблоны документов"),(0,l._)("p",{class:"small"}," Файлы шаблонов должны быть доступны для чтения по ссылке. Google ID файла это часть ссылки на файл Пример ссылки: https://docs.google.com/spreadsheets/d/1XdXdEMtUFa8V__UK234432Dpx5-CeI/edit#gid=0, где Google ID файла: 1XdXdEMtUFa8V__UK234432Dpx5-CeI Вместо Google ID файла допускается ввод полного адреса ")],-1))),Os={class:"main"},Ps={class:"table"},Ns={class:"row title"},Es=ls((()=>(0,l._)("td",{class:"item"},null,-1))),Hs={class:"add_button_container"},$s=ls((()=>(0,l._)("div",{class:"icon"},null,-1))),Ms=[$s],As={class:"footer"},js=(0,l.Uk)("Назад");function Ys(e,t,s,o,a,n){const c=(0,l.up)("document-setting-add-new"),d=(0,l.up)("DocumentSettingFieldsV2"),r=(0,l.up)("btns-save-close"),_=(0,l.up)("SelectorVue"),u=(0,l.up)("document-setting-doc-row");return(0,l.wg)(),(0,l.iD)(l.HY,null,[a.showAddNew?((0,l.wg)(),(0,l.j4)(c,{key:0,cur_doc:a.cur_doc,id:a.selected_doc_id,onClose:n.close_add_new,onSave_new_doc:e.save_new_doc,onSave_cur_doc:e.save_cur_doc},{title:(0,l.w5)((()=>[null===a.selected_doc_id?((0,l.wg)(),(0,l.iD)("span",is," Добавление шаблона документов ")):(0,l.kq)("",!0),null!==a.selected_doc_id?((0,l.wg)(),(0,l.iD)("span",os," Редактирование шаблона документов ")):(0,l.kq)("",!0)])),_:1},8,["cur_doc","id","onClose","onSave_new_doc","onSave_cur_doc"])):(0,l.kq)("",!0),a.showFields?((0,l.wg)(),(0,l.j4)(d,{key:1,onClose:n.close_fields},null,8,["onClose"])):(0,l.kq)("",!0),(0,l._)("div",{class:"app",ref:"app",onClick:t[9]||(t[9]=e=>a.show_settings?n.close_settings():null)},[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close())}),(0,l._)("div",as,[(0,l._)("div",ns,[(0,l._)("div",cs,[ds,n.account.is_google_auth?((0,l.wg)(),(0,l.iD)("div",rs,[(0,l.Uk)(' Вы авторизированы в сервисе Google Drive как "'+(0,b.zw)(n.account.google_user_name)+'". ',1),(0,l._)("button",{onClick:t[1]||(t[1]=e=>n.unAutorization())},"Выйти")])):((0,l.wg)(),(0,l.iD)("div",_s,[us,(0,l._)("button",{onClick:t[2]||(t[2]=e=>n.autorization())},"Войти")])),n.account.config?.google_folder_id?((0,l.wg)(),(0,l.iD)("a",{key:2,href:"https://drive.google.com/drive/folders/"+n.account.config.google_folder_id,target:"blank",class:"a"},"Папка с документами",8,ps)):(0,l.kq)("",!0)]),(0,l._)("div",hs,[(0,l._)("button",{class:"settings_btn",onClick:t[3]||(t[3]=(0,i.iM)((e=>n.open_close_settings()),["stop"]))}),(0,l.Wm)(i.uT,{name:"modal"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("div",ms,[(0,l._)("a",null,[(0,l._)("div",{class:(0,b.C_)(["modal_container",{disable:a.disable_fields_templates}]),onClick:t[4]||(t[4]=e=>n.open_fields())}," Поля шаблонов ",2)]),(0,l._)("a",null,[(0,l._)("div",{class:"modal_container",onClick:t[5]||(t[5]=e=>n.refresh_fields())}," Обновить поля шаблонов ")])],512),[[i.F8,a.show_settings]])])),_:1})])]),(0,l._)("div",fs,[n.account.install?((0,l.wg)(),(0,l.iD)("div",vs,[(0,l._)("div",gs,[ws,(0,l._)("div",bs,[(0,l.Wm)(r,{onSave:n.save,show_close:!1},null,8,["onSave"])])]),(0,l._)("div",ys,[(0,l._)("div",ks,[(0,l._)("div",Cs,[Ss,(0,l.Wm)(_,{options_props:a.lead_fields_options,onSelect:n.lead_fields_select,selected_option:a.lead_fields},null,8,["options_props","onSelect","selected_option"])]),(0,l._)("div",Ds,[xs,(0,l.Wm)(_,{options_props:a.contact_name_type_options,onSelect:n.contact_name_type_select,selected_option:a.contact_name_type},null,8,["options_props","onSelect","selected_option"])])])])])):(0,l.kq)("",!0),(0,l._)("div",Ts,[n.account.install?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[Fs,(0,l._)("div",Us,[(0,l._)("div",Vs,[(0,l._)("div",qs,[Ls,(0,l.wy)((0,l._)("input",{type:"text",class:"input inputhuk my-2","onUpdate:modelValue":t[6]||(t[6]=e=>a.hook_download=e)},null,512),[[i.nr,a.hook_download]])]),(0,l._)("div",Is,[Zs,(0,l.wy)((0,l._)("input",{type:"text",class:"input inputhuk my-2","onUpdate:modelValue":t[7]||(t[7]=e=>a.hook_generate_doc=e)},null,512),[[i.nr,a.hook_generate_doc]])])])])],64)):(0,l.kq)("",!0),Ws,(0,l._)("div",Os,[(0,l._)("table",Ps,[(0,l._)("thead",null,[(0,l._)("tr",Ns,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.title,(e=>((0,l.wg)(),(0,l.iD)("td",{class:"item",key:e},(0,b.zw)(e),1)))),128)),Es])]),(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(n.documents_templates,(t=>((0,l.wg)(),(0,l.j4)(u,{key:t.id,doc:t,onOpen_edit:n.open_edit,onDelete_cur_doc:e.delete_cur_doc},null,8,["doc","onOpen_edit","onDelete_cur_doc"])))),128))])]),(0,l._)("div",Hs,[(0,l._)("button",{class:"add_new_button",onClick:t[8]||(t[8]=e=>n.open_add_new())},Ms)])])])]),(0,l._)("div",As,[(0,l.Wm)(r,{onClose:n.close,show_save:!1},{close:(0,l.w5)((()=>[js])),_:1},8,["onClose"])])])],512)],64)}const Bs=e=>((0,l.dD)("data-v-24046cd3"),e=e(),(0,l.Cn)(),e),zs={class:"app_new"},Ks={class:"container"},Rs={class:"header"},Gs={class:"content"},Js={class:"label_input"},Xs=Bs((()=>(0,l._)("label",{class:"label"},"Название:",-1))),Qs={class:"label_input"},el=Bs((()=>(0,l._)("label",{class:"label"},"Google ID файла:",-1))),tl={key:0,class:"label_input"},sl=Bs((()=>(0,l._)("label",{class:"label"},"Этап авто-генерации:",-1))),ll={class:"label_input"},il={class:"label"},ol={key:1,class:"label_input"},al=Bs((()=>(0,l._)("label",{class:"label"},"Url последнего документа:",-1))),nl={class:"label_input"},cl=Bs((()=>(0,l._)("label",{class:"label"},"Тип шаблона:",-1))),dl={class:"label_input"},rl=Bs((()=>(0,l._)("label",{class:"label"},"Тип для скачивания:",-1))),_l={class:"footer"};function ul(e,t,s,o,a,n){const c=(0,l.up)("selector-vue"),d=(0,l.up)("btns-save-close");return(0,l.wg)(),(0,l.iD)("div",zs,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close_modal())}),(0,l._)("div",Ks,[(0,l._)("div",Rs,[(0,l.WI)(e.$slots,"title",{},void 0,!0)]),(0,l._)("div",Gs,[(0,l._)("div",Js,[Xs,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>a.name=e),class:(0,b.C_)(["input",{not_valid:a.try_accept&&""==a.name}])},null,2),[[i.nr,a.name]])]),(0,l._)("div",Qs,[el,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>a.file=e),class:(0,b.C_)(["input",{not_valid:a.try_accept&&""==a.file}])},null,2),[[i.nr,a.file]])]),n.account.install?((0,l.wg)(),(0,l.iD)("div",tl,[sl,(0,l.Wm)(c,{options_props:a.copyPipelinesList,onSelect:n.select_pipelines_option,selected_option:a.status_id},null,8,["options_props","onSelect","selected_option"])])):(0,l.kq)("",!0),(0,l._)("div",ll,[(0,l._)("label",il,(0,b.zw)(a.orientation.label),1),(0,l.Wm)(c,{options_props:a.orientation.list,onSelect:a.orientation.select,selected_option:a.orientation.selected},null,8,["options_props","onSelect","selected_option"])]),n.account.install?((0,l.wg)(),(0,l.iD)("div",ol,[al,(0,l.Wm)(c,{options_props:a.lead_fields_options,onSelect:n.select_url_field,selected_option:a.url_field},null,8,["options_props","onSelect","selected_option"])])):(0,l.kq)("",!0),(0,l._)("div",nl,[cl,(0,l.Wm)(c,{options_props:a.type_options,onSelect:n.option_select1,selected_option:a.type},null,8,["options_props","onSelect","selected_option"])]),(0,l._)("div",dl,[rl,(0,l.Wm)(c,{options_props:a.export_type_options,onSelect:n.option_select2,selected_option:a.export_type},null,8,["options_props","onSelect","selected_option"])])]),(0,l._)("div",_l,[(0,l.Wm)(d,{onClose:n.close_modal,onSave:n.save},null,8,["onClose","onSave"])])])])}var pl={components:{SelectorVue:ke.Z,BtnsSaveClose:q.Z},props:{cur_doc:{type:Object,required:!1,default(){return{}}},id:{type:Number,required:!1,default(){return null}}},emits:{close:null},data(){return{type_options:[],type:{name:"docx",value:"1"},export_type_options:[],export_type:{name:"Исходный",value:"1"},lead_fields_options:[],try_accept:!1,name:"",file:"",copyPipelinesList:[],status_id:{name:"Не выбрано",value:"1"},url_field:{name:"Не выбрано",value:"1"},orientation:{label:"Ориентация",selected:{name:"Книжная",value:0},list:[{name:"Книжная",value:"0"},{name:"Альбомная",value:"1"}],select:e=>{this.orientation.selected=e}}}},async mounted(){await Promise.all([this.$store.dispatch("getLeadFieldsList"),this.$store.dispatch("getPipelinesListV2")]),this.copyLeadFieldsList=this.leadFieldsList,this.copyPipelinesList=this.pipelinesList,this.$store.state.documents.config.types?.forEach(((e,t)=>this.type_options.push({name:e,value:t}))),this.$store.state.documents.config.export_type?.forEach(((e,t)=>this.export_type_options.push({name:e,value:t}))),this.set_lead_fields_options(),(0,l.Y3)((()=>this.add_cur_doc()))},computed:{leadFieldsList(){const e=[];return Object.entries(this.$store.state.account.leadFieldsList).map((t=>{const s=[];Object.entries(t[1].fields).forEach((e=>s.push({name:e[1],value:e[0]}))),t[1].fields=s,t[1].fields.unshift({name:"Не выбрано",value:"-1"}),t[1].selected={name:"Не выбрано",value:"-1"},e.push({value:t[0],...t[1]})})),e},pipelinesList(){const e=[];return e.push({name:"Не выбрано",value:"-1"}),Object.entries(this.$store.state.account.pipelinesListV2).map((t=>{e.push({name:t[1].name,value:"optgroup"}),t[1].statuses.forEach((s=>e.push({name:s.name,value:t[0]+"#"+s.id,color:s.color,optgroup:!0})))})),e},account(){return this.$store.state.account.account}},methods:{save(){if(this.try_accept=!0,""!=this.name&&""!=this.file){const e={name:this.name,file:this.file,type:this.type.name,orientation:this.orientation?.selected?.value,export_type:this.export_type.name,status_id:this.status_id.value,url_field:this.url_field.value};Object.keys(this.cur_doc).length>0?this.$store.dispatch("update_template",{...e,id:this.id}):this.$store.dispatch("add_template",e),this.close_modal()}},close_modal(){this.$emit("close")},option_select1(e){Object.assign(this.type,e)},option_select2(e){Object.assign(this.export_type,e)},select_pipelines_option(e){Object.assign(this.status_id,e)},select_url_field(e){Object.assign(this.url_field,e)},add_cur_doc(){if(Object.keys(this.cur_doc).length>0){this.name=this.cur_doc.name,this.file=this.cur_doc.file;const e=(e,t,s,l)=>{let i={name:"Не выбрано",value:"-1"};return e.forEach((e=>{(e[s]==t||l&&`${e[s]}`?.split("#")[1]===t)&&Object.assign(i,e)})),i};this.type=e(this.type_options,this.cur_doc.type,"name"),this.orientation.selected=e(this.orientation.list,this.cur_doc.orientation,"value"),this.status_id=e(this.copyPipelinesList,this.cur_doc.status_id,"value",!0),this.url_field=e(this.lead_fields_options,this.cur_doc.url_field,"value"),this.export_type=e(this.export_type_options,this.cur_doc.export_type,"name")}},set_lead_fields_options(){this.lead_fields_options.push({name:"Не выбрано",value:"-1"}),this.copyLeadFieldsList.forEach((e=>{const t=e.name;this.lead_fields_options.push({name:t,value:"optgroup"});const s=e.fields.splice(1,999);s.forEach((e=>this.lead_fields_options.push({...e,optgroup:!0})))})),this.lead_fields_options.forEach((e=>e.value==this.$store.state.documents.config.field_docs?this.lead_fields=e:null))}}};const hl=(0,P.Z)(pl,[["render",ul],["__scopeId","data-v-24046cd3"]]);var ml=hl;const fl=e=>((0,l.dD)("data-v-3266ae58"),e=e(),(0,l.Cn)(),e),vl={class:"app_fileds"},gl={class:"container"},wl={class:"header"},bl=fl((()=>(0,l._)("div",{class:"left"},[(0,l._)("label",null,"Поля для шаблонов документов")],-1))),yl={class:"right"},kl=fl((()=>(0,l._)("div",{class:"icon"},null,-1))),Cl=[kl],Sl={class:"content"},Dl={class:"top"},xl=["onClick"],Tl={class:"bottom"},Fl={class:"mt-2"},Ul={class:"footer"};function Vl(e,t,s,i,o,a){const n=(0,l.up)("DocumentSettingFieldsListV2");return(0,l.wg)(),(0,l.iD)("div",vl,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>a.close())}),(0,l._)("div",gl,[(0,l._)("div",wl,[bl,(0,l._)("div",yl,[(0,l._)("button",{class:"btn_del",onClick:t[1]||(t[1]=e=>a.close())},Cl)])]),(0,l._)("div",Sl,[(0,l._)("div",Dl,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.tpl_fields,(e=>((0,l.wg)(),(0,l.iD)("div",{key:e,onClick:t=>a.select_catalog(e),class:(0,b.C_)(["title",{selected:e.title==o.selected_catalog}])},(0,b.zw)(e.title),11,xl)))),128))]),(0,l._)("div",Tl,[(0,l._)("div",Fl,[(0,l._)("small",null,(0,b.zw)(o.description),1)]),(0,l.Wm)(n,{list:o.list},null,8,["list"])])]),(0,l._)("div",Ul,[(0,l._)("button",{class:"btn btn1",onClick:t[2]||(t[2]=e=>a.close())},"Назад")])])])}const ql={class:"list"},Ll={class:"title"},Il={class:"mb-2"},Zl={key:0,class:"fields"},Wl=["onClick"],Ol={key:1,class:"row"},Pl={class:"fields"},Nl=["onClick"];function El(e,t,s,o,a,n){return(0,l.wg)(),(0,l.iD)("div",ql,[Array.isArray(s.list)?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(s.list,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"row",key:e},[(0,l._)("div",Ll,(0,b.zw)(e.title),1),(0,l._)("div",Il,[(0,l._)("small",null,(0,b.zw)(e.description),1)]),e.list?((0,l.wg)(),(0,l.iD)("div",Zl,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Object.entries(e.list),(([e,t])=>((0,l.wg)(),(0,l.iD)("button",{class:"field",key:e,onClick:t=>n.copy(e)},(0,b.zw)(t),9,Wl)))),128)),(0,l.wy)((0,l._)("span",null,null,512),[[i.F8,!1]])])):(0,l.kq)("",!0)])))),128)):((0,l.wg)(),(0,l.iD)("div",Ol,[(0,l._)("div",Pl,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Object.entries(s.list),(([e,t])=>((0,l.wg)(),(0,l.iD)("button",{class:"field",key:e,onClick:t=>n.copy(e)},(0,b.zw)(t),9,Nl)))),128)),(0,l.wy)((0,l._)("span",null,null,512),[[i.F8,!1]])])]))])}var Hl={props:{list:{type:Array,required:!0,default(){return[]}}},methods:{copy(e){navigator.clipboard.writeText(e).then((()=>{alert("Текст скопирован удачно")})).catch((()=>{alert("Текст не скопирован автоматически :с\nПопробуйте вручную")}))}}};const $l=(0,P.Z)(Hl,[["render",El],["__scopeId","data-v-4e67c4d5"]]);var Ml=$l,Al={emits:{close:null},components:{DocumentSettingFieldsListV2:Ml},data(){return{selected_catalog:"",description:"",list:[],tpl_fields:[]}},mounted(){this.tpl_fields=this.$store.state.documents.config.tpl_fields,this.tpl_fields[0].title&&this.select_catalog(this.tpl_fields[0])},computed:{},methods:{select_catalog(e){this.selected_catalog=e.title,this.list=e.list,this.description=e.description},close(){this.$emit("close")}}};const jl=(0,P.Z)(Al,[["render",Vl],["__scopeId","data-v-3266ae58"]]);var Yl=jl;const Bl=e=>((0,l.dD)("data-v-061606de"),e=e(),(0,l.Cn)(),e),zl={class:"row"},Kl={class:"item"},Rl={class:"item file"},Gl={class:"item"},Jl=["href"],Xl={class:"item"},Ql={class:"item"},ei={class:"item"},ti={class:"btns"},si=Bl((()=>(0,l._)("div",{class:"icon"},null,-1))),li=[si],ii=Bl((()=>(0,l._)("div",{class:"icon"},null,-1))),oi=[ii];function ai(e,t,s,i,o,a){return(0,l.wg)(),(0,l.iD)("tr",zl,[(0,l._)("td",Kl,(0,b.zw)(s.doc.name),1),(0,l._)("td",Rl,(0,b.zw)(s.doc.file),1),(0,l._)("td",Gl,[(0,l._)("a",{href:a.getHref(s.doc.file,s.doc.type),target:"blank"}," Шаблон ",8,Jl)]),(0,l._)("td",Xl,(0,b.zw)(s.doc.type),1),(0,l._)("td",Ql,(0,b.zw)(s.doc.export_type),1),(0,l._)("td",ei,[(0,l._)("div",ti,[(0,l._)("button",{class:"btn_edit",onClick:t[0]||(t[0]=e=>a.open_edit(s.doc))},li),(0,l._)("button",{class:"btn_del",onClick:t[1]||(t[1]=e=>a.delete_cur_doc(s.doc.id))},oi)])])])}var ni={props:{doc:{type:Object,required:!0}},emits:{open_edit:null,delete_cur_doc:null},methods:{open_edit(e){this.$emit("open_edit",e)},delete_cur_doc(e){this.$store.dispatch("delete_template",{id:e})},getHref(e,t){let s="#";return"docx"==t&&(s=`https://docs.google.com/document/d/${e}/edit`),"xlsx"==t&&(s=`https://docs.google.com/spreadsheets/d/${e}/edit`),s}}};const ci=(0,P.Z)(ni,[["render",ai],["__scopeId","data-v-061606de"]]);var di=ci,ri={components:{SelectorVue:ke.Z,DocumentSettingAddNew:ml,DocumentSettingFieldsV2:Yl,DocumentSettingDocRow:di,BtnsSaveClose:q.Z},data(){return{name:"Дмитрий Ивлев",title:["Название","Google ID файла","Шаблон","Тип шаблона","Тип для скачивания"],lead_fields_options:[],lead_fields:{name:"Не выбрано",value:1},contact_name_type_options:[],contact_name_type:{name:"Не выбрано",value:-1},showAddNew:!1,showFields:!1,show_settings:!1,cur_doc:{},selected_doc_id:null,copy_documents:[],disable_fields_templates:!1,hook_download:"",hook_generate_doc:""}},computed:{documents_templates(){return this.$store.state.documents.templates},account(){return this.$store.state.account.account},isTest(){return 1==this.$store.state.account.account.id},leadFieldsList(){const e=[];return Object.entries(this.$store.state.account.leadFieldsList).map((t=>{const s=[];Object.entries(t[1].fields).forEach((e=>s.push({name:e[1],value:e[0]}))),t[1].fields=s,t[1].fields.unshift({name:"Не выбрано",value:-1}),t[1].selected={name:"Не выбрано",value:-1},e.push({value:t[0],...t[1]})})),e}},async mounted(){await Promise.all([this.$store.dispatch("get_documents_v2"),this.$store.dispatch("get_account"),this.$store.dispatch("getLeadFieldsList")]),this.copyLeadFieldsList=this.leadFieldsList,this.hook_download=this.account.config?.hook_download,this.hook_generate_doc=this.account.config?.hook_generate_doc,this.set_lead_fields_options(),this.set_contact_name_type_options()},methods:{async autorization(){let e="scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=450,height=600,left=500,top=200";const t=await this.$store.dispatch("getGoogleAuthUrl"),s=window.open(t,"Авторизация Google",e),l=setInterval((()=>{s.closed&&(clearInterval(l),this.$store.dispatch("get_account"))}),1e3)},async unAutorization(){await this.$store.dispatch("googleLogOut"),this.$store.dispatch("get_account")},save(){this.$store.dispatch("update_account",{hook_download:this.hook_download,hook_generate_doc:this.hook_generate_doc,field_docs:this.lead_fields.value,contact_name_type:this.contact_name_type.value})},set_lead_fields_options(){this.lead_fields_options.push({name:"Не выбрано",value:-1}),this.copyLeadFieldsList.forEach((e=>{const t=e.name;this.lead_fields_options.push({name:t,value:"optgroup"});const s=e.fields.splice(1,999);s.forEach((e=>this.lead_fields_options.push({...e,optgroup:!0})))})),this.lead_fields_options.forEach((e=>e.value==this.$store.state.documents.config.field_docs?this.lead_fields=e:null))},set_contact_name_type_options(){this.$store.state.documents.config.contact_name_types?.forEach(((e,t)=>this.contact_name_type_options.push({name:e,value:t}))),this.contact_name_type_options?.forEach((e=>e.value==this.$store.state.account.account.config.contact_name_type?this.contact_name_type=e:null))},async refresh_fields(){this.disable_fields_templates=!0,await this.$store.dispatch("refresh_fields"),this.disable_fields_templates=!1},close(){this.$store.commit("open_close_document_setting",!1)},lead_fields_select(e){this.lead_fields=e},contact_name_type_select(e){this.contact_name_type=e},open_edit(e){this.cur_doc={...e},this.selected_doc_id=e.id,this.open_add_new()},open_modal(){this.$refs.app.style.pointerEvents="none"},close_modal(){this.$refs.app.style.pointerEvents="all"},open_add_new(){this.showAddNew=!0,this.open_modal()},close_add_new(){this.showAddNew=!1,this.cur_doc={},this.close_modal()},open_close_settings(){this.show_settings=!this.show_settings},close_settings(){this.show_settings=!1},open_fields(){this.disable_fields_templates||(this.showFields=!0,this.open_modal())},close_fields(){this.showFields=!1,this.close_modal()}}};const _i=(0,P.Z)(ri,[["render",Ys],["__scopeId","data-v-5b5ec65e"]]);var ui=_i;const pi=e=>((0,l.dD)("data-v-13ba1d85"),e=e(),(0,l.Cn)(),e),hi={class:"bgc"},mi={class:"container"},fi={class:"header"},vi={class:"top"},gi=pi((()=>(0,l._)("label",null,"Категории товаров",-1))),wi=(0,l.Uk)("Назад"),bi=pi((()=>(0,l._)("br",null,null,-1))),yi={class:"bottom"},ki={class:"add_teleport",style:{"z-index":"100"},title:"Добавлние новой подкатегории"},Ci={class:"content"},Si=["onDragstart"],Di={class:"input_name"},xi={title:"Изменение названия категории",class:"text_block"},Ti=["onKeyup","onUpdate:modelValue","disabled"],Fi=["onClick"],Ui=["onClick"],Vi=pi((()=>(0,l._)("div",{class:"rename btn"},null,-1))),qi=[Vi],Li=["onClick"],Ii=pi((()=>(0,l._)("div",{class:"remove btn"},null,-1))),Zi=[Ii],Wi=["id","onClick","title"],Oi=pi((()=>(0,l._)("div",{class:"add btn"},null,-1))),Pi=[Oi],Ni={class:"footer"},Ei=(0,l.Uk)("Назад");function Hi(e,t,s,o,a,n){const c=(0,l.up)("btns-save-close"),d=(0,l.up)("ProductsCategoryRemoveModal"),r=(0,l.up)("draggable");return(0,l.wg)(),(0,l.iD)("div",{class:(0,b.C_)(["wrapper",{opened_close_remove_modal:a.del_modal_config.show}])},[(0,l._)("div",{class:"backdrop backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close_product_category())}),(0,l._)("div",hi,[(0,l._)("div",mi,[(0,l._)("div",fi,[(0,l._)("div",vi,[gi,(0,l.Wm)(c,{onClose:n.close_product_category,onSave:e.save,show_save:!1},{close:(0,l.w5)((()=>[wi])),_:1},8,["onClose","onSave"])]),bi,(0,l._)("div",yi,[a.del_modal_config.show?((0,l.wg)(),(0,l.j4)(l.lR,{key:0,to:"body"},[(0,l.Wm)(d,{onRemove:n.remove,onClose:n.closeRemoveModal},null,8,["onRemove","onClose"])])):(0,l.kq)("",!0),null!==a.target?((0,l.wg)(),(0,l.j4)(l.lR,{key:1,to:a.target},[(0,l._)("div",{class:"backdrop",onClick:t[1]||(t[1]=(0,i.iM)((e=>n.reset_fields_cat_name()),["stop"])),style:{"z-index":"99"}}),(0,l._)("div",ki,[(0,l.wy)((0,l._)("input",{type:"text",class:"input_teleport","onUpdate:modelValue":t[2]||(t[2]=e=>a.fields_cat_name=e),ref:"input",onKeyup:[t[3]||(t[3]=(0,i.D2)((e=>n.add_new()),["enter"])),t[4]||(t[4]=(0,i.D2)((e=>n.reset_fields_cat_name()),["esc"]))]},null,544),[[i.nr,a.fields_cat_name]]),(0,l._)("button",{class:"button_teleport",onClick:t[5]||(t[5]=e=>n.add_new())},"ок")])],8,["to"])):(0,l.kq)("",!0)])]),(0,l._)("div",Ci,[(0,l.Wm)(r,{class:"dragArea",list:n.copy_fields_properties,onChange:n.changeData},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(n.copy_fields_properties,((e,s)=>((0,l.wg)(),(0,l.iD)("div",{key:e.id,class:(0,b.C_)(["item",{darag:a.isDragged==s}]),style:(0,b.j5)({width:n.calculate_width(e.level)+"%"}),onDragstart:e=>a.isDragged=s,onDragend:t[6]||(t[6]=e=>a.isDragged=null)},[(0,l._)("div",Di,[(0,l._)("div",xi,[(0,l.wy)((0,l._)("input",{type:"text",class:"input",onKeyup:(0,i.D2)((t=>n.rename(e.id)),["enter"]),"onUpdate:modelValue":t=>e.name=t,disabled:0===e.parent_id},null,40,Ti),[[i.nr,e.name]])]),!a.all_old?.name?.includes(e.name)&&a.all_old?.id?.includes(e.id)?((0,l.wg)(),(0,l.iD)("button",{key:0,onClick:t=>n.rename(e.id),class:"btns",title:"Сохраняет название категории"},[(0,l._)("div",{class:(0,b.C_)(["btn",{apply:!a.confirm,confirm:a.confirm}])},null,2)],8,Fi)):(0,l.kq)("",!0),!a.all_old?.name?.includes(e.name)&&a.all_old?.id?.includes(e.id)?((0,l.wg)(),(0,l.iD)("button",{key:1,onClick:t=>n.prevname(e.id),class:"btns",title:"Возвращает изначальное название"},qi,8,Ui)):(0,l.kq)("",!0)]),(0,l._)("div",null,[0!==e.parent_id&&(!n.copy_fields_properties[s+1]||n.copy_fields_properties[s+1]?.level<=e.level)?((0,l.wg)(),(0,l.iD)("button",{key:0,onClick:(0,i.iM)((t=>n.setRemoveModalConfig(e.id,e.level)),["stop"]),class:"btns",title:"Удаление категории"},Zi,8,Li)):(0,l.kq)("",!0),(0,l._)("button",{id:e.id,onClick:t=>a.selected_category_id=e.id,class:"btns",ref_for:!0,ref:t=>e.id===a.selected_category_id?a.target=t:null,title:null===a.target?"Добавлние новой подкатегории":null},Pi,8,Wi)])],46,Si)))),128))])),_:1},8,["list","onChange"])]),(0,l._)("div",Ni,[(0,l.Wm)(c,{onClose:n.close_product_category,onSave:e.save,show_save:!1},{close:(0,l.w5)((()=>[Ei])),_:1},8,["onClose","onSave"])])])])],2)}const $i=e=>((0,l.dD)("data-v-69ad2100"),e=e(),(0,l.Cn)(),e),Mi={class:"bg"},Ai=$i((()=>(0,l._)("div",{class:"backdrop filter"},null,-1))),ji={class:"modal"},Yi=$i((()=>(0,l._)("h3",{class:"header"},"Подтверждаете удаление категории?",-1))),Bi=$i((()=>(0,l._)("p",{class:"text"}," В случае удаления категории свойства товаров этой категории будут перенесены в корневую категорию ",-1))),zi={class:"buttons"},Ki=(0,l.Uk)("Удалить");function Ri(e,t,s,i,o,a){const n=(0,l.up)("BtnsSaveClose");return(0,l.wg)(),(0,l.iD)("div",Mi,[Ai,(0,l._)("div",ji,[Yi,Bi,(0,l._)("div",zi,[(0,l.Wm)(n,{onClose:a.close,onSave:a.remove},{save:(0,l.w5)((()=>[Ki])),_:1},8,["onClose","onSave"])])])])}var Gi={components:{BtnsSaveClose:q.Z},created(){document.body.style.overflowY="hidden"},unmounted(){document.body.style.overflowY="auto"},methods:{close(){this.$emit("close")},remove(){this.$emit("remove")}}};const Ji=(0,P.Z)(Gi,[["render",Ri],["__scopeId","data-v-69ad2100"]]);var Xi=Ji,Qi={components:{BtnsSaveClose:q.Z,ProductsCategoryRemoveModal:Xi,draggable:L.J},data(){return{fields_cat_name:"",selected_category_id:null,target:null,all_old:{},isDragged:null,confirm:!1,del_modal_config:{show:!1,id:null,level:null}}},async mounted(){this.$store.dispatch("get_fields_properties").then((()=>this.get_all_old()))},computed:{copy_fields_properties(){return this.$store.state.categories.fields_properties}},watch:{target:{handler:function(){(0,l.Y3)((()=>{null!==this.target&&this.$refs.input.focus()}))},deep:!0}},methods:{changeData(e){const t=e.moved.newIndex,s=[...this.copy_fields_properties],l={id:s[t].id,parent_id:s[t-1].id,name:""};this.$store.dispatch("update_fields_properties",l)},get_all_old(){const e={name:[],id:[],parent_id:[],fields_id:[],level:[],levels:[]};this.$store.state.categories.fields_properties.forEach((t=>Object.entries(t).forEach((t=>e[t[0]]?.push(t[1]))))),Object.assign(this.all_old,e)},add_new(){const e=this.copy_fields_properties.find((e=>e.id===this.selected_category_id));e.level+1<=10&&""!=this.fields_cat_name&&(this.$store.dispatch("add_fields_properties",{name:this.fields_cat_name,parent_id:e.id}),this.reset_fields_cat_name())},async rename(e){const t=[...this.copy_fields_properties].find((t=>t.id===e)),s={id:t.id,parent_id:"",name:t.name};await this.$store.dispatch("update_fields_properties",s),this.confirm=!0,setTimeout((()=>{this.confirm=!1,this.get_all_old()}),1e3)},prevname(e){this.$store.state.categories.fields_properties.map((t=>{const s=()=>{let t="";return this.all_old.id.forEach(((s,l)=>s===e?t=this.all_old.name[l]:null)),t};t.id===e&&(t.name=s(),this.rename(e))}))},reset_fields_cat_name(){this.selected_category_id=null,this.fields_cat_name="",this.target=null},calculate_width(e){let t=100;return t*=.95**(e-1),t},setRemoveModalConfig(e,t){this.del_modal_config.level=t,this.del_modal_config.id=e,this.del_modal_config.show=!0},remove(){1!=this.del_modal_config.level&&this.$store.dispatch("delete_fields_properties",{id:this.del_modal_config.id}),this.closeRemoveModal()},closeRemoveModal(){this.del_modal_config.show=!1},close_product_category(){this.$store.commit("open_close_product_category",!1)}}};const eo=(0,P.Z)(Qi,[["render",Hi],["__scopeId","data-v-13ba1d85"]]);var to=eo;const so=e=>((0,l.dD)("data-v-d861bd80"),e=e(),(0,l.Cn)(),e),lo={class:"wrapper"},io={class:"bgc"},oo={class:"container"},ao={class:"header"},no={class:"top"},co=so((()=>(0,l._)("label",null,"Свойства товаров",-1))),ro=(0,l.Uk)("Назад"),_o=so((()=>(0,l._)("br",null,null,-1))),uo={class:"links"},po=["onClick"],ho={class:"bottom"},mo={class:"content"},fo=so((()=>(0,l._)("h6",null,"Поля товаров в сделке",-1))),vo={class:"rows"},go={class:"row"},wo={key:0,class:""},bo=so((()=>(0,l._)("th",{class:"item item_field title"},[(0,l._)("div",{class:"copy_fields"},[(0,l._)("span",null,"Поле")])],-1))),yo=so((()=>(0,l._)("th",{class:"item item_type"},"Тип",-1))),ko={class:"item item_icon title"},Co={class:"w-min mx-auto"},So=so((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," visibility ",-1))),Do={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},xo={class:"item item_icon title"},To={class:"w-min mx-auto"},Fo=so((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," edit ",-1))),Uo={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},Vo={class:"item item_icon title"},qo={class:"w-min mx-auto"},Lo=so((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," title ",-1))),Io={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},Zo={key:1,class:"item item_icon title"},Wo={class:"w-min mx-auto"},Oo=so((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," content_copy ",-1))),Po={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},No={class:"item"},Eo={key:0,class:"p-[10px] border border-[#c9c9c9]"},Ho={class:"flex flex-row"},$o=["disabled","onClick"],Mo=["disabled","onClick"],Ao={class:"item"},jo={key:0},Yo=["onUpdate:modelValue","onKeyup","onChange"],Bo={class:"item selectors"},zo={key:0,class:"type_selector_options"},Ko=["onUpdate:modelValue","onChange"],Ro=["onClick"],Go=["onClick"],Jo={class:"box item text-lg"},Xo=["id","disabled","onUpdate:modelValue","onChange"],Qo=["for"],ea={class:"box item text-lg"},ta=["id","disabled","onUpdate:modelValue","onChange"],sa=["for"],la={class:"box item text-lg"},ia=["id","disabled","onUpdate:modelValue","onChange"],oa=["for"],aa={key:1,class:"box item text-lg"},na=["id","onUpdate:modelValue","onChange"],ca=["for"],da={class:"item del_sell"},ra=["onClick"],_a=["onClick"],ua={key:0,class:"p-[10px] border border-[#c9c9c9]"},pa={class:"item"},ha=["onUpdate:modelValue","onKeyup"],ma={class:"item selectors"},fa={key:0,class:"type_selector_options"},va=["onUpdate:modelValue"],ga=["onClick"],wa=["onClick"],ba={class:"box item text-lg"},ya=["id","disabled","onUpdate:modelValue"],ka=["for"],Ca={class:"box item text-lg"},Sa=["id","disabled","onUpdate:modelValue"],Da=["for"],xa={class:"box item text-lg"},Ta=["id","disabled","onUpdate:modelValue"],Fa=["for"],Ua={key:1,class:"box item text-lg"},Va=["id","onUpdate:modelValue"],qa=["for"],La={class:"item del_sell"},Ia=["onClick"],Za=["onClick"],Wa={class:"footer"},Oa=(0,l.Uk)("Назад");function Pa(e,t,s,o,a,n){const c=(0,l.up)("btns-save-close"),d=(0,l.up)("SelectorVue");return(0,l.wg)(),(0,l.iD)("div",lo,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close_product_properties())}),(0,l._)("div",io,[(0,l._)("div",oo,[(0,l._)("div",ao,[(0,l._)("div",no,[co,(0,l.Wm)(c,{onClose:n.close_product_properties,show_save:!1},{close:(0,l.w5)((()=>[ro])),_:1},8,["onClose"])]),_o,(0,l._)("div",uo,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.selected_fields_properties,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:(0,b.C_)(["triangle",{triangle_last:a.selected_fields_properties.length-1==t}]),key:e.id,onClick:e=>n.prev_cat(t)},(0,b.zw)(e.name),11,po)))),128))]),(0,l._)("div",ho,[(0,l.Wm)(d,{options_props:a.data_fields_properties.items,onSelect:n.option_select_fields_properties,selected_option:a.data_fields_properties.selected},null,8,["options_props","onSelect","selected_option"])])]),(0,l._)("div",mo,[fo,(0,l._)("table",vo,[(0,l._)("tr",go,[n.isTest&&1==a.selected_fields_properties.length?((0,l.wg)(),(0,l.iD)("th",wo)):(0,l.kq)("",!0),bo,yo,(0,l._)("th",ko,[(0,l._)("div",Co,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[1]||(t[1]=e=>a.toolTips.visibility=!0),onMouseleave:t[2]||(t[2]=e=>a.toolTips.visibility=!1)},[So,a.toolTips.visibility?((0,l.wg)(),(0,l.iD)("div",Do," Видимость в сделке ")):(0,l.kq)("",!0)],32)])]),(0,l._)("th",xo,[(0,l._)("div",To,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[3]||(t[3]=e=>a.toolTips.edit=!0),onMouseleave:t[4]||(t[4]=e=>a.toolTips.edit=!1)},[Fo,a.toolTips.edit?((0,l.wg)(),(0,l.iD)("div",Uo," Редактирование в сделке ")):(0,l.kq)("",!0)],32)])]),(0,l._)("th",Vo,[(0,l._)("div",qo,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[5]||(t[5]=e=>a.toolTips.title=!0),onMouseleave:t[6]||(t[6]=e=>a.toolTips.title=!1)},[Lo,a.toolTips.title?((0,l.wg)(),(0,l.iD)("div",Io," Заголовок товара в сделке ")):(0,l.kq)("",!0)],32)])]),n.isTest?((0,l.wg)(),(0,l.iD)("th",Zo,[(0,l._)("div",Wo,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[7]||(t[7]=e=>a.toolTips.content_copy=!0),onMouseleave:t[8]||(t[8]=e=>a.toolTips.content_copy=!1)},[Oo,a.toolTips.content_copy?((0,l.wg)(),(0,l.iD)("div",Po," Дублировать в новые партии ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0),(0,l._)("th",No,[n.showUpdateAllFieldsBtn?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save_all btn_yellow",onClick:t[9]||(t[9]=e=>n.updateAllFields())}," Сохранить все поля ")):(0,l.kq)("",!0)])]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.copy_fields,((e,t)=>(0,l.wy)(((0,l.wg)(),(0,l.iD)("tr",{class:(0,b.C_)(["row",{load:a.is_loading}]),key:e.id},[n.isTest&&1==a.selected_fields_properties.length?((0,l.wg)(),(0,l.iD)("th",Eo,[(0,l._)("div",Ho,[(0,l._)("button",{class:"bar_item_icon bar_item_icon_up",disabled:0===t,onClick:e=>n.changeTitleSort(t,!0)},null,8,$o),(0,l._)("button",{class:"bar_item_icon bar_item_icon_down",disabled:t===a.copy_fields.length-1,onClick:e=>n.changeTitleSort(t,!1)},null,8,Mo)])])):(0,l.kq)("",!0),(0,l._)("td",Ao,[e.is_system?((0,l.wg)(),(0,l.iD)("span",jo,(0,b.zw)(e.name),1)):(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:1,type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((e=>n.update_field(t,["name"])),["enter"]),onChange:t=>e.changeName=!0},null,42,Yo)),[[i.nr,e.name]])]),(0,l._)("td",Bo,[(0,l.Wm)(d,{options_props:n.types,onSelect:n.option_select_type,selected_option:n.search_type(e.type),disabled:!0,idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==e.type||6==e.type?((0,l.wg)(),(0,l.iD)("div",zo,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,o)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:o},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[o]=t,onChange:t=>e.changeData=!0},null,40,Ko),[[i.nr,e.data[o]]]),(0,l._)("button",{class:"del_button",onClick:s=>(n.remove_selector_option(t,o),e.changeData=!0)},null,8,Ro)])))),128)),(0,l._)("button",{onClick:s=>(n.add_selector_option(t),e.changeData=!0),class:"add_button"},null,8,Go)])):(0,l.kq)("",!0)]),(0,l._)("td",Jo,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb",disabled:e.lead_config.visible.disabled,"onUpdate:modelValue":t=>e.lead_config.visible.value=t,onChange:t=>e.changeLeadConfig=!0},null,40,Xo),[[i.e8,e.lead_config.visible.value]]),(0,l._)("label",{for:t+"nb"},null,8,Qo)]),(0,l._)("td",ea,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n",disabled:e.lead_config.editable.disabled,"onUpdate:modelValue":t=>e.lead_config.editable.value=t,onChange:t=>e.changeLeadConfig=!0},null,40,ta),[[i.e8,e.lead_config.editable.value]]),(0,l._)("label",{for:t+"n"},null,8,sa)]),(0,l._)("td",la,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nt",disabled:e.lead_config.title_visible.disabled,"onUpdate:modelValue":t=>e.lead_config.title_visible.value=t,onChange:t=>e.changeLeadConfig=!0},null,40,ia),[[i.e8,e.lead_config.title_visible.value]]),(0,l._)("label",{for:t+"nt"},null,8,oa)]),n.isTest?((0,l.wg)(),(0,l.iD)("td",aa,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nd","onUpdate:modelValue":t=>e.config.double_in_new_bath=t,onChange:t=>e.changeConfig=!0},null,40,na),[[i.e8,e.config.double_in_new_bath]]),(0,l._)("label",{for:t+"nd"},null,8,ca)])):(0,l.kq)("",!0),(0,l._)("td",da,[(0,l.wy)((0,l._)("button",{class:"del_btn",onClick:t=>n.delete_field(e.id)},null,8,ra),[[i.F8,!e.is_system]]),e.changeName||e.changeData||e.changeLeadConfig||e.changeConfig?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>n.update_field(t,[e.changeName?"name":null,e.changeData?"data":null,e.changeLeadConfig?"lead_config":null,e.changeConfig?"config":null])}," Сохранить ",8,_a)):(0,l.kq)("",!0)])],2)),[[i.F8,a.selected_fields_properties.at(-1)?.id===e.category_id]]))),128)),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.new_fields,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:e.id},[n.isTest&&1==a.selected_fields_properties.length?((0,l.wg)(),(0,l.iD)("th",ua)):(0,l.kq)("",!0),(0,l._)("td",pa,[(0,l.wy)((0,l._)("input",{type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((s=>n.add_new(e,t)),["enter"])},null,42,ha),[[i.nr,e.name]])]),(0,l._)("td",ma,[(0,l.Wm)(d,{options_props:n.types,onSelect:n.option_select_new_field_type,selected_option:n.search_type(e.type),idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==a.new_fields[t].type||6==a.new_fields[t].type?((0,l.wg)(),(0,l.iD)("div",fa,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,o)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:o},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[o]=t},null,8,va),[[i.nr,e.data[o]]]),(0,l._)("button",{class:"del_button",onClick:e=>n.remove_new_fields_selector_option(t,o)},null,8,ga)])))),128)),(0,l._)("button",{onClick:e=>n.add_new_fields_selector_option(t),class:"add_button"},null,8,wa)])):(0,l.kq)("",!0)]),(0,l._)("td",ba,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb1",disabled:a.new_fields[t].disabled?.visible.value,"onUpdate:modelValue":e=>a.new_fields[t].lead_config.visible.value=e},null,8,ya),[[i.e8,a.new_fields[t].lead_config.visible.value]]),(0,l._)("label",{for:t+"nb1"},null,8,ka)]),(0,l._)("td",Ca,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n1",disabled:a.new_fields[t].disabled?.editable.value,"onUpdate:modelValue":e=>a.new_fields[t].lead_config.editable.value=e},null,8,Sa),[[i.e8,a.new_fields[t].lead_config.editable.value]]),(0,l._)("label",{for:t+"n1"},null,8,Da)]),(0,l._)("td",xa,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n2",disabled:a.new_fields[t].lead_config.title_visible.disabled,"onUpdate:modelValue":e=>a.new_fields[t].lead_config.title_visible.value=e},null,8,Ta),[[i.e8,a.new_fields[t].lead_config.title_visible.value]]),(0,l._)("label",{for:t+"n2"},null,8,Fa)]),n.isTest?((0,l.wg)(),(0,l.iD)("td",Ua,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n3","onUpdate:modelValue":e=>a.new_fields[t].config.double_in_new_bath=e},null,8,Va),[[i.e8,a.new_fields[t].config.double_in_new_bath]]),(0,l._)("label",{for:t+"n3"},null,8,qa)])):(0,l.kq)("",!0),(0,l._)("td",La,[(0,l._)("button",{class:"del_btn",onClick:e=>n.delete_new_field(t)},null,8,Ia),""!=e.name?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>n.add_new(e,t)}," Сохранить ",8,Za)):(0,l.kq)("",!0)])])))),128))]),(0,l._)("button",{onClick:t[10]||(t[10]=e=>n.add_new_field()),class:"add_new_button"})]),(0,l._)("div",Wa,[(0,l.Wm)(c,{onClose:n.close_product_properties,show_save:!1},{close:(0,l.w5)((()=>[Oa])),_:1},8,["onClose"])])])])])}var Na={components:{SelectorVue:ke.Z,BtnsSaveClose:q.Z},data(){return{toolTips:{visibility:!1,edit:!1,title:!1,content_copy:!1},copy_fields:[],copy_fields_properties:[],selected_fields_properties:[],new_fields:[],data_fields_properties:{items:null,selected:{name:"Выбор подкатегории",value:-1}},is_loading:!1}},async mounted(){this.is_loading=!0,await Promise.all([this.$store.dispatch("get_types"),this.$store.dispatch("get_fields_properties")]),this.copy_fields_properties=[...this.$store.state.categories.fields_properties],this.option_select_fields_properties({value:this.copy_fields_properties.filter((e=>0===e.parent_id))[0]}),this.get_fields(),this.is_loading=!1},computed:{showUpdateAllFieldsBtn(){let e=!1;return this.copy_fields.forEach((t=>{e=e||t.changeName||t.changeData||t.changeLeadConfig||t.changeConfig})),e},types(){const e=[];return Object.entries(this.$store.state.fields.types).forEach((t=>{e.push({name:t[1],value:t[0]})})),e},properties_for_selector(){const e=[];return this.copy_fields_properties.forEach((t=>{let s="";for(let e=1;e<t.level;e++)s+="    ";e.push({name:s+t.name,value:t.id})})),e},isTest(){return 1==this.$store.state.account?.account?.id}},methods:{add_new_field(){const e={id:this.copy_fields.length+1,category_id:this.selected_fields_properties.at(-1).id,type:3,name:"",data:[],nameError:!1,lead_config:{visible:{disabled:!1,value:!1},editable:{disabled:!1,value:!1},title_visible:{disabled:!1,value:!1}},config:{double_in_new_bath:!1}};this.new_fields.push(e)},async add_new(e,t){const s=(e,t)=>{let s=0;return e&&t&&(s=2),e&&!t&&(s=1),e||t||(s=0),!e&&t&&(s=-1),s},l={visible:s(e.lead_config.visible.value,e.lead_config.visible.disabled),editable:s(e.lead_config.editable.value,e.lead_config.editable.disabled)},i={type:e.type,name:e.name,category_id:e.category_id,lead_config:l,data:e.data},o=await this.$store.dispatch("add_field",i),a="This field name exist."==o.error;a&&(this.new_fields[t]["nameError"]=!0),o.error||(this.new_fields.splice(this.new_fields.indexOf(e),1),this.get_fields())},prev_cat(e){this.selected_fields_properties.splice(e+1),this.feel_data_fields_properties(this.selected_fields_properties.at(-1).id)},feel_data_fields_properties(e){this.data_fields_properties.items=this.preparing_fields_properties(e),this.get_fields()},preparing_fields_properties(e){const t=[],s=this.copy_fields_properties.filter((t=>t.parent_id==e));return s.forEach((e=>t.push({name:e.name,value:e}))),t},option_select_fields_properties(e){const t=JSON.parse(JSON.stringify(e));this.selected_fields_properties.push(t.value),this.feel_data_fields_properties(e.value.id)},updateAllFields(){this.copy_fields.map(((e,t)=>{const s=e.changeName||e.changeData||e.changeLeadConfig||e.changeConfig;s&&this.update_field(t,[e.changeName?"name":null,e.changeData?"data":null,e.changeLeadConfig?"lead_config":null,e.changeConfig?"config":null]),e.changeName=!1,e.changeData=!1,e.changeLeadConfig=!1,e.changeConfig=!1}))},async update_field(e,t){const s={};s["id"]=this.copy_fields[e]["id"],t.forEach((t=>{null!=t&&(s[t]={},"lead_config"==t?(s[t].visible=this.copy_fields[e][t].visible.value?1:0,s[t].editable=this.copy_fields[e][t].editable.value?1:0,s[t].title_visible=this.copy_fields[e][t].title_visible.value?1:0,s[t].title_sort=this.copy_fields[e][t].title_sort):"config"==t?s[t].double_in_new_bath=this.copy_fields[e][t].double_in_new_bath?1:0:s[t]=this.copy_fields[e][t])})),this.copy_fields[e]?.is_system&&delete s?.name;const l=await this.$store.dispatch("update_fields",s),i="This field name exist."==l.error;this.copy_fields[e]["nameError"]=i,l.error||(this.copy_fields[e].changeName=!1,this.copy_fields[e].changeData=!1,this.copy_fields[e].changeLeadConfig=!1,this.copy_fields[e].changeConfig=!1)},async get_fields(){this.is_loading=!0,await this.$store.dispatch("get_fields",this.selected_fields_properties.at(-1).id),this.copy_fields=[...this.$store.state.fields.fields],this.copy_fields.map((e=>{e["nameError"]=!1,e["changeName"]=!1,e["changeData"]=!1,e["changeLeadConfig"]=!1,e["changeConfig"]=!1;const t=e.lead_config.visible;e.lead_config.visible={disabled:-1==t||2==t,value:t>0};const s=e.lead_config.editable;e.lead_config.editable={disabled:-1==s||2==s,value:s>0};const l=e.lead_config.title_visible;e.lead_config.title_visible={disabled:-1==l||2==l,value:l>0}})),this.is_loading=!1},search_type(e){return this.types.filter((t=>t.value==e))[0]},delete_new_field(e){const t=this.selected_fields_properties.at(-1),s=t.fields_id.length-this.new_fields.length+e;this.new_fields.splice(e,1),this.copy_fields_properties.map((e=>e.id===t.id?e.fields_id.splice(s,1):null)),t.fields_id.splice(s,1)},async delete_field(e){await this.$store.dispatch("delete_field",e),this.get_fields()},option_select_type(e,t){this.copy_fields[t].type=e},option_select_new_field_type(e,t){this.new_fields[t].type=e.value},async option_select_copy_fields(e){const t=await this.$store.dispatch("get_fields_not_save",e.value),s=t.filter((e=>!e.is_system));s.forEach((async e=>{const t={id:e.id,category_id:this.selected_fields_properties.at(-1).id};await this.$store.dispatch("update_fields",t)})),this.get_fields()},changeTitleSort(e,t){t?(this.copy_fields[e].lead_config.title_sort-=1,this.copy_fields[e-1].lead_config.title_sort+=1):(this.copy_fields[e].lead_config.title_sort+=1,this.copy_fields[e+1].lead_config.title_sort-=1),this.update_field(e,["lead_config"]),t?this.update_field(e-1,["lead_config"]):this.update_field(e+1,["lead_config"]),this.get_fields()},add_selector_option(e){null==this.copy_fields[e].data&&(this.copy_fields[e].data=[]),this.copy_fields[e].data.push("")},remove_selector_option(e,t){this.copy_fields[e].data.splice(t,1)},add_new_fields_selector_option(e){this.new_fields[e].data.push("")},remove_new_fields_selector_option(e,t){this.new_fields[e].data.splice(t,1)},close_product_properties(){this.$store.commit("open_close_product_properties",!1)}}};const Ea=(0,P.Z)(Na,[["render",Pa],["__scopeId","data-v-d861bd80"]]);var Ha=Ea,$a=s.p+"img/genezis.b493be58.jpg",Ma=s.p+"img/lo.12da3521.jpg",Aa=s.p+"img/re.77cbb0b6.jpg";const ja=e=>((0,l.dD)("data-v-11cacdd1"),e=e(),(0,l.Cn)(),e),Ya={class:"wrapper"},Ba={class:"container"},za={class:"header"},Ka=ja((()=>(0,l._)("label",null,"Интеграции",-1))),Ra=ja((()=>(0,l._)("div",{class:"icon"},null,-1))),Ga=[Ra],Ja={class:"content"},Xa={class:"item"},Qa={href:" https://www.amocrm.ru/oauth/?state=%7B%22external_source%22:%22gosklad%22%7D&client_id=d9322b36-0001-4269-bb61-976571e8a51a",target:"blank"},en=["disabled"],tn={key:0},sn=["disabled"],ln=(0,l.uE)('<div class="item" data-v-11cacdd1><img class="icon" src="'+Ma+'" data-v-11cacdd1><a href="https://www.amocrm.ru/oauth/?client_id=a4864c29-6b9b-470b-bb0e-9a1c22496087" target="blank" data-v-11cacdd1><button class="btn btn_dark_blue" data-v-11cacdd1>Установить</button></a><small data-v-11cacdd1>Бесплатное дополнение</small></div><div class="item" data-v-11cacdd1><img class="icon" src="'+Aa+'" data-v-11cacdd1><a href="https://www.amocrm.ru/oauth/?client_id=47855e7f-c170-44b3-8d95-a3fe357d2cc7" target="blank" data-v-11cacdd1><button class="btn btn_dark_blue" data-v-11cacdd1>Установить</button></a><small data-v-11cacdd1>Бесплатное дополнение</small></div>',2),on={key:0,class:"item"},an=ja((()=>(0,l._)("img",{class:"icon",src:"https://wp.static-cdn-shsp.com/wp-content/uploads/2017/06/amo_fon.png"},null,-1))),nn=["href"],cn=["disabled"],dn={key:0},rn=ja((()=>(0,l._)("button",{class:"btn btn_dark_blue"},"Настройки",-1))),_n=[rn],un=ja((()=>(0,l._)("div",{class:"footer"},null,-1)));function pn(e,t,s,i,o,a){return(0,l.wg)(),(0,l.iD)("div",Ya,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>i.close())}),(0,l._)("div",Ba,[(0,l._)("div",za,[Ka,(0,l._)("button",{class:"btn_del",onClick:t[1]||(t[1]=e=>i.close())},Ga)]),(0,l._)("div",Ja,[(0,l._)("div",Xa,[(0,l._)("img",{class:"icon",src:$a,onClick:t[2]||(t[2]=e=>i.route("genezis"))}),(0,l._)("a",Qa,[(0,l._)("button",{class:"btn btn_dark_blue",disabled:i.account?.g_install},(0,b.zw)(i.account?.g_install?"Установлено":"Установить"),9,en)]),i.account?.g_install?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("small",tn," Для интеграции с 1С-Генезис необходимо установить виджет «Генезис: 1С интеграция» ")),(0,l._)("a",{onClick:t[3]||(t[3]=e=>i.route("genezis"))},[(0,l._)("button",{class:"btn btn_dark_blue",disabled:!i.account?.g_install}," Настройки ",8,sn)])]),ln,i.isTest||i.amoTest?((0,l.wg)(),(0,l.iD)("div",on,[an,(0,l._)("a",{href:i.urlSutupInAmoCrm,target:"blank"},[(0,l._)("button",{class:"btn btn_dark_blue",disabled:i.account?.install&&!i.isTest},(0,b.zw)(i.account?.install?"Установлено":"Установить"),9,cn)],8,nn),i.account?.install?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("small",dn," Для установки необходимо быть пользователем платформы amoCRM ")),i.account?.install?((0,l.wg)(),(0,l.iD)("a",{key:1,onClick:t[4]||(t[4]=e=>i.route("amoCRM"))},_n)):(0,l.kq)("",!0)])):(0,l.kq)("",!0)]),un])])}var hn=s(678),mn={setup(){const e=(0,hn.tv)(),t=(0,l.Fl)((()=>Z.Z.state.account.account?.config?.g_enabled)),s=(0,l.Fl)((()=>Z.Z.state.account.account)),i=(0,l.Fl)((()=>Z.Z.state.account.user)),o=(0,l.Fl)((()=>1==Z.Z.state.account?.account?.id)),a=t=>{n(),e.push("/"+t)},n=()=>Z.Z.commit("openCloseThirdPpartyIntegrations",!1),c=encodeURI(`https://www.amocrm.ru/oauth/?state={"external_source":"gs", "user_id":${i.value?.id}}&client_id=5cd3ee16-5f4c-4b3f-828f-9f575bcaeb2e`),d=(0,l.Fl)((()=>454==Z.Z.state.account?.account?.id));return{oneC:t,account:s,isTest:o,route:a,close:n,urlSutupInAmoCrm:c,amoTest:d}}};const fn=(0,P.Z)(mn,[["render",pn],["__scopeId","data-v-11cacdd1"]]);var vn=fn;const gn=e=>((0,l.dD)("data-v-055b608a"),e=e(),(0,l.Cn)(),e),wn={class:"wrapper"},bn={class:"bgc"},yn={class:"container"},kn={class:"header"},Cn=gn((()=>(0,l._)("label",null,"Настройки синхронизации GoСклад с товарами amoCRM",-1))),Sn=(0,l.Uk)("Назад"),Dn={class:"content"},xn={class:"sync"},Tn={class:"list"},Fn={class:"label_input"},Un=gn((()=>(0,l._)("label",null," Выберите список товаров из amoCRM для синхронизации ",-1))),Vn={class:"label_input"},qn=gn((()=>(0,l._)("label",null," Скрытие штатной вкладки amoCRM с товарами. В штатной вкладке с товарами так же можно прикреплять товары к сделкам, но количество товара на GoСклад учитываться не будет. ",-1))),Ln={class:"autosync"},In=["id","onUpdate:modelValue"],Zn=["for"],Wn={class:"fields"},On=gn((()=>(0,l._)("h6",null," Настройка соответствий полей amoCRM-товаров и свойств товаров на GoСклад ",-1))),Pn=gn((()=>(0,l._)("p",{class:"small"}," Указание полей сравнения нужно для того, чтобы по этим полям искать дубли товаров в процессе синхронизации списков товаров amoCRM и GoСклад, которые были добавлены вручную. Если не будет указано ни одного поля, товары будут добавляться без поиска дублей ",-1))),Nn=gn((()=>(0,l._)("div",{class:"row"},[(0,l._)("span",null,"Имя поля amoCRM-товара"),(0,l._)("span",null,"Имя поля товара на GoСклад"),(0,l._)("span",{class:"center"},"Сравнение")],-1))),En=["onUpdate:modelValue"],Hn={class:"checkbox_input"},$n=["id","onUpdate:modelValue","disabled"],Mn=["for"],An={class:"footer"},jn=(0,l.Uk)("Назад");function Yn(e,t,s,o,a,n){const c=(0,l.up)("btns-save-close"),d=(0,l.up)("SelectorVue");return(0,l.wg)(),(0,l.iD)("div",wn,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close())}),(0,l._)("div",bn,[(0,l._)("div",yn,[(0,l._)("div",kn,[Cn,(0,l.Wm)(c,{onClose:n.close,onSave:n.save},(0,l.Nv)({close:(0,l.w5)((()=>[Sn])),_:2},[void 0]),1032,["onClose","onSave"])]),(0,l._)("div",Dn,[(0,l._)("div",xn,[(0,l._)("div",Tn,[(0,l._)("div",Fn,[Un,(0,l.Wm)(d,{options_props:a.copyProductLists,onSelect:t[2]||(t[2]=e=>n.optionSelectSync(e,"amo_product_list")),selected_option:a.selectedAmoProductList},null,8,["options_props","selected_option"])]),(0,l._)("div",Vn,[qn,(0,l.Wm)(d,{options_props:[{name:"Не выбрано",value:""},...a.copyLeadFieldGroupsList],onSelect:t[3]||(t[3]=e=>n.optionSelectSync(e,"amo_leads_group_hide")),selected_option:a.selectedAmoLeadsGroupHide},null,8,["options_props","selected_option"])])])]),-1!=a.selectedAmoProductList.value?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("div",Ln,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.autosyncValues,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"list",key:e},[!e.test?.value||n.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("h6",null,(0,b.zw)(e.label),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.autosyncProducts,(t=>((0,l.wg)(),(0,l.iD)("div",{class:"row",key:t.id},[e.test?.id!==t.id||n.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t.id+e.value,"onUpdate:modelValue":s=>t[e.value]=s},null,8,In),[[i.e8,t[e.value]]]),(0,l._)("label",{for:t.id+e.value},(0,b.zw)(t.label),9,Zn)],64)):(0,l.kq)("",!0)])))),128))],64)):(0,l.kq)("",!0)])))),128))]),(0,l._)("div",Wn,[On,Pn,Nn,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.copySyncFields.amoFields,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"row",key:e.field},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.name=t,disabled:""},null,8,En),[[i.nr,e.name]]),(0,l.Wm)(d,{class:"selector",options_props:e.fields,onSelect:e=>n.select(e,t),selected_option:e.selected,disabled:e.disabled},null,8,["options_props","onSelect","selected_option","disabled"]),(0,l._)("div",Hn,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:e.field,"onUpdate:modelValue":t=>e.product_comparison=t,disabled:e?.product_comparison_disabled},null,8,$n),[[i.e8,e.product_comparison]]),(0,l._)("label",{for:e.field},null,8,Mn)])])))),128))])],64)):(0,l.kq)("",!0)]),(0,l._)("div",An,[(0,l.Wm)(c,{onClose:n.close,onSave:n.save},(0,l.Nv)({close:(0,l.w5)((()=>[jn])),_:2},[void 0]),1032,["onClose","onSave"])])])])])}var Bn={components:{BtnsSaveClose:q.Z,SelectorVue:ke.Z},data(){return{copySyncFields:{fields:[],amoFields:[]},copyConfing:{reserve_off:[],write_off:[]},copyLeadFieldGroupsList:[],copyProductLists:[],selectedAmoProductList:{name:"Не выбрано",value:-1},amoLeadsGroupHide:[],selectedAmoLeadsGroupHide:{name:"Не выбрано",value:""},fieldsProductComparison:[{name:"по названию",value:1},{name:"по названию и артикулу",value:2},{name:"по названию, артикулу и партии",value:3}],productComparisonSelectedField:{name:"по названию",value:1},autosyncProducts:[{id:1,productValue:!1,listProductValue:!1,label:"GoСклад -> amoCRM"},{id:2,productValue:!1,listProductValue:!1,label:"amoCRM -> GoСклад"}],autosyncValues:[{value:"productValue",label:"Автосинхронизация товаров"},{value:"listProductValue",label:"Автосинхронизация списка товаров в сделке",test:{value:!1,id:2}}]}},async mounted(){await Promise.all([this.$store.dispatch("get_account"),this.$store.dispatch("getProductLists"),this.$store.dispatch("getLeadFieldsList"),this.$store.dispatch("getLeadFieldGroupsList")]),this.copyLeadFieldsList=this.leadFieldsList,this.copyLeadFieldGroupsList=this.leadFieldGroupsList,this.copyConfing=this.$store.state.account.account.config,this.updateFields(),this.fillCopyProductLists(),this.fillAmoLeadsGroupHide(),this.searchSelectedAmoProductList(),this.searchSelectedAmoLeadsGroupHide(),this.searchAutosyncProducts()},computed:{account(){return this.$store.state.account.account},productLists(){return this.$store.state.account.productLists},isTest(){return 1==this.$store.state.account?.account?.id},leadFieldsList(){const e=[];return Object.entries(this.$store.state.account.leadFieldsList).map((t=>{const s=[];Object.entries(t[1].fields).forEach((e=>s.push({name:e[1],value:e[0]}))),t[1].fields=s,t[1].fields.unshift({name:"Не выбрано",value:-1}),t[1].selected={name:"Не выбрано",value:-1},e.push({value:t[0],...t[1]})})),e},leadFieldGroupsList(){const e=[];return Object.entries(this.$store.state.account.leadFieldGroupsList).forEach((t=>e.push({name:t[1],value:t[0]}))),e}},methods:{save(){const e={auto_sync_products_gs_amo:this.autosyncProducts[0].productValue?1:0,auto_sync_products_amo_gs:this.autosyncProducts[1].productValue?1:0,auto_sync_orders_gs_amo:this.autosyncProducts[0].listProductValue?1:0,auto_sync_orders_amo_gs:this.autosyncProducts[1].listProductValue?1:0};if(-1!=this.selectedAmoProductList.value){const t=[];this.copySyncFields.amoFields.forEach((e=>-1!=e.selected.value?t.push({field:e.field,value:e.selected.value,compare:e.product_comparison?1:0}):null)),t.length&&(e.sync_products_fields=t)}this.$store.dispatch("update_account",Object.assign(this.copyConfing,e)),this.close()},close(){this.$store.commit("openCloseSyncSettings",!1)},async updateFields(){await Promise.all([this.$store.dispatch("getSyncFields"),this.$store.dispatch("get_account")]),this.fillCopySyncFields(),this.searchSelectedSyncFields()},select(e,t){this.copySyncFields.amoFields[t].selected=e},searchSelectedSyncFields(){this.copySyncFields.amoFields.map((e=>{this.$store.state.account.account?.config?.sync_products_fields.forEach((t=>{if(t.field==e.field){const s=this.copySyncFields.fields[e.type].filter((e=>e.value==t.value));s.length&&(e.selected=s[0],e.product_comparison=!!t?.compare)}}))}))},fillCopySyncFields(){const e=this.$store.state.account.syncFields,t=e.fields,s=[];Object.entries(t).forEach((e=>{const t=[{name:"Не выбрано",value:-1}];Object.entries(e[1]).forEach((e=>t.push({name:e[1],value:e[0]}))),s[e[0]]=t})),this.copySyncFields.fields=s;const l=e.amo_fields,i=[];Object.entries(l).forEach((e=>i.push({name:e[1].name,type:e[1].type,fields:s[e[1].type],field:e[0],selected:{name:"Не выбрано",value:-1},disabled:0,product_comparison:!1}))),this.copySyncFields.amoFields=i},fillCopyProductLists(){const e=[{name:"Не выбрано",value:-1}];Object.entries(this.productLists).forEach((t=>e.push({name:t[1],value:t[0]}))),this.copyProductLists=e},searchSelectedAmoProductList(){this.copyProductLists.forEach((e=>{e.value==this.copyConfing.amo_product_list&&(this.selectedAmoProductList=e)}))},optionSelectSync(e,t){-1==e.value?this.copyConfing[t]="0":this.copyConfing[t]=e.value,"amo_leads_group_hide"==t&&(this.selectedAmoLeadsGroupHide=e),"amo_product_list"==t&&(this.selectedAmoProductList=e)},fillAmoLeadsGroupHide(){this.amoLeadsGroupHide.push({name:"Не выбрано",value:""}),this.copyLeadFieldsList.forEach((e=>{this.amoLeadsGroupHide.push({name:e.name,value:e.value})}))},searchSelectedAmoLeadsGroupHide(){this.leadFieldGroupsList.forEach((e=>{e.value==this.copyConfing?.amo_leads_group_hide&&(this.selectedAmoLeadsGroupHide=e)}))},searchAutosyncProducts(){this.autosyncProducts[0].productValue=!!this.account?.config?.auto_sync_products_gs_amo,this.autosyncProducts[1].productValue=!!this.account?.config?.auto_sync_products_amo_gs,this.autosyncProducts[0].listProductValue=!!this.account?.config?.auto_sync_orders_gs_amo,this.autosyncProducts[1].listProductValue=!!this.account?.config?.auto_sync_orders_amo_gs},selectProductComparisonField(e){this.productComparisonSelectedField=e}}};const zn=(0,P.Z)(Bn,[["render",Yn],["__scopeId","data-v-055b608a"]]);var Kn=zn;const Rn=e=>((0,l.dD)("data-v-bcfaae62"),e=e(),(0,l.Cn)(),e),Gn={class:"wrapper"},Jn={class:"container"},Xn=Rn((()=>(0,l._)("div",{class:"header"},[(0,l._)("label",null,"Перенос товаров")],-1))),Qn={class:"content"},ec={class:"table"},tc={class:"row title"},sc={class:"item"},lc=["onUpdate:modelValue"],ic={class:"item"},oc=["onUpdate:modelValue"],ac={class:"item"},nc={class:"select_input"},cc={class:"item"},dc={class:"select_input"},rc={class:"item"},_c={class:"select_input"},uc={class:"item"},pc=["onUpdate:modelValue","max","disabled"],hc={class:"item"},mc=["onUpdate:modelValue","disabled"],fc={class:"item"},vc=["onClick"],gc={class:"w-full my-2 flex justify-end items-center"},wc={class:"footer"};function bc(e,t,s,o,a,n){const c=(0,l.up)("AppInputSelect"),d=(0,l.up)("selector-vue"),r=(0,l.up)("btns-save-close");return(0,l.wg)(),(0,l.iD)("div",Gn,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close_modal())}),(0,l._)("div",Jn,[Xn,(0,l._)("div",Qn,[(0,l._)("table",ec,[(0,l._)("thead",null,[(0,l._)("tr",tc,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.title,(e=>((0,l.wg)(),(0,l.iD)("td",{class:"item",key:e},(0,b.zw)(e),1)))),128))])]),(0,l._)("tbody",null,[(0,l.Wm)(i.W3,{name:"row"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.itemsForMove,((s,o)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:s},[(0,l._)("td",sc,[s.isNew?((0,l.wg)(),(0,l.j4)(c,{key:0,list:a.autocomplete.list,countLettersReq:3,onChangeInputValue:t[1]||(t[1]=e=>a.autocomplete.getList("article",e)),onSelect:e=>n.autocompleteSelect(e,o)},null,8,["list","onSelect"])):(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:1,type:"text","onUpdate:modelValue":e=>s.fields.article=e,class:"input",disabled:""},null,8,lc)),[[i.nr,s.fields.article]])]),(0,l._)("td",ic,[s.isNew?((0,l.wg)(),(0,l.j4)(c,{key:0,list:a.autocomplete.list,countLettersReq:3,onChangeInputValue:t[2]||(t[2]=e=>a.autocomplete.getList("name",e)),onSelect:e=>n.autocompleteSelect(e,o)},null,8,["list","onSelect"])):(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:1,type:"text","onUpdate:modelValue":e=>s.fields.name=e,class:"input",disabled:""},null,8,oc)),[[i.nr,s.fields.name]])]),(0,l._)("td",ac,[(0,l._)("div",nc,[(0,l.Wm)(d,{options_props:[],onSelect:e.option_select1,selected_option:{name:s.fields?.batch,value:-1},disabled:!0},null,8,["onSelect","selected_option"])])]),(0,l._)("td",cc,[(0,l._)("div",dc,[(0,l.Wm)(d,{options_props:n.calcWhsOptions[s.id],onSelect:t[3]||(t[3]=(...e)=>n.option_select("cancel",...e)),selected_option:s.fields?.whToCancel,class:(0,b.C_)({not_valid_selector:-1==s.fields.whToCancel?.value&&a.try_accept}),disabled:s.isNew,idx:o},null,8,["options_props","selected_option","class","disabled","idx"])])]),(0,l._)("td",rc,[(0,l._)("div",_c,[(0,l.Wm)(d,{options_props:n.calcWhsOptions[s.id],onSelect:t[4]||(t[4]=(...e)=>n.option_select("move",...e)),selected_option:s.fields?.whToMove,class:(0,b.C_)({not_valid_selector:(s.fields.whToCancel?.value==s.fields.whToMove?.value||-1==s.fields.whToMove?.value)&&a.try_accept}),disabled:s.isNew,idx:o},null,8,["options_props","selected_option","class","disabled","idx"])])]),(0,l._)("td",uc,[(0,l.wy)((0,l._)("input",{type:"number","onUpdate:modelValue":e=>s.fields.countToMove=e,max:s.fields?.countToMove?.count,class:(0,b.C_)(["input",{not_valid:""==s.fields?.countToMove&&a.try_accept}]),disabled:s.isNew},null,10,pc),[[i.nr,s.fields.countToMove]])]),(0,l._)("td",hc,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":e=>s.fields.rison=e,class:(0,b.C_)(["input",{not_valid:""==s.fields?.rison&&a.try_accept}]),disabled:s.isNew},null,10,mc),[[i.nr,s.fields.rison]])]),(0,l._)("td",fc,[(0,l._)("button",{class:"del_btn",onClick:e=>n.delItem(o)},null,8,vc)])])))),128))])),_:1})])]),(0,l._)("div",gc,[(0,l._)("button",{class:"add_new_button",onClick:t[5]||(t[5]=e=>n.pushNewItem())},"+")])]),(0,l._)("div",wc,[(0,l.Wm)(r,{onClose:n.close_modal,onSave:n.save},null,8,["onClose","onSave"])])])])}var yc=s(5477),kc={components:{SelectorVue:ke.Z,AppInputSelect:yc.Z,BtnsSaveClose:q.Z},props:{currentItems:{type:Array,required:!0,default(){return[]}}},data(){return{title:["Артикул","Название","№ партии","Склад (откуда)","Склад (куда)","Кол-во","Причина списания",""],itemsForMove:[],whs_options:[],try_accept:!1,autocomplete:{list:[],value:"",getList:async function(e,t){this.value=t;const s=await Z.Z.dispatch("autocomplete_"+e,this.value);void 0!=s&&(this.list=[...s],this.list.map((t=>{t.name=t.fields[e],t.value=t.id})))}}}},async mounted(){await Promise.all([this.$store.dispatch("get_fields_properties"),this.$store.dispatch("get_all_fields")]),(0,l.Y3)((()=>{this.itemsForMove=[...this.currentItems],this.itemsForMove.map((e=>{e.fields.countToMove=0,e.fields.rison="",e.fields.whs_options=[],e.fields.whToCancel={name:"Не выбрано",value:-1},e.fields.whToMove={name:"Не выбрано",value:-1}})),this.fillWhs()}))},computed:{fields(){return this.$store.state.fields.all_fields},itemsCountToMove(){const e=[];return this.itemsForMove.forEach((t=>e.push(t.fields.countToMove))),e},allow_add_reserve(){return this.$store.state.account.account.config.allow_add_reserve},calcWhsOptions(){const e={};return this.itemsForMove.forEach((t=>{const s=[];t.fields.whs_options.forEach((e=>{const l={};if(t.fields[e.value]){const s=this.allow_add_reserve?t.fields[e.value].count:t.fields[e.value].count-t.fields[e.value].reserve;l.name=e.name+" | "+s,l.value=e.value}s.push(l)})),e[t.id]=s})),e}},watch:{itemsCountToMove:{handler:function(){this.itemsForMove.map((e=>{if(e.fields.whToCancel){const t=e.fields?.[e.fields.whToCancel?.value]?.count;e.fields.countToMove>t&&(e.fields.countToMove=t),e.fields.countToMove<0&&(e.fields.countToMove=0)}}))},deep:!0}},methods:{delItem(e){this.itemsForMove.splice(e,1)},autocompleteSelect(e,t){e.fields.countToMove=0,e.fields.rison="",e.fields.whs_options=[],e.fields.whToCancel={name:"Не выбрано",value:-1},e.fields.whToMove={name:"Не выбрано",value:-1},this.itemsForMove.splice(t,1,e),this.fillWhs()},pushNewItem(){this.itemsForMove.push({isNew:!0,fields:{countToMove:0,rison:"",whs_options:[],whToCancel:{name:"Не выбрано",value:-1},whToMove:{name:"Не выбрано",value:-1}}})},fillWhs(){this.fields.filter((e=>13==e.type&&"whs"!=e.code)).forEach((e=>this.whs_options.push({name:e.name,value:e.code}))),this.itemsForMove.map((e=>{e.fields.whs_options=this.searchCatArr(this.whs_options,this.searchParentsCat(e.fields.category))}))},async save(){this.try_accept=!0;let e=!0;if(this.itemsForMove.forEach((t=>{e=e&&""!=t.fields.countToMove&&""!=t.fields.rison&&void 0!=t.fields.countToMove&&void 0!=t.fields.rison&&t.fields.whToCancel.value!=t.fields.whToMove.value&&-1!=t.fields.whToCancel.value&&-1!=t.fields.whToMove.value})),e){const e={products:[]};this.itemsForMove.forEach((t=>{const s={id:t.id,wh_from:t.fields.whToCancel.value,wh_to:t.fields.whToMove.value,count:t.fields.countToMove,comment:t.fields.rison};e.products.push(s)})),await this.$store.dispatch("transfer_product",e),this.close_modal()}},searchCatArr(e,t){const s=[];return e.forEach((e=>{t.includes(this.fields.find((t=>e.value==t.code)).category_id)&&s.push(e)})),s},searchParentsCat(e){let t=[];this.$store.state.categories.fields_properties.forEach((s=>{s.id==e&&(t=[...s.levels])}));const s=t.indexOf(0);return t=t.slice(0,s),t},close_modal(){this.try_accept=!1,this.$emit("close"),this.$store.commit("openCloseMoveProductsBetweenWhs",!1)},option_select(e,t,s){"cancel"==e&&(this.itemsForMove[s].fields.whToCancel=t,this.itemsForMove[s].fields.countToMove=0),"move"==e&&(this.itemsForMove[s].fields.whToMove=t)}}};const Cc=(0,P.Z)(kc,[["render",bc],["__scopeId","data-v-bcfaae62"]]);var Sc=Cc;const Dc=e=>((0,l.dD)("data-v-46cbee86"),e=e(),(0,l.Cn)(),e),xc={class:"wrapper"},Tc={class:"bgc"},Fc={class:"header"},Uc=Dc((()=>(0,l._)("h1",null,"Настройки импорта",-1))),Vc={class:"main"},qc={class:"small"},Lc={class:"top"},Ic={class:"template"},Zc={key:0,class:"compare"},Wc={class:"table",ref:"gridRef"},Oc=["id","onUpdate:modelValue"],Pc=["for"],Nc=["id","onUpdate:modelValue"],Ec=["for"],Hc={class:"footer"},$c=(0,l.Uk)("Импортировать");function Mc(e,t,s,o,a,n){const c=(0,l.up)("SelectorVue"),d=(0,l.up)("ImportStuffSelector"),r=(0,l.up)("BtnsSaveClose");return(0,l.wg)(),(0,l.iD)("div",xc,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>o.close())}),(0,l._)("div",Tc,[(0,l._)("header",Fc,[Uc,(0,l._)("button",{class:"btn cross",onClick:t[1]||(t[1]=e=>o.close())})]),(0,l._)("main",Vc,[(0,l._)("small",qc," Максимальное количество товаров в файле: "+(0,b.zw)(o.max_import_product),1),(0,l._)("div",Lc,[(0,l._)("div",Ic,[(0,l.Wm)(c,{options_props:o.templates.list,selected_option:o.templates.selected,onSelect:o.selectTemplate},null,8,["options_props","selected_option","onSelect"]),o.templates.selected.showTemplateName?(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:0,class:"input",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>o.templates.newTemplateName=e),title:"Чтобы не сохранять шаблон оставте поле пустым"},null,512)),[[i.nr,o.templates.newTemplateName]]):(0,l.kq)("",!0)]),o.isAnyCompares?((0,l.wg)(),(0,l.iD)("div",Zc,[(0,l.Wm)(c,{options_props:o.addOrUpdateFields.list,selected_option:o.templates.selected.addOrUpdateFields.selected,onSelect:o.addOrUpdateFields.select},null,8,["options_props","selected_option","onSelect"])])):(0,l.kq)("",!0)]),(0,l._)("div",Wc,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.tableData,((e,t)=>((0,l.wg)(),(0,l.iD)(l.HY,null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e,(e=>((0,l.wg)(),(0,l.iD)("div",{class:(0,b.C_)(["item",{title:0==t}]),key:e},(0,b.zw)(null===e||void 0===e?e:String(e).slice(0,200)),3)))),128))],64)))),256)),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.gridCount,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"item",key:e},[(0,l.Wm)(d,{options_props:o.importStuffFields,selected_option:o.selectedFields?o.selectedFields[e-1]:{},onToggleShowOptions:o.toggleShowOptions,onSelect:t=>o.selectStuffField(t,e-1)},null,8,["options_props","selected_option","onToggleShowOptions","onSelect"]),-1!==o.selectedFields[e-1]?.value?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"ImportStuffCompares"+e,"onUpdate:modelValue":t=>o.templates.selected.compares[e-1]=t,onChange:t[3]||(t[3]=e=>o.checkIsSavedTemplate())},null,40,Oc),[[i.e8,o.templates.selected.compares[e-1]]]),(0,l._)("label",{for:"ImportStuffCompares"+e}," Сравнивать поле ",8,Pc)],64)):(0,l.kq)("",!0),o.selectedFields[e-1]?.isList?((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:"ImportStuffListAdd"+e,"onUpdate:modelValue":t=>o.selectedFields[e-1].listAdd=t,onChange:t[4]||(t[4]=e=>o.checkIsSavedTemplate())},null,40,Nc),[[i.e8,o.selectedFields[e-1].listAdd]]),(0,l._)("label",{for:"ImportStuffListAdd"+e}," Добавлять новые значения ",8,Ec)],64)):(0,l.kq)("",!0)])))),128))],512)]),(0,l._)("footer",Hc,[(0,l.Wm)(r,{onClose:o.close,onSave:o.save,disabledSave:o.noOneSelectedFields||o.disabledSave},{save:(0,l.w5)((()=>[$c])),_:1},8,["onClose","onSave","disabledSave"])])])])}function Ac(){const e=(0,I.qj)([]),t=(0,I.qj)([]),s=async()=>{t.push({name:"Не импортировать поле",value:-1,code:"not to import"}),await Z.Z.dispatch("get_types");const e=Z.Z.state.fields.types,s=Object.entries(await Z.Z.dispatch("importStuffFields"));s.forEach((s=>{t.push({name:e[s[0]],value:"optgroup"});const l=5==s[0]||6==s[0];s[1].map((e=>{e.value=e.code,e.optgroup=!0,e.isList=l,l&&(e.listAdd=!1)})),t.push(...s[1])}))};s();const l=s=>{for(let l=0;l<s;l++)e.push(t[0])};return{selectedImportStuffFields:e,importStuffFields:t,fillSelectedImportStuffFields:l}}var jc=s(2524);const Yc={components:{SelectorVue:ke.Z,ImportStuffSelector:Ut,BtnsSaveClose:q.Z},setup(){const{addNotification:e}=(0,jc.l)(),{selectedImportStuffFields:t,importStuffFields:s,fillSelectedImportStuffFields:i}=Ac(),o=(0,I.qj)({newTemplateName:"",selected:{name:"Без шаблона",value:0,showTemplateName:!1,compares:[],selectedFields:[],addOrUpdateFields:{selected:{name:"Только добавлять",value:"add"}}},list:[{name:"Без шаблона",value:0,showTemplateName:!1,compares:[],selectedFields:[],addOrUpdateFields:{selected:{name:"Только добавлять",value:"add"}}},{name:"Новый шаблон",value:1,showTemplateName:!0,compares:[],selectedFields:[],addOrUpdateFields:{selected:{name:"Только добавлять",value:"add"}}}]});(0,l.YP)(o,(()=>o.selected?.showTemplateName?null:o.newTemplateName=""));const a=(0,l.Fl)((()=>o.selected.selectedFields)),n=(0,l.Fl)((()=>a.value.every((e=>-1===e.value))));o.selected=o.list[0],o.list.find((e=>1==e.value)).selectedFields=t,o.list.find((e=>0==e.value)).selectedFields=t;const c=(0,I.iH)("false"),d=e=>{c.value=!0,o.selected=JSON.parse(JSON.stringify(e)),(0,l.Y3)((()=>c.value=!1))};(0,l.bv)((async()=>{const e=await Z.Z.dispatch("importStuffTemplates");e.map((e=>{e.addOrUpdateFields={selected:k.searchOptionByValue(e.mode)},e.showTemplateName=!1,e.value=Math.round(1e5*Math.random()),e.selectedFields=e.fields,e.compares=[],e.selectedFields?.map((t=>{""===t.name&&""===t.code||null===t.name&&null===t.code?(t.name="Не импортировать поле",t.value=-1,t.code="not to import"):(t.value=t.code,void 0!=t.add&&(t.listAdd=t.add,t.isList=!0)),e.compares.push(t.compare)}));const t=h-e.selectedFields.length;if(t>0)for(let s=0;s<t;s++)e.selectedFields.push({name:"Не импортировать поле",value:-1,code:"not to import"});o.list.push(e)}))}));const r=(0,l.Fl)((()=>0!==o.selected.value&&1!==o.selected.value)),_=(0,I.iH)(null),u=(0,l.Fl)((()=>Z.Z.state.products.importStuff)),p=(0,l.Fl)((()=>u.value.data)),h=p.value[0].length;i(h);const m=e=>{_.value.style.overflowX=e?"hidden":"scroll"},f=()=>{if(r.value&&!c.value){o.newTemplateName=o.selected.name;const e=o.selected;o.selected=o.list.find((e=>1==e.value)),o.selected.compares=[...e.compares],o.selected.selectedFields=[...e.selectedFields],o.selected.addOrUpdateFields.selected=e.addOrUpdateFields.selected}},v=(e,t)=>{f(),o.selected.selectedFields[t]=e},g=()=>Z.Z.commit("openCloseImportStuff"),w=()=>{b.value=!0;const t=[];o.selected.selectedFields.forEach(((e,s)=>{const l={name:e.name,code:e.code,compare:!!o.selected.compares[s]};e.isList&&(l["add"]=e.listAdd),-1!==e.value?t.push(l):t.push({name:"",code:""})}));const s={file:u.value.file,isNewTemplate:1==o.selected.value&&""!==o.newTemplateName,selectedFields:t,addOrUpdateFields:o.selected.addOrUpdateFields.selected.value};0!==o.selected.value&&""!==o.newTemplateName&&(s["templateName"]=o.newTemplateName?o.newTemplateName:o.selected.name),Z.Z.dispatch("importStart",s),e(0,"Добавлена задача","Импорт товаров"),g(),b.value=!1},b=(0,I.iH)(!1),y=(0,l.Fl)((()=>o.selected.compares.some((e=>e)))),k=(0,I.qj)({list:[{name:"Только добавлять",value:"add"},{name:"Только обновлять",value:"update"},{name:"Добавлять и обновлять",value:"add_update"}],select:e=>(o.selected.addOrUpdateFields.selected=e,f()),searchOptionByValue:e=>k.list.find((t=>t.value==e))}),C=(0,l.Fl)((()=>Z.Z.state.account?.account?.max_import_product));return{gridCount:h,templates:o,selectTemplate:d,close:g,toggleShowOptions:m,gridRef:_,tableData:p,selectStuffField:v,selectedImportStuffFields:t,importStuffFields:s,save:w,isAnyCompares:y,addOrUpdateFields:k,checkIsSavedTemplate:f,selectedFields:a,noOneSelectedFields:n,max_import_product:C,disabledSave:b}}},Bc=()=>{(0,i.sj)((e=>({"142a0194":e.gridCount})))},zc=Yc.setup;Yc.setup=zc?(e,t)=>(Bc(),zc(e,t)):Bc;var Kc=Yc;const Rc=(0,P.Z)(Kc,[["render",Mc],["__scopeId","data-v-46cbee86"]]);var Gc=Rc;const Jc=e=>((0,l.dD)("data-v-1ed001c6"),e=e(),(0,l.Cn)(),e),Xc={class:"wrapper"},Qc={class:"container"},ed={class:"header"},td=Jc((()=>(0,l._)("label",null,"Настройки аккаунта",-1))),sd=Jc((()=>(0,l._)("div",{class:"icon"},null,-1))),ld=[sd],id={class:"content"},od={class:"block"},ad=Jc((()=>(0,l._)("h6",{class:"my-9"},"Этапы резервирования товаров со склада",-1))),nd={class:"text"},cd=Jc((()=>(0,l._)("label",{for:"asd1"},"Разделять права",-1))),dd={class:"footer"};function rd(e,t,s,o,a,n){const c=(0,l.up)("BtnsSaveClose");return(0,l.wg)(),(0,l.iD)("div",Xc,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>o.close())}),(0,l._)("div",Qc,[(0,l._)("div",ed,[td,(0,l._)("button",{class:"btn_del",onClick:t[1]||(t[1]=e=>o.close())},ld)]),(0,l._)("div",id,[(0,l._)("div",od,[ad,(0,l._)("div",nd,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>o.divideRight=e),id:"asd1"},null,512),[[i.e8,o.divideRight]]),cd])])]),(0,l._)("div",dd,[(0,l.Wm)(c,{onSave:o.save,onClose:o.close},null,8,["onSave","onClose"])])])])}var _d={components:{BtnsSaveClose:q.Z},setup(){const e=(0,l.Fl)((()=>Z.Z.state.account.account)),t=(0,I.iH)(!1);(0,l.bv)((async()=>{await Z.Z.dispatch("get_account"),void 0!==e.value?.config?.divide_right&&(t.value=Boolean(e.value?.config?.divide_right))}));const s=async()=>{await Z.Z.dispatch("update_account",{divide_right:t.value}),await Z.Z.dispatch("get_account"),i()},i=()=>{Z.Z.commit("openCloseAccountSattings",!1)};return{divideRight:t,account:e,close:i,save:s}}};const ud=(0,P.Z)(_d,[["render",rd],["__scopeId","data-v-1ed001c6"]]);var pd=ud;const hd=e=>((0,l.dD)("data-v-59ff3212"),e=e(),(0,l.Cn)(),e),md={class:"wrapper"},fd={class:"container"},vd={class:"header"},gd=hd((()=>(0,l._)("label",null,"Настройки полей клиентов",-1))),wd=hd((()=>(0,l._)("div",{class:"icon"},null,-1))),bd=[wd],yd={class:"content"},kd={class:"footer"},Cd=(0,l.Uk)("Назад");function Sd(e,t,s,i,o,a){const n=(0,l.up)("AppRadioBtnsGroupUnderlined"),c=(0,l.up)("ClientsFieldsSettingsTable"),d=(0,l.up)("BtnsSaveClose");return(0,l.wg)(),(0,l.iD)("div",md,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>i.close())}),(0,l._)("div",fd,[(0,l._)("div",vd,[gd,(0,l._)("button",{class:"btn_del",onClick:t[1]||(t[1]=e=>i.close())},bd)]),(0,l._)("div",yd,[(0,l.Wm)(n,{class:"w-1/2 mx-auto",list:i.tabs.list,selected:i.tabs.selected,onSelect:t[2]||(t[2]=e=>i.tabs.select(e))},null,8,["list","selected"]),(0,l.Wm)(c,{selectedTab:i.tabs.selected},null,8,["selectedTab"])]),(0,l._)("div",kd,[(0,l.Wm)(d,{onSave:i.save,onClose:i.close,show_save:!1},{close:(0,l.w5)((()=>[Cd])),_:1},8,["onSave","onClose"])])])])}var Dd=s(906);const xd=e=>((0,l.dD)("data-v-00c26118"),e=e(),(0,l.Cn)(),e),Td={class:"relative mb-14"},Fd={class:"rows"},Ud={class:"row"},Vd=xd((()=>(0,l._)("th",{class:"item item_field title"},[(0,l._)("span",null,"Поле")],-1))),qd=xd((()=>(0,l._)("th",{class:"item item_type"},"Тип",-1))),Ld={class:"item"},Id={class:"item"},Zd={key:0},Wd=["onUpdate:modelValue","onKeyup","onChange"],Od={class:"item selectors"},Pd={key:0,class:"type_selector_options"},Nd=["onUpdate:modelValue","onChange"],Ed=["onClick"],Hd=["onClick"],$d={class:"item del_sell"},Md=["onClick"],Ad=["onClick"],jd={class:"item"},Yd=["onUpdate:modelValue","onKeyup"],Bd={class:"item selectors"},zd={key:0,class:"type_selector_options"},Kd=["onUpdate:modelValue"],Rd=["onClick"],Gd=["onClick"],Jd={class:"item del_sell"},Xd=["onClick"],Qd=["onClick"];function er(e,t,s,o,a,n){const c=(0,l.up)("SelectorVue");return(0,l.wg)(),(0,l.iD)("div",Td,[(0,l._)("table",Fd,[(0,l._)("tr",Ud,[Vd,qd,(0,l._)("th",Ld,[o.showUpdateAllFieldsBtn?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save_all btn_yellow",onClick:t[0]||(t[0]=e=>o.updateAllFields())}," Сохранить все поля ")):(0,l.kq)("",!0)])]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.copy_fields,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{class:(0,b.C_)(["row",{load:o.is_loading}]),key:e.id},[(0,l._)("td",Id,[e.is_system?((0,l.wg)(),(0,l.iD)("span",Zd,(0,b.zw)(e.name),1)):(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:1,type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((e=>o.update_field(t,["name"])),["enter"]),onChange:t=>e.changeName=!0},null,42,Wd)),[[i.nr,e.name]])]),(0,l._)("td",Od,[(0,l.Wm)(c,{options_props:o.types,onSelect:o.option_select_type,selected_option:o.search_type(e.type),disabled:!0,idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==e.type||6==e.type?((0,l.wg)(),(0,l.iD)("div",Pd,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:a},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[a]=t,onChange:t=>e.changeData=!0},null,40,Nd),[[i.nr,e.data[a]]]),(0,l._)("button",{class:"del_button",onClick:s=>(o.remove_selector_option(t,a),e.changeData=!0)},null,8,Ed)])))),128)),(0,l._)("button",{onClick:s=>(o.add_selector_option(t),e.changeData=!0),class:"add_button"},null,8,Hd)])):(0,l.kq)("",!0)]),(0,l._)("td",$d,[(0,l.wy)((0,l._)("button",{class:"del_btn",onClick:t=>o.delete_field(e.id)},null,8,Md),[[i.F8,!e.is_system]]),e.changeName||e.changeData||e.changeLeadConfig||e.changeConfig?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>o.update_field(t,[e.changeName?"name":null,e.changeData?"data":null,e.changeLeadConfig?"lead_config":null,e.changeConfig?"config":null])}," Сохранить ",8,Ad)):(0,l.kq)("",!0)])],2)))),128)),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.new_fields,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:e.id},[(0,l._)("td",jd,[(0,l.wy)((0,l._)("input",{type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((s=>o.add_new(e,t)),["enter"])},null,42,Yd),[[i.nr,e.name]])]),(0,l._)("td",Bd,[(0,l.Wm)(c,{options_props:o.types,onSelect:o.option_select_new_field_type,selected_option:o.search_type(e.type),idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==o.new_fields[t].type||6==o.new_fields[t].type?((0,l.wg)(),(0,l.iD)("div",zd,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:a},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[a]=t},null,8,Kd),[[i.nr,e.data[a]]]),(0,l._)("button",{class:"del_button",onClick:e=>o.remove_new_fields_selector_option(t,a)},null,8,Rd)])))),128)),(0,l._)("button",{onClick:e=>o.add_new_fields_selector_option(t),class:"add_button"},null,8,Gd)])):(0,l.kq)("",!0)]),(0,l._)("td",Jd,[(0,l._)("button",{class:"del_btn",onClick:e=>o.delete_new_field(t)},null,8,Xd),""!=e.name?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>o.add_new(e,t)}," Сохранить ",8,Qd)):(0,l.kq)("",!0)])])))),128))]),(0,l._)("button",{onClick:t[1]||(t[1]=e=>o.add_new_field()),class:"add_new_button"})])}var tr={components:{SelectorVue:ke.Z},props:{selectedTab:Object},setup(e){const t=(0,I.qj)([]),s=(0,I.qj)([]),i=(0,I.iH)(!1),o=()=>{t.map(((e,t)=>{const s=e.changeName||e.changeData;s&&a(t,[e.changeName?"name":null,e.changeData?"data":null]),e.changeName=!1,e.changeData=!1}))},a=async(s,l)=>{const i={};i["id"]=t[s]["id"],l.forEach((e=>{null!=e&&(i[e]=t[s][e])})),t[s]?.is_system&&delete i?.name;const o=await Z.Z.dispatch(`updateClients${e.selectedTab.value}Field`,i),a="This field name exist."==o?.error;t[s]["nameError"]=a,o?.error||(t[s].changeName=!1,t[s].changeData=!1)};(0,l.bv)((()=>{n()}));const n=async()=>{i.value=!0,await Z.Z.dispatch(`getClients${e.selectedTab.value}Types`),h(),setTimeout((()=>{i.value&&(i.value=!1)}),5e3)},c=(0,l.Fl)((()=>e.selectedTab));(0,l.YP)(c,(()=>{n()}));const d=(0,l.Fl)((()=>{let e=!1;return t.forEach((t=>{e=e||t.changeName||t.changeData})),e})),r=(0,l.Fl)((()=>{const t=[];return Object.entries(Z.Z.state[`clients${e.selectedTab.value}`].types).forEach((([e,s])=>{t.push({name:s,value:e})})),t})),_=(0,l.Fl)((()=>1==Z.Z.state.account?.account?.id)),u=()=>{const e={id:t.length+1,type:3,name:"",data:[],nameError:!1};s.push(e)},p=async(t,l)=>{const i={type:t.type,name:t.name,data:t.data},o=await Z.Z.dispatch(`addClients${e.selectedTab.value}Field`,i),a="This field name exist."==o?.error;a&&(s[l]["nameError"]=!0),o?.error||(s.splice(s.indexOf(t),1),h())},h=async()=>{i.value=!0,await Z.Z.dispatch(`getClients${e.selectedTab.value}Fields`),t.length=0,Object.assign(t,[...Z.Z.state[`clients${e.selectedTab.value}`].fields]),t.map((e=>{e["nameError"]=!1,e["changeName"]=!1,e["changeData"]=!1})),i.value=!1},m=e=>r.value.find((t=>t.value==e)),f=e=>{s.splice(e,1)},v=async t=>{await Z.Z.dispatch(`deleteClients${e.selectedTab.value}Field`,t),h()},g=(e,s)=>{t[s].type=e},w=(e,t)=>{s[t].type=e.value},b=e=>{null==t[e].data&&(t[e].data=[]),t[e].data.push("")},y=(e,s)=>{t[e].data.splice(s,1)},k=e=>{s[e].data.push("")},C=(e,t)=>{s[e].data.splice(t,1)};return{copy_fields:t,new_fields:s,is_loading:i,updateAllFields:o,update_field:a,showUpdateAllFieldsBtn:d,types:r,isTest:_,add_new_field:u,add_new:p,get_fields:h,search_type:m,delete_new_field:f,delete_field:v,option_select_type:g,option_select_new_field_type:w,add_selector_option:b,remove_selector_option:y,add_new_fields_selector_option:k,remove_new_fields_selector_option:C}}};const sr=(0,P.Z)(tr,[["render",er],["__scopeId","data-v-00c26118"]]);var lr=sr,ir=s(6963),or={components:{BtnsSaveClose:q.Z,AppRadioBtnsGroupUnderlined:Dd.Z,ClientsFieldsSettingsTable:lr},setup(){const{tabs:e}=(0,ir.j)();(0,l.bv)((async()=>{}));const t=()=>{s()},s=()=>{Z.Z.commit("openCloseClientsFieldsSettings",!1)};return{close:s,save:t,tabs:e}}};const ar=(0,P.Z)(or,[["render",Sd],["__scopeId","data-v-59ff3212"]]);var nr=ar;const cr=e=>((0,l.dD)("data-v-22264065"),e=e(),(0,l.Cn)(),e),dr={class:"wrapper"},rr={class:"container"},_r={class:"header"},ur=cr((()=>(0,l._)("label",null,"Настройки сущностей",-1))),pr=cr((()=>(0,l._)("div",{class:"icon"},null,-1))),hr=[pr],mr={class:"content"},fr={key:1,class:"w-full"},vr={class:"footer"},gr=(0,l.Uk)("Назад");function wr(e,t,s,i,o,a){const n=(0,l.up)("AppRadioBtnsGroupUnderlined"),c=(0,l.up)("SettingEntitiesCategories"),d=(0,l.up)("SettingEntitiesStatuses"),r=(0,l.up)("SettingEntitiesFieldsProperties"),_=(0,l.up)("SettingEntitiesTable"),u=(0,l.up)("BtnsSaveClose");return(0,l.wg)(),(0,l.iD)("div",dr,[(0,l._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>i.close())}),(0,l._)("div",rr,[(0,l._)("div",_r,[ur,(0,l._)("button",{class:"close",onClick:t[1]||(t[1]=e=>i.close())},hr)]),(0,l._)("div",mr,[(0,l.Wm)(n,{class:"w-full mx-auto",list:i.tabs.list,selected:i.tabs.selected,onSelect:t[2]||(t[2]=e=>{i.tabs.select(e),i.closeAllSubTabs()})},null,8,["list","selected"]),i.showCategories?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[i.tabs.selected.haveCategories?((0,l.wg)(),(0,l.j4)(c,{key:0,onToggleCategories:i.toggleCategories},null,8,["onToggleCategories"])):(0,l.kq)("",!0)],64)):i.showStatuses?((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[i.tabs.selected.haveStatuses?((0,l.wg)(),(0,l.j4)(d,{key:0,onToggleStatuses:i.toggleStatuses},null,8,["onToggleStatuses"])):(0,l.kq)("",!0)],64)):((0,l.wg)(),(0,l.iD)(l.HY,{key:2},[i.tabs.selected.haveFieldsProperties?((0,l.wg)(),(0,l.j4)(r,{key:0,onToggleCategories:i.toggleCategories},null,8,["onToggleCategories"])):(0,l.kq)("",!0),i.tabs.selected.haveStatuses&&!i.showStatuses?((0,l.wg)(),(0,l.iD)("div",fr,[(0,l._)("button",{class:"btn pointer-events-auto w-full relative inline-flex justify-center rounded-md bg-white text-[0.8125rem] font-medium leading-5 text-slate-700 shadow-sm ring-1 ring-slate-700/10 hover:bg-slate-50 hover:text-slate-900",onClick:t[3]||(t[3]=e=>i.toggleStatuses(!0))}," Статусы ")])):(0,l.kq)("",!0),((0,l.wg)(),(0,l.j4)(_,{selectedTab:i.tabs.selected,key:i.tabs.selected.value},null,8,["selectedTab"]))],64))]),(0,l._)("div",vr,[(0,l.Wm)(u,{onSave:i.save,onClose:i.close,show_save:!1},{close:(0,l.w5)((()=>[gr])),_:1},8,["onSave","onClose"])])])])}const br=e=>((0,l.dD)("data-v-295e77b5"),e=e(),(0,l.Cn)(),e),yr={class:"relative mb-14 mt-7"},kr={class:"rows"},Cr={class:"row"},Sr={key:0,class:"item_sort"},Dr=br((()=>(0,l._)("th",{class:"item item_field title"},[(0,l._)("div",{class:"copy_fields"},[(0,l._)("span",null,"Поле")])],-1))),xr=br((()=>(0,l._)("th",{class:"item item_type"},"Тип",-1))),Tr={key:1,class:"item item_icon title"},Fr={class:"w-min mx-auto"},Ur=br((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," visibility ",-1))),Vr={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},qr={key:2,class:"item item_icon title"},Lr={class:"w-min mx-auto"},Ir=br((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," edit ",-1))),Zr={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},Wr={key:3,class:"item item_icon title"},Or={class:"w-min mx-auto"},Pr=br((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," title ",-1))),Nr={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},Er={key:0,class:"item item_icon title"},Hr={class:"w-min mx-auto"},$r=br((()=>(0,l._)("span",{class:"material-icons-outlined opacity-50"}," content_copy ",-1))),Mr={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},Ar={key:0,class:"item item_icon title"},jr={class:"w-min mx-auto"},Yr=br((()=>(0,l._)("span",{class:"material-icons-round opacity-50"}," segment ",-1))),Br={key:0,class:"absolute top-[120%] bg-slate-700 text-slate-100 text-xs p-2 rounded-md z-10"},zr={class:"item"},Kr={key:0,class:"p-[10px] border border-[#c9c9c9] w-min"},Rr={class:"flex flex-row"},Gr=["disabled","onClick"],Jr=["disabled","onClick"],Xr={class:"item"},Qr={key:0},e_=["onUpdate:modelValue","onKeyup","onInput"],t_={class:"item selectors"},s_={key:0,class:"type_selector_options"},l_=["onUpdate:modelValue","onChange"],i_=["onClick"],o_=["onClick"],a_={key:1,class:"box item text-lg"},n_=["id","disabled","onUpdate:modelValue","onChange"],c_=["for"],d_={key:2,class:"box item text-lg"},r_=["id","disabled","onUpdate:modelValue","onChange"],__=["for"],u_={key:3,class:"box item text-lg"},p_=["id","disabled","onUpdate:modelValue","onChange"],h_=["for"],m_={key:0,class:"box item text-lg"},f_=["id","disabled","onUpdate:modelValue","onChange"],v_=["for"],g_=["onClick"],w_=br((()=>(0,l._)("span",{id:"catBtn",class:"material-icons-round opacity-70",style:{"font-size":"20px"}}," open_in_full ",-1))),b_=[w_],y_={class:"item del_sell"},k_=["onClick"],C_=["onClick"],S_={key:0,class:"p-[10px] border border-[#c9c9c9]"},D_={class:"item"},x_=["onUpdate:modelValue","onKeyup"],T_={class:"item selectors"},F_={key:0,class:"type_selector_options"},U_=["onUpdate:modelValue"],V_=["onClick"],q_=["onClick"],L_={key:1,class:"box item text-lg"},I_=["id","disabled","onUpdate:modelValue"],Z_=["for"],W_={key:2,class:"box item text-lg"},O_=["id","disabled","onUpdate:modelValue"],P_=["for"],N_={key:3,class:"box item text-lg"},E_=["id","disabled","onUpdate:modelValue"],H_=["for"],$_={key:0,class:"box item text-lg"},M_=["id","disabled","onUpdate:modelValue"],A_=["for"],j_=["onClick"],Y_=br((()=>(0,l._)("span",{id:"catBtn",class:"material-icons-round opacity-70",style:{"font-size":"20px"}}," open_in_full ",-1))),B_=[Y_],z_={class:"item del_sell"},K_=["onClick"],R_=["onClick"];function G_(e,t,s,o,a,n){const c=(0,l.up)("SelectorVue"),d=(0,l.up)("AppMultiSelect");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",yr,[(0,l._)("table",kr,[(0,l.Wm)(i.W3,{name:"list",mode:"out-in"},{default:(0,l.w5)((()=>[(0,l._)("tr",Cr,[o.isTest&&o.selectedFieldPropertyIsBasic&&s.selectedTab.haveSort?((0,l.wg)(),(0,l.iD)("th",Sr)):(0,l.kq)("",!0),Dr,xr,s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("th",Tr,[(0,l._)("div",Fr,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[0]||(t[0]=e=>o.toolTips.visibility=!0),onMouseleave:t[1]||(t[1]=e=>o.toolTips.visibility=!1)},[Ur,o.toolTips.visibility?((0,l.wg)(),(0,l.iD)("div",Vr," Видимость в сделке ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("th",qr,[(0,l._)("div",Lr,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[2]||(t[2]=e=>o.toolTips.edit=!0),onMouseleave:t[3]||(t[3]=e=>o.toolTips.edit=!1)},[Ir,o.toolTips.edit?((0,l.wg)(),(0,l.iD)("div",Zr," Редактирование в сделке ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("th",Wr,[(0,l._)("div",Or,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[4]||(t[4]=e=>o.toolTips.title=!0),onMouseleave:t[5]||(t[5]=e=>o.toolTips.title=!1)},[Pr,o.toolTips.title?((0,l.wg)(),(0,l.iD)("div",Nr," Заголовок товара в сделке ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:4},[s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("th",Er,[(0,l._)("div",Hr,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[6]||(t[6]=e=>o.toolTips.content_copy=!0),onMouseleave:t[7]||(t[7]=e=>o.toolTips.content_copy=!1)},[$r,o.toolTips.content_copy?((0,l.wg)(),(0,l.iD)("div",Mr," Дублировать в новые партии ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:5},[s.selectedTab.haveFieldsProperties?((0,l.wg)(),(0,l.iD)("th",Ar,[(0,l._)("div",jr,[(0,l._)("div",{class:"flex items-center relative",onMouseenter:t[8]||(t[8]=e=>o.toolTips.categories=!0),onMouseleave:t[9]||(t[9]=e=>o.toolTips.categories=!1)},[Yr,o.toolTips.categories?((0,l.wg)(),(0,l.iD)("div",Br," Привязка к категориям ")):(0,l.kq)("",!0)],32)])])):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),(0,l._)("th",zr,[o.showUpdateAllFieldsBtn?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save_all btn_yellow",onClick:t[10]||(t[10]=e=>o.updateAllFields())}," Сохранить все поля ")):(0,l.kq)("",!0)])]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.copy_fields,((e,t)=>(0,l.wy)(((0,l.wg)(),(0,l.iD)("tr",{class:(0,b.C_)(["row",{load:o.is_loading}]),key:e.id},[o.isTest&&o.selectedFieldPropertyIsBasic&&s.selectedTab.haveSort?((0,l.wg)(),(0,l.iD)("th",Kr,[(0,l._)("div",Rr,[(0,l._)("button",{class:"bar_item_icon bar_item_icon_up",disabled:0===t,onClick:e=>o.changeTitleSort(t,!0)},null,8,Gr),(0,l._)("button",{class:"bar_item_icon bar_item_icon_down",disabled:t===o.copy_fields.length-1,onClick:e=>o.changeTitleSort(t,!1)},null,8,Jr)])])):(0,l.kq)("",!0),(0,l._)("td",Xr,[e.is_system?((0,l.wg)(),(0,l.iD)("span",Qr,(0,b.zw)(e.name),1)):(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:1,type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((e=>o.update_field(t,["name"])),["enter"]),onInput:t=>1==e.changeName},null,42,e_)),[[i.nr,e.name]])]),(0,l._)("td",t_,[(0,l.Wm)(c,{options_props:o.types,onSelect:o.option_select_type,selected_option:o.search_type(e.type),disabled:!0,idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==e.type||6==e.type?((0,l.wg)(),(0,l.iD)("div",s_,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:a},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[a]=t,onChange:t=>1==e.changeData},null,40,l_),[[i.nr,e.data[a]]]),(0,l._)("button",{class:"del_button",onClick:s=>(o.remove_selector_option(t,a),1==e.changeData)},null,8,i_)])))),128)),(0,l._)("button",{onClick:s=>(o.add_selector_option(t),1==e.changeData),class:"add_button"},null,8,o_)])):(0,l.kq)("",!0)]),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",a_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb",disabled:e.lead_config.visible.disabled,"onUpdate:modelValue":t=>e.lead_config.visible.value=t,onChange:t=>1==e.changeLeadConfig},null,40,n_),[[i.e8,e.lead_config.visible.value]]),(0,l._)("label",{for:t+"nb"},null,8,c_)])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",d_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n",disabled:e.lead_config.editable.disabled,"onUpdate:modelValue":t=>e.lead_config.editable.value=t,onChange:t=>1==e.changeLeadConfig},null,40,r_),[[i.e8,e.lead_config.editable.value]]),(0,l._)("label",{for:t+"n"},null,8,__)])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",u_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nt",disabled:e.lead_config.title_visible.disabled,"onUpdate:modelValue":t=>e.lead_config.title_visible.value=t,onChange:t=>1==e.changeLeadConfig},null,40,p_),[[i.e8,e.lead_config.title_visible.value]]),(0,l._)("label",{for:t+"nt"},null,8,h_)])):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:4},[s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",m_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nd",disabled:e.config.double_in_new_bath.disabled,"onUpdate:modelValue":t=>e.config.double_in_new_bath.value=t,onChange:t=>1==e.changeConfig},null,40,f_),[[i.e8,e.config.double_in_new_bath.value]]),(0,l._)("label",{for:t+"nd"},null,8,v_)])):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:5},[s.selectedTab.haveFieldsProperties?((0,l.wg)(),(0,l.iD)("td",{key:0,class:"box item text-lg relative",ref_for:!0,ref:t=>o.categories.selected===e?o.categories.ref=t:null},[(0,l._)("button",{id:"catBtn",onClick:t=>o.categories.selected=e,class:"pointer-events-auto relative inline-flex w-fit h-fit p-1 rounded-md bg-white text-[0.8125rem] font-medium leading-5 text-slate-700 shadow-sm ring-1 ring-slate-700/10 hover:bg-slate-50 hover:text-slate-900"},b_,8,g_)],512)):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),(0,l._)("td",y_,[(0,l.wy)((0,l._)("button",{class:"del_btn",onClick:t=>o.delete_field(e.id)},null,8,k_),[[i.F8,!e.is_system]]),e.changeName||e.changeData||e.changeLeadConfig||e.changeConfig?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>o.update_field(t,[e.changeName?"name":null,e.changeData?"data":null,e.changeLeadConfig?"lead_config":null,e.changeConfig?"config":null])}," Сохранить ",8,C_)):(0,l.kq)("",!0)])],2)),[[i.F8,o.selectedFieldProperty?.id===e.category_id||!s.selectedTab.haveFieldsProperties]]))),128)),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.new_fields,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{class:"row",key:e.id},[o.isTest&&o.selectedFieldPropertyIsBasic&&s.selectedTab.haveSort?((0,l.wg)(),(0,l.iD)("th",S_)):(0,l.kq)("",!0),(0,l._)("td",D_,[(0,l.wy)((0,l._)("input",{type:"text",class:(0,b.C_)(["input new_item_input",{error:e.nameError}]),"onUpdate:modelValue":t=>e.name=t,onKeyup:(0,i.D2)((s=>o.add_new(e,t)),["enter"])},null,42,x_),[[i.nr,e.name]])]),(0,l._)("td",T_,[(0,l.Wm)(c,{options_props:o.types,onSelect:o.option_select_new_field_type,selected_option:o.search_type(e.type),idx:t},null,8,["options_props","onSelect","selected_option","idx"]),5==o.new_fields[t].type||6==o.new_fields[t].type?((0,l.wg)(),(0,l.iD)("div",F_,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.data,((s,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option",key:a},[(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.data[a]=t},null,8,U_),[[i.nr,e.data[a]]]),(0,l._)("button",{class:"del_button",onClick:e=>o.remove_new_fields_selector_option(t,a)},null,8,V_)])))),128)),(0,l._)("button",{onClick:e=>o.add_new_fields_selector_option(t),class:"add_button"},null,8,q_)])):(0,l.kq)("",!0)]),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",L_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb1",disabled:o.new_fields[t].disabled?.visible.value,"onUpdate:modelValue":e=>o.new_fields[t].lead_config.visible.value=e},null,8,I_),[[i.e8,o.new_fields[t].lead_config.visible.value]]),(0,l._)("label",{for:t+"nb1"},null,8,Z_)])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",W_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n1",disabled:o.new_fields[t].disabled?.editable.value,"onUpdate:modelValue":e=>o.new_fields[t].lead_config.editable.value=e},null,8,O_),[[i.e8,o.new_fields[t].lead_config.editable.value]]),(0,l._)("label",{for:t+"n1"},null,8,P_)])):(0,l.kq)("",!0),s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",N_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n2",disabled:o.new_fields[t].lead_config.title_visible.disabled,"onUpdate:modelValue":e=>o.new_fields[t].lead_config.title_visible.value=e},null,8,E_),[[i.e8,o.new_fields[t].lead_config.title_visible.value]]),(0,l._)("label",{for:t+"n2"},null,8,H_)])):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:4},[s.selectedTab.haveLeadConfig?((0,l.wg)(),(0,l.iD)("td",$_,[(0,l.wy)((0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"n3",disabled:o.new_fields[t].config.double_in_new_bath.disabled,"onUpdate:modelValue":e=>o.new_fields[t].config.double_in_new_bath.value=e},null,8,M_),[[i.e8,o.new_fields[t].config.double_in_new_bath.value]]),(0,l._)("label",{for:t+"n3"},null,8,A_)])):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),o.isTest?((0,l.wg)(),(0,l.iD)(l.HY,{key:5},[s.selectedTab.haveFieldsProperties?((0,l.wg)(),(0,l.iD)("td",{key:0,class:"box item text-lg relative",ref_for:!0,ref:t=>o.categories.selected===e?o.categories.ref=t:null},[(0,l._)("button",{id:"catBtn",onClick:t=>o.categories.selected=e,class:"pointer-events-auto relative inline-flex w-fit h-fit p-1 rounded-md bg-white text-[0.8125rem] font-medium leading-5 text-slate-700 shadow-sm ring-1 ring-slate-700/10 hover:bg-slate-50 hover:text-slate-900"},B_,8,j_)],512)):(0,l.kq)("",!0)],64)):(0,l.kq)("",!0),(0,l._)("td",z_,[(0,l._)("button",{class:"del_btn",onClick:e=>o.delete_new_field(t)},null,8,K_),""!=e.name?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn_save btn_blue",onClick:s=>o.add_new(e,t)}," Сохранить ",8,R_)):(0,l.kq)("",!0)])])))),128))])),_:1})]),(0,l._)("button",{onClick:t[11]||(t[11]=e=>o.add_new_field()),class:"add_new_button"})]),(0,l.Wm)(i.uT,{name:"fade"},{default:(0,l.w5)((()=>[o.categories.ref?((0,l.wg)(),(0,l.j4)(l.lR,{key:0,to:o.categories.ref},[(0,l._)("div",{ref:"modalRef",class:(0,b.C_)(["absolute top-1/2 right-0 origin-top-right rounded-[4px] w-fit h-fit -translate-y-1/2 shadow-md z-10",o.animationStarted?"in":"out"])},[(0,l.Wm)(d,{list:o.copyFieldsPropertiesWithSpace.newList([o.categories.selected?.category_id,...o.categories.list]),placeholder:"Выберите категории",rightSideSticky:!0,withTick:!0,onSelect:t[12]||(t[12]=e=>o.categories.select(e))},null,8,["list"])],2)],8,["to"])):(0,l.kq)("",!0)])),_:1})],64)}const J_=(0,I.qj)([]);function X_(){const e=(0,I.qj)([]),t=(0,I.qj)({items:null,selected:{name:"Выбор подкатегории",value:-1}});(0,l.bv)((async()=>{Z.Z.state.categories.fields_properties.length||await Z.Z.dispatch("get_fields_properties"),Object.assign(e,[...Z.Z.state.categories.fields_properties]),d.fillList(),J_.length=0,s({value:e.find((e=>0===e.parent_id))})}));const s=e=>{const t=JSON.parse(JSON.stringify(e));J_.push(t.value),i(e.value.id)},i=e=>{t.items=o(e)},o=t=>{const s=[],l=e.filter((e=>e.parent_id==t));return l.forEach((e=>s.push({name:e.name,value:e}))),s},a=e=>{J_.splice(e+1),i(n.value.id)},n=(0,l.Fl)((()=>J_.at(-1))),c=(0,l.Fl)((()=>0===n.value?.parent_id)),d=(0,I.qj)({list:[],newList:function(e){const t=[];this.list.forEach((s=>{let l=!1;e.forEach((e=>l=l||s.levels.includes(e))),t.push({selected:l})}));const s=this.list.reduce(((e,s,l)=>[...e,{...s,...t[l]}]),[]);return s},fillList:function(){this.list=[],e.forEach((e=>{let t="";for(let s=1;s<e.level;s++)t+="    ";this.list.push({name:t+e.name,value:e.id,id:e.id,level:e.level,levels:e.levels,parent_id:e.parent_id})}))}});return{copy_fields_properties:e,selected_fields_properties:J_,data_fields_properties:t,option_select_fields_properties:s,prev_cat:a,selectedFieldProperty:n,selectedFieldPropertyIsBasic:c,copyFieldsPropertiesWithSpace:d}}var Q_=s(6367),eu={components:{SelectorVue:ke.Z,AppMultiSelect:Ce.Z},props:{selectedTab:Object},setup(e){const{selectedFieldProperty:t,selectedFieldPropertyIsBasic:s,copyFieldsPropertiesWithSpace:i}=X_();(0,l.YP)(t,(()=>{t.value&&g()}));const o=(0,I.qj)({visibility:!1,edit:!1,title:!1,content_copy:!1,categories:!1}),a=(0,I.qj)([]),n=(0,I.qj)([]),c=(0,I.iH)(!1);(0,l.bv)((async()=>{d()}));const d=async()=>{c.value=!0,await Z.Z.dispatch(r.value.getTypesName),e.selectedTab.haveFieldsProperties||await g(),setTimeout((()=>{c.value&&(c.value=!1)}),5e3)},r=(0,l.Fl)((()=>e.selectedTab));(0,l.YP)(r,(()=>{d()}));const _=(0,l.Fl)((()=>{let e=!1;return a.forEach((t=>{e=e||t.changeName||t.changeData||t.changeLeadConfig||t.changeConfig})),e})),u=(0,l.Fl)((()=>{const e=[];return Object.entries(Z.Z.state[r.value.storeName]?.[r.value.typesName]).forEach((([t,s])=>{e.push({name:s,value:t})})),e})),p=(0,l.Fl)((()=>1==Z.Z.state.account?.account?.id)),h=()=>{const e={id:a.length+1,category_id:t.value?.id,type:3,name:"",data:[],nameError:!1,lead_config:{visible:{disabled:!1,value:!1},editable:{disabled:!1,value:!1},title_visible:{disabled:!1,value:!1}},config:{double_in_new_bath:{disabled:!1,value:!1}}};r.value.haveLeadConfig||delete e.lead_config,n.push(e)},m=async(e,t)=>{const s=(e,t)=>{let s=0;return e&&t&&(s=2),e&&!t&&(s=1),e||t||(s=0),!e&&t&&(s=-1),s},l={type:e.type,name:e.name,category_id:e.category_id,data:e.data};if(r.value.haveLeadConfig){const t={visible:s(e.lead_config.visible.value,e.lead_config.visible.disabled),editable:s(e.lead_config.editable.value,e.lead_config.editable.disabled)};l.lead_config=t}const i=await Z.Z.dispatch(r.value.addName,l),o="This field name exist."==i.error;o&&(n[t]["nameError"]=!0),i.error||(n.splice(n.indexOf(e),1),g())},f=()=>{a.map(((e,t)=>{const s=e.changeName||e.changeData||e.changeLeadConfig||e.changeConfig;s&&v(t,[e.changeName?"name":null,e.changeData?"data":null,e.changeLeadConfig?"lead_config":null,e.changeConfig?"config":null])}))},v=async(e,t)=>{const s={};s["id"]=a[e]["id"],t.forEach((t=>{null!=t&&(s[t]={},"lead_config"==t?(s[t].visible=a[e][t].visible.value?1:0,s[t].editable=a[e][t].editable.value?1:0,s[t].title_visible=a[e][t].title_visible.value?1:0,s[t].title_sort=a[e][t].title_sort):"config"==t?(s[t]=a[e][t],a[e][t].double_in_new_bath&&(s[t].double_in_new_bath=a[e][t].double_in_new_bath.value?1:0),a[e][t]&&(s[t].sort=a[e][t].sort,s[t].table=a[e][t].table)):s[t]=a[e][t])})),a[e]?.is_system&&delete s?.name;const l=await Z.Z.dispatch(r.value.updateName,s),i="This field name exist."==l?.error;a[e]["nameError"]=i},g=async()=>{c.value=!0,await Z.Z.dispatch(r.value.getFieldsName,e.selectedTab.haveFieldsProperties&&t.value?t.value?.id:0),a.length=0,Object.assign(a,[...Z.Z.state[r.value.storeName]?.[r.value.fieldsName].filter((e=>!(r.value.haveVirtual&&e.is_virtual)))]);const s=JSON.parse(JSON.stringify(a));s.map((e=>{if(r.value.haveLeadConfig){const t=e.lead_config.visible;e.lead_config.visible={disabled:-1==t||2==t,value:t>0};const s=e.lead_config.editable;e.lead_config.editable={disabled:-1==s||2==s,value:s>0};const l=e.lead_config.title_visible;e.lead_config.title_visible={disabled:-1==l||2==l,value:l>0};const i=void 0===e.config.double_in_new_bath?0:e.config.double_in_new_bath;e.config.double_in_new_bath={disabled:-1==i||2==i,value:i>0}}})),a.map(((e,t)=>{if(e["nameError"]=!1,e["changeName"]=(0,l.Fl)((()=>e.name!==s[t].name)),e["changeData"]=(0,l.Fl)((()=>JSON.stringify(e.data)!==JSON.stringify(s[t].data))),e["changeLeadConfig"]=(0,l.Fl)((()=>JSON.stringify(e.lead_config)!==JSON.stringify(s[t].lead_config))),e["changeConfig"]=(0,l.Fl)((()=>JSON.stringify(e.config)!==JSON.stringify(s[t].config))),r.value.haveLeadConfig){const t=e.lead_config.visible;e.lead_config.visible={disabled:-1==t||2==t,value:t>0};const s=e.lead_config.editable;e.lead_config.editable={disabled:-1==s||2==s,value:s>0};const l=e.lead_config.title_visible;e.lead_config.title_visible={disabled:-1==l||2==l,value:l>0};const i=void 0===e.config.double_in_new_bath?0:e.config.double_in_new_bath;e.config.double_in_new_bath={disabled:-1==i||2==i,value:i>0}}})),c.value=!1},w=e=>u.value.find((t=>t.value==e)),b=e=>{n.splice(e,1)},y=async e=>{await Z.Z.dispatch(r.value.deleteName,{id:e}),g()},k=(e,t)=>{a[t].type=e},C=(e,t)=>{n[t].type=e.value},S=(e,t)=>{const s=a[e].config?.sort;void 0===a[e].config?.sort||void 0===a[e-1]?.config?.sort&&t||void 0===a[e+1]?.config?.sort&&!t||(t?(a[e].config.sort=a[e-1].config?.sort,a[e-1].config.sort=s):(a[e].config.sort=a[e+1].config?.sort,a[e+1].config.sort=s),v(e,["config"]),v(t?e-1:e+1,["config"]),g())},D=e=>{null==a[e].data&&(a[e].data=[]),a[e].data.push("")},x=(e,t)=>{a[e].data.splice(t,1)},T=e=>{n[e].data.push("")},F=(e,t)=>{n[e].data.splice(t,1)},U=(0,I.qj)({selected:{},ref:null,list:[],select:function(e){const t=this.list.indexOf(e.value);-1===t?this.list.push(e.value):this.list.splice(t,1)}}),V=(0,I.iH)(null);(0,Q_.i9H)(V,(e=>{const t="catBtn"===e?.target?.attributes?.id?.value;U.selected.specialList=U.list,U.selected={},t?U.ref=null:setTimeout((()=>U.ref=null),150)}));const q=(0,I.iH)(!1);return(0,l.YP)((()=>U.selected),(e=>{q.value=!!e.id,e.id?U.selected.specialList?.length&&(U.list=U.selected.specialList):U.list=[]})),{toolTips:o,copy_fields:a,new_fields:n,is_loading:c,showUpdateAllFieldsBtn:_,types:u,isTest:p,add_new_field:h,add_new:m,updateAllFields:f,update_field:v,get_fields:g,search_type:w,delete_new_field:b,delete_field:y,option_select_type:k,option_select_new_field_type:C,changeTitleSort:S,add_selector_option:D,remove_selector_option:x,add_new_fields_selector_option:T,remove_new_fields_selector_option:F,selectedFieldProperty:t,selectedFieldPropertyIsBasic:s,copyFieldsPropertiesWithSpace:i,categories:U,modalRef:V,animationStarted:q}}};const tu=(0,P.Z)(eu,[["render",G_],["__scopeId","data-v-295e77b5"]]);var su=tu;const lu={class:"flex flex-row justify-between items-center"};function iu(e,t,s,i,o,a){(0,l.up)("SelectorVue");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.kq)("",!0),(0,l._)("div",lu,[(0,l.kq)("",!0),(0,l._)("button",{class:"btn pointer-events-auto w-full justify-center relative inline-flex rounded-md bg-white text-[0.8125rem] font-medium leading-5 text-slate-700 shadow-sm ring-1 ring-slate-700/10 hover:bg-slate-50 hover:text-slate-900",onClick:t[0]||(t[0]=e=>i.openCategories())}," Категории ")])],64)}var ou={components:{SelectorVue:ke.Z},setup(e,t){const s=()=>t.emit("toggleCategories",!0);return{...X_(),openCategories:s}}};const au=(0,P.Z)(ou,[["render",iu],["__scopeId","data-v-69a203ec"]]);var nu=au;function cu(){const e=(0,I.qj)({selected:{},list:[{name:"Заказы",value:"Orders",storeName:"orders",fieldsName:"fields",typesName:"types",getTypesName:"getOrdersTypes",getFieldsName:"getOrdersFields",addName:"addOrdersField",updateName:"updateOrdersField",deleteName:"deleteOrdersField",isBase:!0,haveStatuses:!0,haveSort:!0,haveVirtual:!0},{name:"Компании",value:"Company",storeName:"clientsCompany",fieldsName:"fields",typesName:"types",getTypesName:"getClientsCompanyTypes",getFieldsName:"getClientsCompanyFields",addName:"addClientsCompanyField",updateName:"updateClientsCompanyField",deleteName:"deleteClientsCompanyField",haveSort:!0},{name:"Контакты",value:"Contacts",storeName:"clientsContacts",fieldsName:"fields",typesName:"types",getTypesName:"getClientsContactsTypes",getFieldsName:"getClientsContactsFields",addName:"addClientsContactsField",updateName:"updateClientsContactsField",deleteName:"deleteClientsContactsField",haveSort:!0},{name:"Товары",value:"Products",storeName:"fields",fieldsName:"fields",typesName:"types",getTypesName:"get_types",getFieldsName:"get_fields",addName:"add_field",updateName:"update_fields",deleteName:"delete_field",haveLeadConfig:!0,haveFieldsProperties:!0,haveCategories:!0,haveSort:!0}],select:function(e){this.selected=e}});return e.select(e.list.find((e=>e.isBase))),{tabs:e}}const du=e=>((0,l.dD)("data-v-7237e50e"),e=e(),(0,l.Cn)(),e),ru={class:"bgc"},_u=du((()=>(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[(0,l._)("path",{fill:"none",stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 18h3.75a5.25 5.25 0 1 0 0-10.5H5M7.5 4L4 7.5L7.5 11"})],-1))),uu=[_u],pu={class:"container"},hu={class:"header"},mu=du((()=>(0,l._)("div",{class:"top"},[(0,l._)("label",null,"Категории товаров")],-1))),fu=du((()=>(0,l._)("br",null,null,-1))),vu={class:"bottom"},gu={class:"add_teleport",style:{"z-index":"100"},title:"Добавлние новой подкатегории"},wu={class:"content"},bu=["onDragstart"],yu={class:"input_name"},ku={title:"Изменение названия категории",class:"text_block"},Cu=["onKeyup","onUpdate:modelValue","disabled"],Su=["onClick"],Du=["onClick"],xu=du((()=>(0,l._)("div",{class:"rename btn"},null,-1))),Tu=[xu],Fu=["onUpdate:modelValue","onInput"],Uu={class:"flex flex-row items-center justify-end gap-1 min-w-[84px]"},Vu=["onClick"],qu=du((()=>(0,l._)("span",{class:"material-icons-round absolute",style:{"font-size":"30px","font-weight":"bold"}}," close ",-1))),Lu=[qu],Iu=["id","onClick","title"],Zu=du((()=>(0,l._)("span",{class:"material-icons-round absolute",style:{"font-size":"38px","font-weight":"400"}}," add ",-1))),Wu=[Zu];function Ou(e,t,s,o,a,n){const c=(0,l.up)("ProductsCategoryRemoveModal"),d=(0,l.up)("draggable");return(0,l.wg)(),(0,l.iD)("div",ru,[(0,l._)("button",{class:"bg-slate-400 bg-opacity-90 p-2 h-fit w-fit rounded-xl absolute left-0 hover:shadow-sm hover:drop-shadow-md outline-none focus-visible:drop-shadow-md",onClick:t[0]||(t[0]=e=>o.close())},uu),(0,l._)("div",pu,[(0,l._)("div",hu,[mu,fu,(0,l._)("div",vu,[o.del_modal_config.show?((0,l.wg)(),(0,l.j4)(l.lR,{key:0,to:"body"},[(0,l.Wm)(c,{onRemove:o.remove,onClose:o.closeRemoveModal},null,8,["onRemove","onClose"])])):(0,l.kq)("",!0),null!==o.target?((0,l.wg)(),(0,l.j4)(l.lR,{key:1,to:o.target},[(0,l._)("div",{class:"backdrop",onClick:t[1]||(t[1]=(0,i.iM)((e=>o.reset_fields_cat_name()),["stop"])),style:{"z-index":"99"}}),(0,l._)("div",gu,[(0,l.wy)((0,l._)("input",{type:"text",class:"input_teleport","onUpdate:modelValue":t[2]||(t[2]=e=>o.fields_cat_name=e),ref:"input",onKeyup:[t[3]||(t[3]=(0,i.D2)((e=>o.add_new()),["enter"])),t[4]||(t[4]=(0,i.D2)((e=>o.reset_fields_cat_name()),["esc"]))]},null,544),[[i.nr,o.fields_cat_name]]),(0,l._)("button",{class:"button_teleport",onClick:t[5]||(t[5]=e=>o.add_new())},"ок")])],8,["to"])):(0,l.kq)("",!0)])]),(0,l._)("div",wu,[(0,l.Wm)(d,{class:"dragArea",list:o.copy_fields_properties,onChange:o.changeData},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.copy_fields_properties,((e,s)=>((0,l.wg)(),(0,l.iD)("div",{key:e.id,class:(0,b.C_)(["item",{darag:o.isDragged==s}]),style:(0,b.j5)({width:o.calculate_width(e.level)+"%"}),onDragstart:e=>o.isDragged=s,onDragend:t[6]||(t[6]=e=>o.isDragged=null)},[(0,l._)("div",yu,[(0,l._)("div",ku,[(0,l.wy)((0,l._)("input",{type:"text",class:"input_uderline",onKeyup:(0,i.D2)((t=>o.rename(e.id)),["enter"]),"onUpdate:modelValue":t=>e.name=t,disabled:0===e.parent_id},null,40,Cu),[[i.nr,e.name]])]),!o.all_old?.name?.includes(e.name)&&o.all_old?.id?.includes(e.id)?((0,l.wg)(),(0,l.iD)("button",{key:0,onClick:t=>o.rename(e.id),class:"btns",title:"Сохраняет название категории"},[(0,l._)("div",{class:(0,b.C_)(["btn",{apply:!o.confirm,confirm:o.confirm}])},null,2)],8,Su)):(0,l.kq)("",!0),!o.all_old?.name?.includes(e.name)&&o.all_old?.id?.includes(e.id)?((0,l.wg)(),(0,l.iD)("button",{key:1,onClick:t=>o.prevname(e.id),class:"btns",title:"Возвращает изначальное название"},Tu,8,Du)):(0,l.kq)("",!0),o.isTest?(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:2,type:"text",class:"input input_uderline ml-2","onUpdate:modelValue":t=>e.img_url=t,placeholder:"Url картинки",onInput:()=>o.changeImgUrl(e)},null,40,Fu)),[[i.nr,e.img_url]]):(0,l.kq)("",!0)]),(0,l._)("div",Uu,[0!==e.parent_id&&(!o.copy_fields_properties[s+1]||o.copy_fields_properties[s+1]?.level<=e.level)?((0,l.wg)(),(0,l.iD)("button",{key:0,onClick:(0,i.iM)((t=>o.setRemoveModalConfig(e.id,e.level)),["stop"]),class:"w-10 h-10 p-1 pointer transition-all overflow-hidden duration-200 relative bg-slate-50 text-slate-700/70 hover:bg-valencia-50 hover:text-valencia-500 rounded-lg inline-flex justify-center items-center",title:"Удаление категории"},Lu,8,Vu)):(0,l.kq)("",!0),(0,l._)("button",{id:e.id,onClick:t=>o.selected_category_id=e.id,class:"w-10 h-10 p-1 pointer justify-self-end transition-all duration-200 relative bg-slate-50 text-slate-700/70 hover:bg-fruit-salad-100/80 hover:text-fruit-salad-500 rounded-lg inline-flex justify-center items-center",ref_for:!0,ref:t=>e.id===o.selected_category_id?o.target=t:null,title:null===o.target?"Добавлние новой подкатегории":null},Wu,8,Iu)])],46,bu)))),128))])),_:1},8,["list","onChange"])])])])}var Pu={components:{ProductsCategoryRemoveModal:Xi,draggable:L.J},setup(e,t){const s=(0,I.iH)(""),i=(0,I.iH)(null),o=(0,I.iH)(null),a=(0,I.qj)({}),n=(0,I.iH)(null),c=(0,I.iH)(!1),d=(0,I.qj)({show:!1,id:null,level:null}),r=(0,I.iH)(null);(0,l.bv)((async()=>{await Z.Z.dispatch("get_fields_properties"),m()}));const _=(0,l.Fl)((()=>Z.Z.state.categories.fields_properties)),u=(0,l.Fl)((()=>1==Z.Z.state.account?.account?.id)),p=e=>{clearTimeout(r.value),r.value=setTimeout((()=>{const t={id:e.id,name:e.name,parent_id:e.parent_id,img_url:e.img_url};Z.Z.dispatch("update_fields_properties",t)}),1e3)},h=e=>{const t=e.moved.newIndex,s=[..._.value],l={id:s[t].id,parent_id:s[t-1].id,name:""};Z.Z.dispatch("update_fields_properties",l)},m=()=>{const e={name:[],id:[],parent_id:[],fields_id:[],level:[],levels:[]};Z.Z.state.categories.fields_properties.forEach((t=>Object.entries(t).forEach((t=>e[t[0]]?.push(t[1]))))),Object.assign(a,e)},f=()=>{const e=_.value.find((e=>e.id===i.value));e.level+1<=10&&""!=s.value&&(Z.Z.dispatch("add_fields_properties",{name:s.value,parent_id:e.id}),w())},v=async e=>{const t=[..._.value].find((t=>t.id===e)),s={id:t.id,parent_id:"",name:t.name};await Z.Z.dispatch("update_fields_properties",s),c.value=!0,setTimeout((()=>{c.value=!1,m()}),1e3)},g=e=>{Z.Z.state.categories.fields_properties.map((t=>{const s=()=>{let t="";return a.id.forEach(((s,l)=>s===e?t=a.name[l]:null)),t};t.id===e&&(t.name=s(),v(e))}))},w=()=>{i.value=null,s.value="",o.value=null},b=e=>{let t=100;return t*=.95**(e-1),t},y=(e,t)=>{d.level=t,d.id=e,d.show=!0},k=()=>{1!=d.level&&Z.Z.dispatch("delete_fields_properties",{id:d.id}),C()},C=()=>{d.show=!1},S=()=>{t.emit("toggleCategories",!1)},D=(0,I.iH)(null);return(0,l.YP)(o,(()=>{(0,l.Y3)((()=>{null!==o.value&&D.value.focus()}))}),{deep:!0}),{fields_cat_name:s,selected_category_id:i,target:o,all_old:a,isDragged:n,confirm:c,del_modal_config:d,timer:r,copy_fields_properties:_,isTest:u,changeImgUrl:p,changeData:h,get_all_old:m,add_new:f,rename:v,prevname:g,reset_fields_cat_name:w,calculate_width:b,setRemoveModalConfig:y,remove:k,closeRemoveModal:C,close:S,input:D}}};const Nu=(0,P.Z)(Pu,[["render",Ou],["__scopeId","data-v-7237e50e"]]);var Eu=Nu;const Hu=e=>((0,l.dD)("data-v-141bb05a"),e=e(),(0,l.Cn)(),e),$u={class:"bgc"},Mu=Hu((()=>(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[(0,l._)("path",{fill:"none",stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 18h3.75a5.25 5.25 0 1 0 0-10.5H5M7.5 4L4 7.5L7.5 11"})],-1))),Au=[Mu],ju={class:"container"},Yu=Hu((()=>(0,l._)("div",{class:"header"},[(0,l._)("div",{class:"top"},[(0,l._)("label",null,"Настройка статусов")])],-1))),Bu={class:"content"},zu={class:"rows"},Ku=Hu((()=>(0,l._)("tr",{class:"row"},[(0,l._)("th",{class:"item item_field title"},[(0,l._)("div",{class:"copy_fields"},[(0,l._)("span",null,"Название")])]),(0,l._)("th",{class:"item item_type"},"Статус"),(0,l._)("th",{class:"item"})],-1))),Ru={class:"item"},Gu=["onUpdate:modelValue"],Ju={class:"item selectors"},Xu={class:"type_selector_options"},Qu={class:"grid grid-cols-2 min-w-[40px]"},ep=["onClick"],tp=Hu((()=>(0,l._)("span",{class:"material-icons-outlined text-[#757575]"}," expand_less ",-1))),sp=[tp],lp={key:1},ip=["onClick"],op=Hu((()=>(0,l._)("span",{class:"material-icons-outlined rotate-180 text-[#757575]"}," expand_less ",-1))),ap=[op],np={key:3},cp=["onUpdate:modelValue"],dp=["id","disabled","checked","onChange"],rp=["for"],_p=["id","disabled","checked","onChange"],up=["for"],pp=["onClick"],hp=["onClick"],mp={class:"item del_sell"},fp=["onClick"],vp=["onClick"];function gp(e,t,s,o,a,n){return(0,l.wg)(),(0,l.iD)("div",$u,[(0,l._)("button",{class:"bg-slate-400 bg-opacity-90 p-2 h-fit w-fit rounded-xl absolute left-0 hover:shadow-sm hover:drop-shadow-md outline-none focus-visible:drop-shadow-md",onClick:t[0]||(t[0]=e=>o.close())},Au),(0,l._)("div",ju,[Yu,(0,l._)("div",Bu,[(0,l._)("table",zu,[Ku,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.statusesList,(({statuses:s,statusesIsChange:a,saveStatuses:n})=>((0,l.wg)(),(0,l.iD)("tr",{class:(0,b.C_)(["row",{load:e.is_loading}]),key:s.id},[(0,l._)("td",Ru,[(0,l.wy)((0,l._)("input",{type:"text",class:"input new_item_input","onUpdate:modelValue":e=>s.name=e},null,8,Gu),[[i.nr,s.name]])]),(0,l._)("td",Ju,[(0,l._)("div",Xu,[(0,l.Wm)(i.W3,{name:"list",mode:"out-in"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.list,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"type_selector_option gap-2",key:e.value},[(0,l._)("div",Qu,[e.is_system?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[1!==t?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"up leading-[1] h-min flex justify-center items-center w-fit",onClick:e=>s.sort(t,"up")},sp,8,ep)):((0,l.wg)(),(0,l.iD)("div",lp)),s.list[t+1].sort<100?((0,l.wg)(),(0,l.iD)("button",{key:2,class:"down leading-[1] h-min flex justify-center items-center w-fit",onClick:e=>s.sort(t,"down")},ap,8,ip)):((0,l.wg)(),(0,l.iD)("div",np))],64))]),(0,l.wy)((0,l._)("input",{type:"text",class:"input","onUpdate:modelValue":t=>e.name=t},null,8,cp),[[i.nr,e.name]]),(0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb1"+s.id,disabled:e.sort>99,checked:s.reservation.includes(e.value),onChange:t=>s.changeVal("reservation",e.value)},null,40,dp),(0,l._)("label",{for:t+"nb1"+s.id,title:"Резервация"},null,8,rp),(0,l._)("input",{type:"checkbox",class:"checkbox",id:t+"nb2"+s.id,disabled:s.resIdx>t-1,checked:s.write_off===e.value,onChange:t=>s.changeVal("write_off",e.value)},null,40,_p),(0,l._)("label",{for:t+"nb2"+s.id,title:"Списание"},null,8,up),(0,l._)("button",{class:"del_button",style:(0,b.j5)({visibility:e.is_system?"hidden":"visible"}),onClick:t=>s.del(e.id)},null,12,pp)])))),128))])),_:2},1024),(0,l._)("button",{onClick:e=>s.add(),class:"add_button"},null,8,hp)])]),(0,l._)("td",mp,[s.isNew?((0,l.wg)(),(0,l.iD)("button",{key:1,class:"del_btn",onClick:e=>o.removeStatuses(s.id)},null,8,fp)):((0,l.wg)(),(0,l.iD)("button",{key:0,onClick:t[1]||(t[1]=e=>o.addStatuses()),class:"add_new_button",style:{position:"static",width:"18px",height:"18px"}})),a?((0,l.wg)(),(0,l.iD)("button",{key:2,class:"btn btn_save btn_blue",onClick:e=>n()}," Сохранить ",8,vp)):(0,l.kq)("",!0)])],2)))),128))])])])])}function wp(e,t){const s=(0,I.qj)({id:e.id,name:e.name,isNew:!e.is_system,list:e.statuses,reservation:[],write_off:2,resIdx:(0,l.Fl)((()=>s.list.indexOf([...s.list].reverse().find((e=>s.reservation.includes(e.value)))))),woIdx:(0,l.Fl)((()=>s.list.indexOf(s.list.find((e=>e.value===s.write_off))))),add:async function(){await Z.Z.dispatch("ordersPipelinesStatusesAdd",{pipeline_id:this.id,name:"новый статус",sort:this.list.at(-4).sort+1}),t()},del:function(e){Z.Z.dispatch("ordersPipelinesStatusesDelete",{id:e}),t()},changeVal:function(e,t){if("reservation"===e){this.resIdx>this.woIdx&&(this.write_off=null);const e=this.reservation.indexOf(t);e>-1?this.reservation.splice(e,1):this.reservation.push(t)}else this[e]===t?this[e]=null:this[e]=t},sort:function(e,t){const s=e-1,l=e+1,i=this.list[e].sort,o=this.list[e];"up"===t&&void 0!==this.list[s].sort&&(this.list[e].sort=this.list[s].sort,this.list[s].sort=i,this.list[e]=this.list[s],this.list[s]=o),"down"===t&&this.list[l].sort<100&&(this.list[e].sort=this.list[l].sort,this.list[l].sort=i,this.list[e]=this.list[l],this.list[l]=o)}}),i=s.list.filter((e=>e.is_system));s.reservation.push(i[0]?.id),s.write_off=i[1]?.id;const o=(0,I.iH)(""),a=()=>{s.list.map((e=>{const t=e.name,s=e.sort;e.statNameIsChange=(0,l.Fl)((()=>e.name!=t)),e.statSortIsChange=(0,l.Fl)((()=>e.sort!=s))})),o.value=JSON.parse(JSON.stringify(s.name))};a();const n=(0,l.Fl)((()=>c.value||d.value)),c=(0,l.Fl)((()=>o.value!=s.name)),d=(0,l.Fl)((()=>s.list.some((e=>e.statNameIsChange||e.statSortIsChange)))),r=()=>{if(c.value||d.value){if(c.value&&Z.Z.dispatch("ordersPipelinesUpdate",{id:s.id,name:s.name}),d.value){const e=[];s.list.forEach((t=>{if(!t.statNameIsChange&&!t.statSortIsChange)return;const s={id:t.id};t.statNameIsChange&&(s.name=t.name),t.statSortIsChange&&(s.sort=t.sort),e.push(s)})),Z.Z.dispatch("ordersPipelinesStatusesUpdate",{statuses:e})}a()}};return{statuses:s,statusesIsChange:n,nameIsChange:c,statsIsChange:d,saveStatuses:r}}var bp={components:{},setup(e,t){(0,l.bv)((()=>{s()}));const s=async()=>{const e=await Z.Z.dispatch("ordersPipelinesList",{});e.forEach((e=>e.statuses.map((e=>e.value=e.id)))),i.length=0,e.forEach((e=>i.push(wp(e,s))))},i=(0,I.qj)([]),o=async()=>{await Z.Z.dispatch("ordersPipelinesAdd",{name:"Статус"}),s()},a=async e=>{await Z.Z.dispatch("ordersPipelinesDelete",{id:e}),s()},n=()=>t.emit("toggleStatuses");return{statusesList:i,addStatuses:o,removeStatuses:a,close:n}}};const yp=(0,P.Z)(bp,[["render",gp],["__scopeId","data-v-141bb05a"]]);var kp=yp,Cp=s(6413),Sp={components:{BtnsSaveClose:q.Z,AppRadioBtnsGroupUnderlined:Dd.Z,SettingEntitiesTable:su,SettingEntitiesFieldsProperties:nu,SettingEntitiesCategories:Eu,SettingEntitiesStatuses:kp},setup(){const{tabs:e}=cu(),t=()=>{s()},s=()=>{Z.Z.commit("toggleSettingEntities",!1)},[l,i]=(0,Cp.OT)(!1),[o,a]=(0,Cp.OT)(!1),n=()=>{i(!1),a(!1)};return{close:s,save:t,tabs:e,showCategories:l,toggleCategories:i,showStatuses:o,toggleStatuses:a,closeAllSubTabs:n}}};const Dp=(0,P.Z)(Sp,[["render",wr],["__scopeId","data-v-22264065"]]);var xp=Dp,Tp=s(65),Fp={components:{TableSettings:E,EditStuff:xe,NewPosition:Lt,CancelPosition:ss,DocumentSetting:ui,ProductCategory:to,ProductProperties:Ha,ThirdPpartyIntegrations:vn,SyncSettings:Kn,MoveProductsBetweenWhs:Sc,ImportStuff:Gc,AccountSattings:pd,ClientsFieldsSettings:nr,SettingEntities:xp},props:{selectedWH:Object,currentItems:Array},computed:{...(0,Tp.Se)(["show_table_settings","show_filter","show_edit_stuff","show_new_position","show_cancel_position","show_document_setting","show_product_category","show_product_properties","showThirdPpartyIntegrations","showAccountSattings","showSyncSettings","showEditPrice","showMoveProductsBetweenWhs","showImportStuff","showClientsFieldsSettings","showSettingEntities"]),isTest(){return 1==this.$store.state.account?.account?.id||"salesUp"===this.$route.query.test}},methods:{updateProducts(){this.$emit("updateProducts")}}};const Up=(0,P.Z)(Fp,[["render",w],["__scopeId","data-v-c574eb32"]]);var Vp=Up},6833:function(e,t,s){s.d(t,{Z:function(){return m}});var l=s(3396),i=s(4870),o=s(7139),a=s(9242),n=s(9299),c=s(1120),d=s(678);const r={class:"btns w-full gap-2 justify-center md:justify-start"},_=["onClick","disabled"];var u={name:"NavBar",setup(e){const t=(0,d.yj)(),s=(0,l.Fl)((()=>1==n.Z.state.account?.account?.id||"test"===t?.query?.test)),u=(0,l.Fl)((()=>n.Z.state.account?.account?.id)),p=(0,l.Fl)((()=>void 0===n.Z.state.account?.user?.isAdmin||n.Z.state.account?.user?.isAdmin)),h=(0,l.Fl)((()=>n.Z.state.data.catalog)),m=(0,l.Fl)((()=>n.Z.state.data.isNavBarDisabled)),f=e=>c.Z.push("/"+e);return(e,t)=>((0,l.wg)(),(0,l.iD)("div",r,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,i.SU)(h),(t=>(0,l.wy)(((0,l.wg)(),(0,l.iD)("button",{class:(0,o.C_)(["btns_btn text-xs px-2 py-1 md:px-2 md:py-[2px] md:text-lg text-[#1b3546] dark:rounded-none rounded dark:border-y-0 dark:border-x-0 border-[#1b3546] border dark:border-b-2 dark:border-[#1c2d3e] dark:text-slate-200",{selected_catalog:e.$route.path==="/"+t.value}]),onClick:e=>f(t.value),disabled:(0,i.SU)(m),key:t,style:(0,o.j5)({order:(0,i.SU)(s)?t.testOrder:"unset"})},(0,o.zw)(t.name),15,_)),[[a.F8,!(t.isTest&&!(0,i.SU)(s))&&!(t.isProduction&&(0,i.SU)(s))&&!(t.isAdmin&&!(0,i.SU)(p))&&!t.hideId?.includes((0,i.SU)(u))]]))),128))]))}},p=s(89);const h=(0,p.Z)(u,[["__scopeId","data-v-3f5c9b3a"]]);var m=h}}]);
//# sourceMappingURL=8.c7971b9f.js.map