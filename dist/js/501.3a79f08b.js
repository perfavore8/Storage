"use strict";(self["webpackChunkstorage"]=self["webpackChunkstorage"]||[]).push([[501],{8697:function(e,t,s){s.d(t,{Z:function(){return u}});var i=s(3396),o=s(7139);function a(e,t,s,a,l,r){const n=(0,i.up)("AppPaginator"),d=(0,i.up)("selector-vue");return s.show?((0,i.wg)(),(0,i.iD)("div",{key:0,class:(0,o.C_)(["bottom",{blur:s.blur}])},[s.showBtns?((0,i.wg)(),(0,i.j4)(n,{key:0,page:s.page,onChangePage:r.changePage},null,8,["page","onChangePage"])):(0,i.kq)("",!0),s.showSelector?((0,i.wg)(),(0,i.j4)(d,{key:1,class:"count",options_props:l.count_values,selected_option:{name:s.count,value:-1},onSelect:r.change_count},null,8,["options_props","selected_option","onSelect"])):(0,i.kq)("",!0)],2)):(0,i.kq)("",!0)}var l=s(7720),r=s(1725),n={components:{SelectorVue:l.Z,AppPaginator:r.Z},props:{previous:{type:Boolean,required:!1},next:{type:Boolean,required:!1},page:{type:Object,required:!1,default(){return{first:1,prev:null,current:1,next:null,last:1}}},count:{type:Number,required:!0},blur:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!0},showBtns:{type:Boolean,required:!1,default:!0},showSelector:{type:Boolean,required:!1,default:!0}},emits:{changePage:null,changeCount:null},data(){return{count_values:[]}},async mounted(){await this.$store.dispatch("get_account"),this.$store.state.account.user.config.per_pages&&(this.count_values=[...this.$store.state.account.user.config.per_pages].map(((e,t)=>({name:e,value:t}))))},computed:{},methods:{changePage(e){this.$emit("changePage",e)},change_count(e){this.$emit("changeCount",e.name)}}},d=s(89);const c=(0,d.Z)(n,[["render",a],["__scopeId","data-v-53e878de"]]);var u=c},3501:function(e,t,s){s.r(t),s.d(t,{default:function(){return di}});var i=s(3396),o=s(7139),a=s(9242);const l=e=>((0,i.dD)("data-v-46388382"),e=e(),(0,i.Cn)(),e),r={class:"header_left"},n={class:"header_row"},d={class:"filters_left"},c={class:"date"},u={class:"flex flex-row gap-5 items-center min-h-[34px]"},_=["value"],p={class:"bot"},h={for:"grid"},m={key:0,class:"material-icons-round icon"},g={key:1,class:"material-icons-round icon"},f={key:0,class:"flex items-center"},v=l((()=>(0,i._)("label",{for:"is_in_wh"},"Только положительные остатки",-1))),w={class:"filters_right"},b=["disabled"],y=l((()=>(0,i._)("span",{class:"material-icons-outlined"}," sync ",-1))),C=[y],k=l((()=>(0,i._)("span",{class:"material-icons"}," settings ",-1))),P=[k],F={class:"grid"};function x(e,t,s,l,y,k){const x=(0,i.up)("HomeModals"),S=(0,i.up)("NavBar"),$=(0,i.up)("HomeImportOldData"),D=(0,i.up)("HomeWhs"),q=(0,i.up)("HomeMenu"),E=(0,i.up)("HomeBtns"),W=(0,i.up)("HomeFilter"),H=(0,i.up)("main-grid"),j=(0,i.up)("card-grid");return(0,i.wg)(),(0,i.iD)("div",{class:(0,o.C_)(["app",{disabled:e.disabled_for_modals||k.account?.is_old_data_load_start&&!k.account?.is_old_data_loaded}])},[(0,i.Wm)(x,{selectedWH:y.selectedWH,currentItems:y.currentItems,onUpdateProducts:k.updateProducts},null,8,["selectedWH","currentItems","onUpdateProducts"]),(0,i._)("div",{class:(0,o.C_)(["header",{blur:e.disabled_for_modals}])},[(0,i._)("div",r,[(0,i._)("div",n,[(0,i.Wm)(S),(0,i.Wm)($,{ref:"oldData",onImportComplete:k.importComplete},null,8,["onImportComplete"])]),(0,i.Wm)(D,{ref:"homeWhs",selectedWH:y.selectedWH,"onUpdate:selectedWH":t[0]||(t[0]=e=>y.selectedWH=e)},null,8,["selectedWH"])]),(0,i.Wm)(q)],2),(0,i._)("div",{class:(0,o.C_)(["wrapper",{blur:e.home_blur}])},[(0,i._)("div",{class:(0,o.C_)(["filters",{blur:e.show_edit_modal}])},[(0,i._)("div",d,[(0,i._)("div",c,[(0,i._)("div",u,[k.isTest?((0,i.wg)(),(0,i.iD)("input",{key:0,type:"date",id:"start",name:"trip-start",value:k.date,min:"2000-01-01",max:"2032-12-31","aria-required":"true","aria-invalid":"false"},null,8,_)):(0,i.kq)("",!0),(0,i.Wm)(E,{isServicePage:k.isServicePage,onArchive_data:k.archive_data,onSetCurrentItems:k.setCurrentItems},null,8,["isServicePage","onArchive_data","onSetCurrentItems"])]),(0,i._)("div",p,[(0,i._)("p",null,"Найдено: "+(0,o.zw)(k.totalCountProducts),1),(0,i.wy)((0,i._)("input",{type:"checkbox",class:"checkbox grid","onUpdate:modelValue":t[1]||(t[1]=e=>y.isGrid=e),id:"grid"},null,512),[[a.e8,y.isGrid]]),(0,i._)("label",h,[(0,i.Wm)(a.uT,{name:"modal",mode:"out-in"},{default:(0,i.w5)((()=>[y.isGrid?((0,i.wg)(),(0,i.iD)("span",m," format_list_bulleted ")):((0,i.wg)(),(0,i.iD)("span",g," grid_view "))])),_:1})]),k.isServicePage?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",f,[(0,i.wy)((0,i._)("input",{type:"checkbox",id:"is_in_wh",class:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>y.is_in_wh=e)},null,512),[[a.e8,y.is_in_wh]]),v])),y.isGrid?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(W,{key:1,onConfirmFilters:k.confirmFilters,onClearFilters:k.clearFilters},null,8,["onConfirmFilters","onClearFilters"]))])])]),(0,i._)("div",w,[k.oneC?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:0,class:"button button_4 smallBtn",onClick:t[3]||(t[3]=e=>k.open_close_new_position(!0))}," Новая позиция ")),(0,i._)("button",{class:"sync_icon btn",disabled:y.isUpdateProducts,onClick:t[4]||(t[4]=e=>k.updateProducts()),title:"Обновить список"},C,8,b),y.isGrid?((0,i.wg)(),(0,i.iD)("button",{key:1,class:"table_settings_btn",onClick:t[5]||(t[5]=e=>k.openTableSettings()),title:"Настройка таблицы"},P)):(0,i.kq)("",!0)])],2),(0,i._)("div",F,[y.isGrid?((0,i.wg)(),(0,i.j4)(j,{key:1,ref:"card",selectedWH:y.selectedWH},null,8,["selectedWH"])):((0,i.wg)(),(0,i.j4)(H,{key:0,ref:"main",selectedWH:y.selectedWH},null,8,["selectedWH"]))])],2)],2)}const S={class:"main"},$={key:0},D={key:0,class:"item"},q=["id","onUpdate:modelValue","onChange"],E=["for"],W={key:0},H={key:1},j=(0,i.Uk)("   "),Z=["onClick"],I={class:"item"},B=["onClick"],O={key:0,class:"text"};function T(e,t,s,l,r,n){const d=(0,i.up)("edit-item"),c=(0,i.up)("GridEditPrice"),u=(0,i.up)("main-grid-bar"),_=(0,i.up)("main-grid-filters"),p=(0,i.up)("grid-bottom");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",{class:(0,o.C_)(["wrapper",{blur:n.isDataLoading}])},[((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[e.show_edit_modal?((0,i.wg)(),(0,i.j4)(d,{key:0,edit_data:r.edit_data},null,8,["edit_data"])):(0,i.kq)("",!0)])),((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[n.showEditPrice?((0,i.wg)(),(0,i.j4)(c,{key:0,editPrice:r.editPrice,onClose:t[0]||(t[0]=e=>n.get_products(n.productsParams))},null,8,["editPrice"])):(0,i.kq)("",!0)])),(0,i._)("div",S,[(0,i._)("table",{class:(0,o.C_)(["table",{blur:e.show_edit_modal}]),ref:"table"},[(0,i._)("thead",null,[(0,i.Wm)(u,{ref:"bar",fields:n.all_fields,onSort:n.sort,onChangeAllSelectedProducts:n.changeAllSelectedProducts,tableConfig:n.tableConfig,sortedFields:n.sortedFields,class:"main-grid-bar"},null,8,["fields","onSort","onChangeAllSelectedProducts","tableConfig","sortedFields"]),(0,i.Wm)(_,{ref:"filters",fields:n.all_fields,tableConfig:n.tableConfig,sortedFields:n.sortedFields},null,8,["fields","tableConfig","sortedFields"])]),n.products.length?((0,i.wg)(),(0,i.iD)("tbody",$,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.products,((e,t)=>((0,i.wg)(),(0,i.iD)("tr",{class:"row",key:e.id},[n.oneC?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("td",D,[void 0!=r.selectedProducts[t]?(0,i.wy)(((0,i.wg)(),(0,i.iD)("input",{key:0,type:"checkbox",class:"checkbox",id:e.id,"onUpdate:modelValue":e=>r.selectedProducts[t].value=e,onChange:s=>r.selectedProducts[t].item=e},null,40,q)),[[a.e8,r.selectedProducts[t].value]]):(0,i.kq)("",!0),(0,i._)("label",{for:e.id},null,8,E)])),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.sortedFields,(t=>((0,i.wg)(),(0,i.iD)("td",{key:t,class:"item"},[t[0].split(".").length<2?((0,i.wg)(),(0,i.iD)("span",W,(0,o.zw)("free_4_reserve"===t[0]&&-1==e.fields[t[0]]?"∞":"category"==t[0]?n.categories[e.fields[t[0]]]:9==t[1].type?e.fields[t[0]]?"Да":"Нет":"cost_price"==t[0]?e.fields[t[0]]?Math.round(100*e.fields[t[0]])/100:"0":e.fields[t[0]]),1)):((0,i.wg)(),(0,i.iD)("span",H,(0,o.zw)("cost"==t[0].split(".")[1]?void 0==e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]?"0":e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]+" "+(void 0==e.fields?.[t[0].split(".")[0]]?.currency||null==e.fields?.[t[0].split(".")[0]]?.currency?"":e.fields?.[t[0].split(".")[0]]?.currency):9==t[1].type?e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]?"Да":"Нет":e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]),1)),j,"cost"==t[0].split(".")[1]?((0,i.wg)(),(0,i.iD)("button",{key:2,class:"edit_icon",style:{width:"16px",heigth:"16px"},onClick:s=>n.openGridEditPrice(e,t[0].split(".")[0]),title:"Редактирование цены"},null,8,Z)):(0,i.kq)("",!0)])))),128)),(0,i._)("td",I,[(0,i._)("div",{class:"edit_icon",onClick:t=>n.open_edit_modal(e),title:"Редактирование товара"},null,8,B)])])))),128))])):(0,i.kq)("",!0)],2),0==n.products.length?((0,i.wg)(),(0,i.iD)("label",O," Ничего не найдено ")):(0,i.kq)("",!0)]),(0,i.Wm)(p,{page:n.page,blur:e.show_edit_modal,show:0!=n.products.length,count:n.count,showBtns:n.showGridBottom,onChangePage:n.changePage,onChangeCount:n.changeCount},null,8,["page","blur","show","count","showBtns","onChangePage","onChangeCount"])],2),r.showArrow?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"arrow",onClick:t[1]||(t[1]=e=>n.scrollUp())})):(0,i.kq)("",!0)],64)}const V={class:"background_edit_modal"},A={class:"app_edit_modal"},G={class:"header"},L={class:"header_left"},Y={class:"header_right"},U=(0,i.Uk)("Отмена"),N=(0,i._)("div",{class:"hr"},null,-1),M={class:"main"},z={class:"row"},K=(0,i._)("label",null,"Тип:",-1),R={class:"row"},X=(0,i._)("label",null,"Категория:",-1),J=(0,i._)("div",{class:"hr"},null,-1),Q={class:"footer"},ee=(0,i.Uk)("Отмена");function te(e,t,s,l,r,n){const d=(0,i.up)("BtnsSaveClose"),c=(0,i.up)("SelectorVue"),u=(0,i.up)("edit-item-fields");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=(0,a.iM)((e=>n.close()),["self"]))}),(0,i._)("div",V,[(0,i._)("div",A,[(0,i._)("div",G,[(0,i._)("div",L," Редактирование "+(0,o.zw)(s.edit_data.fields["name"]),1),(0,i._)("div",Y,[(0,i.Wm)(d,{onClose:n.close,onSave:n.save},(0,i.Nv)({close:(0,i.w5)((()=>[U])),_:2},[n.oneC?void 0:{name:"other_btns",fn:(0,i.w5)((()=>[(0,i._)("button",{class:"btn btn3",onClick:t[1]||(t[1]=e=>n.archive())},"Архивировать")]))}]),1032,["onClose","onSave"])])]),N,(0,i._)("div",M,[(0,i._)("div",z,[K,(0,i.Wm)(c,{options_props:r.options_1,onSelect:n.option_select_1,selected_option:r.selected_option_1,disabled:n.oneC||!0},null,8,["options_props","onSelect","selected_option","disabled"])]),(0,i._)("div",R,[X,(0,i.Wm)(c,{options_props:r.categories_options,onSelect:n.option_select_cat,selected_option:r.selectedCategory},null,8,["options_props","onSelect","selected_option"])]),(0,i.Wm)(u,{new_edit_data:r.new_edit_data,onChange_value:n.change_value,onChangeEditPrices:n.changeEditPrices},null,8,["new_edit_data","onChange_value","onChangeEditPrices"])]),J,(0,i._)("div",Q,[(0,i.Wm)(d,{onClose:n.close,onSave:n.save},(0,i.Nv)({close:(0,i.w5)((()=>[ee])),_:2},[n.oneC?void 0:{name:"other_btns",fn:(0,i.w5)((()=>[(0,i._)("button",{class:"btn btn3",onClick:t[2]||(t[2]=e=>n.archive())},"Архивировать")]))}]),1032,["onClose","onSave"])])])])],64)}var se=s(7720),ie=s(4038);function oe(e,t,s,o,a,l){const r=(0,i.up)("edit-integer"),n=(0,i.up)("edit-float"),d=(0,i.up)("edit-string"),c=(0,i.up)("edit-text"),u=(0,i.up)("edit-selector"),_=(0,i.up)("edit-multi-selector"),p=(0,i.up)("edit-date"),h=(0,i.up)("edit-date-time"),m=(0,i.up)("edit-flag"),g=(0,i.up)("edit-price"),f=(0,i.up)("edit-wh");return(0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.copy_fields_with_parents,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"row",key:e.id},[1==e.type?((0,i.wg)(),(0,i.j4)(r,{key:0,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),2==e.type?((0,i.wg)(),(0,i.j4)(n,{key:1,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),3==e.type?((0,i.wg)(),(0,i.j4)(d,{key:2,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),4==e.type?((0,i.wg)(),(0,i.j4)(c,{key:3,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),5==e.type?((0,i.wg)(),(0,i.j4)(u,{key:4,item:e,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),6==e.type?((0,i.wg)(),(0,i.j4)(_,{key:5,item:e,selected_options:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_options","idx","disabled","onChange_value"])):(0,i.kq)("",!0),7==e.type?((0,i.wg)(),(0,i.j4)(p,{key:6,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),8==e.type?((0,i.wg)(),(0,i.j4)(h,{key:7,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),9==e.type?((0,i.wg)(),(0,i.j4)(m,{key:8,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0),11==e.type?((0,i.wg)(),(0,i.j4)(g,{key:9,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,currencies:a.currencies,onChange_value:l.change_value,onChangeEditPrice:l.changeEditPrice},null,8,["item","selected_option","idx","disabled","currencies","onChange_value","onChangeEditPrice"])):(0,i.kq)("",!0),13==e.type?((0,i.wg)(),(0,i.j4)(f,{key:10,item:e.name,selected_option:s.new_edit_data.fields[e.code],idx:e.code,disabled:!e.is_editable,onChange_value:l.change_value},null,8,["item","selected_option","idx","disabled","onChange_value"])):(0,i.kq)("",!0)])))),128)}var ae=s(2675),le=s(9098),re=s(8592),ne=s(293),de=s(3078),ce=s(4254),ue=s(5226),_e=s(5389),pe=s(973);const he=e=>((0,i.dD)("data-v-38cfb6b6"),e=e(),(0,i.Cn)(),e),me={class:"row"},ge={class:"right"},fe={key:0,class:"qew"},ve=he((()=>(0,i._)("label",{for:"0"},"Изменить цену этого товара в открытых сделках?",-1)));function we(e,t,s,l,r,n){const d=(0,i.up)("edit-float"),c=(0,i.up)("edit-selector"),u=(0,i.up)("edit-flag");return(0,i.wg)(),(0,i.iD)("div",me,[(0,i._)("label",null,(0,o.zw)(s.item)+":",1),(0,i._)("div",ge,[(0,i.Wm)(d,{item:"Значение",selected_option:r.copy_selected_option?.cost,idx:s.idx+"cost",disabled:s.disabled,onChange_value:t[0]||(t[0]=e=>n.option_select(e,"cost"))},null,8,["selected_option","idx","disabled"]),n.isNewPrice?((0,i.wg)(),(0,i.iD)("div",fe,[(0,i.wy)((0,i._)("input",{type:"checkbox",id:"0",class:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>r.editPrice.is_update_leads=e)},null,512),[[a.e8,r.editPrice.is_update_leads]]),ve])):(0,i.kq)("",!0),(0,i.Wm)(c,{item:{name:"Валюта",data:s.currencies},selected_option:r.copy_selected_option?.currency,idx:s.idx+"currency",disabled:s.disabled,onChange_value:t[2]||(t[2]=(e,t,s)=>n.option_select(e,"currency",s,t))},null,8,["item","selected_option","idx","disabled"]),(0,i.Wm)(u,{item:"С НДС",selected_option:r.copy_selected_option?.is_nds,idx:s.idx+"is_nds",disabled:s.disabled,onChange_value:t[3]||(t[3]=e=>n.option_select(e,"is_nds"))},null,8,["selected_option","idx","disabled"]),(0,i.Wm)(a.W3,{name:"modal"},{default:(0,i.w5)((()=>[r.copy_selected_option?.is_nds?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i.kq)("",!0),(0,i.Wm)(u,{item:"НДС включен в цену",selected_option:r.copy_selected_option?.is_price_include_nds,idx:s.idx+"is_price_include_nds",disabled:s.disabled,onChange_value:t[5]||(t[5]=e=>n.option_select(e,"is_price_include_nds"))},null,8,["selected_option","idx","disabled"]),(0,i.Wm)(d,{item:"НДС значение",selected_option:r.copy_selected_option?.nds,idx:s.idx+"nds",disabled:s.disabled,onChange_value:t[6]||(t[6]=e=>n.option_select(e,"nds"))},null,8,["selected_option","idx","disabled"])],64)):(0,i.kq)("",!0)])),_:1})])])}var be={components:{EditFloat:le.Z,EditSelector:de.Z,EditFlag:pe.Z},props:{item:{type:String,required:!0,default(){return""}},selected_option:{type:Object,required:!0},idx:{type:String,required:!0},disabled:{type:Boolean,required:!1,default(){return!1}},currencies:{type:Array}},data(){return{copy_selected_option:{},oldPrice:null,editPrice:{isNew:!0,price:"",is_update_leads:!1}}},mounted(){this.change_value(),(0,i.Y3)((()=>{this.oldPrice=this.selected_option.cost,void 0==this.selected_option.cost&&(this.oldPrice="",this.copy_selected_option.cost=""),this.dropEditPrice()}))},computed:{isNewPrice(){return this.oldPrice!=this.copy_selected_option?.cost},isChangePrice(){return{is_update_leads:this.editPrice.is_update_leads,cost:this.copy_selected_option.cost}}},watch:{selected_option:{handler:function(){this.change_value()},deep:!0},isNewPrice(){(0,i.Y3)((()=>{this.isNewPrice||this.dropEditPrice()}))},isChangePrice(){this.changeEditPrice()}},methods:{change_value(){(0,i.Y3)((()=>{this.copy_selected_option={...this.selected_option}}))},option_select(e,t,s){this.copy_selected_option[t]="currency"==t?s:e,this.$emit("change_value",this.copy_selected_option,this.idx)},dropEditPrice(){this.editPrice={isNew:!0,price:"",is_update_leads:!1}},changeEditPrice(){this.editPrice.isNew=this.isNewPrice,this.editPrice.price=this.copy_selected_option.cost,this.$emit("changeEditPrice",this.editPrice,this.idx)}}},ye=s(89);const Ce=(0,ye.Z)(be,[["render",we],["__scopeId","data-v-38cfb6b6"]]);var ke=Ce;const Pe={class:"row"},Fe={class:"right"};function xe(e,t,s,a,l,r){const n=(0,i.up)("edit-integer");return(0,i.wg)(),(0,i.iD)("div",Pe,[(0,i._)("label",null,(0,o.zw)(s.item)+":",1),(0,i._)("div",Fe,[(0,i.Wm)(n,{item:"На складе",selected_option:l.copy_selected_option?.count,idx:s.idx,disabled:s.disabled,onChange_value:t[0]||(t[0]=e=>r.option_select(e,"count"))},null,8,["selected_option","idx","disabled"]),(0,i.Wm)(n,{item:"В резерве",selected_option:l.copy_selected_option?.reserve,idx:s.idx,disabled:s.disabled,onChange_value:t[1]||(t[1]=e=>r.option_select(e,"reserve"))},null,8,["selected_option","idx","disabled"])])])}var Se={components:{EditInteger:ae.Z},props:{item:{type:String,required:!0,default(){return""}},selected_option:{type:Object,required:!0,default(){return{count:0,reserve:0}}},idx:{type:Number,required:!0},disabled:{type:Boolean,required:!1,default(){return!1}}},data(){return{copy_selected_option:{}}},mounted(){this.change_value()},watch:{selected_option:{handler:function(){this.change_value()},deep:!0}},methods:{change_value(){(0,i.Y3)((()=>{this.copy_selected_option={...this.selected_option}}))},option_select(e,t){this.copy_selected_option[t]=e,this.$emit("change_value",this.copy_selected_option,this.idx)}}};const $e=(0,ye.Z)(Se,[["render",xe],["__scopeId","data-v-14357ac1"]]);var De=$e,qe={components:{EditInteger:ae.Z,EditFloat:le.Z,EditString:re.Z,EditText:ne.Z,EditSelector:de.Z,EditMultiSelector:ce.Z,EditDate:ue.Z,EditDateTime:_e.Z,EditFlag:pe.Z,EditPrice:ke,EditWh:De},props:{new_edit_data:{type:Object,required:!0}},emits:{change_value:null},data(){return{copy_fields_with_parents:[],currencies:[],editPrices:[]}},async mounted(){await this.$store.dispatch("get_currencies"),Object.entries(this.$store.state.account.currencies).forEach((e=>this.currencies.push(e[1]))),this.currencies.map((e=>e.value=e.code_name)),(0,i.Y3)((async()=>{const e=this.new_edit_data.fields.category;await this.$store.dispatch("get_fields_with_parents",e),this.copy_fields_with_parents=[...this.$store.state.fields.fields_with_parents],this.fillEditPrices()}))},wath:{editPrices:{handler:function(){},deep:!0}},methods:{change_value(e,t){this.$emit("change_value",e,t)},fillEditPrices(){const e=this.copy_fields_with_parents.filter((e=>11==e.type));e.forEach((e=>this.editPrices.push({isNew:!1,product_id:this.new_edit_data.id,price:"",is_update_leads:!1,price_field_code:e.code})))},changeEditPrice(e,t){this.editPrices.map((s=>{s.price_field_code===t&&Object.assign(s,e)})),this.$emit("changeEditPrices",this.editPrices)}}};const Ee=(0,ye.Z)(qe,[["render",oe],["__scopeId","data-v-51be0a2a"]]);var We=Ee,He={components:{SelectorVue:se.Z,BtnsSaveClose:ie.Z,EditItemFields:We},props:{edit_data:{type:Object,required:!0}},inject:["isServicePage"],data(){return{options_1:[{name:"Товар",value:1},{name:"Услуга",value:2}],selected_option_1:{name:"Товар",value:1},new_edit_data:{},editPrices:[],categories_options:[],selectedCategory:{}}},computed:{oneC(){return this.$store.state.account.account?.config?.g_enabled},productsParams(){return this.$store.state.products.productsParams}},async mounted(){this.new_edit_data=JSON.parse(JSON.stringify(this.edit_data)),this.isServicePage.value?this.selected_option_1={...this.options_1[1]}:this.selected_option_1={...this.options_1[0]},await this.$store.dispatch("get_fields_properties"),this.get_categories_options(),this.searchSelectedCategory()},methods:{change_value(e,t){this.new_edit_data.fields[t]=e},option_select_1(e){this.selected_option_1={...e}},changeEditPrices(e){this.editPrices=[...e]},archive(){this.new_edit_data.is_archive=1,this.save()},close(){this.$store.commit("close_edit_modal")},async save(){this.dataPreparation(),await this.$store.dispatch("update_product",{products:[this.new_edit_data]}),this.editPrices.forEach((async e=>{if(e.isNew){const t={...e};t.is_update_leads=t.is_update_leads?1:0,await this.$store.dispatch("setPrice",t)}})),this.$store.dispatch("get_products",this.productsParams),this.close()},dataPreparation(){const e=[],t=Object.keys(this.new_edit_data?.fields),s=[];this.$store.state.fields.fields_with_parents.forEach((e=>s.push(e.code))),t.forEach((t=>{s.includes(t)||e.push(t)})),e.forEach((e=>delete this.new_edit_data?.fields[e]))},option_select_cat(e){this.selectedCategory=e,this.new_edit_data.fields.category=e.value},get_categories_options(){this.$store.state.categories.fields_properties.forEach((e=>{let t="";for(let s=1;s<e.level;s++)t+="    ";this.categories_options.push({name:t+e.name,value:e.id})}))},searchSelectedCategory(){const e=this.categories_options.find((e=>e.value==this.new_edit_data?.fields?.category));void 0!=e&&(this.selectedCategory=e)}}};const je=(0,ye.Z)(He,[["render",te]]);var Ze=je,Ie=s(8697);const Be=e=>((0,i.dD)("data-v-296b627f"),e=e(),(0,i.Cn)(),e),Oe={class:"filters"},Te={class:"item",key:"b1"},Ve=Be((()=>(0,i._)("th",{class:"item",key:"2b"},null,-1)));function Ae(e,t,s,o,l,r){const n=(0,i.up)("filter-number"),d=(0,i.up)("filter-text"),c=(0,i.up)("filter-list"),u=(0,i.up)("filter-date"),_=(0,i.up)("filter-flag");return(0,i.wg)(),(0,i.j4)(a.uT,{name:"mdl1"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("tr",Oe,[(0,i.Wm)(a.W3,{name:"mdl"},{default:(0,i.w5)((()=>[r.oneC?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("th",Te)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.filtersValue,((t,s)=>(0,i.wy)(((0,i.wg)(),(0,i.iD)("th",{key:s,class:"item"},[t.table_config?.filtered?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[1==t.type||2==t.type?((0,i.wg)(),(0,i.j4)(n,{key:0,item:t,idx:s,onChange_filter_value:r.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),3==t.type||4==t.type?((0,i.wg)(),(0,i.j4)(d,{key:1,item:t,idx:s,onChange_filter_value:r.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),5==t.type||6==t.type?((0,i.wg)(),(0,i.j4)(c,{key:2,item:t,idx:s,selector_options:t.selector_options,onChange_filter_value:r.change_filter_value},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,i.kq)("",!0),12==t.type?((0,i.wg)(),(0,i.j4)(c,{key:3,item:t,idx:s,selector_options:l.categories_options,onChange_filter_value:r.change_filter_value},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,i.kq)("",!0),7==t.type||8==t.type?((0,i.wg)(),(0,i.j4)(u,{key:4,item:t,idx:s,onChange_filter_value:r.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),9==t.type?((0,i.wg)(),(0,i.j4)(_,{key:5,item:t,idx:s,onChange_filter_value:r.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0)],64)):(0,i.kq)("",!0)],512)),[[a.F8,e.show_filter]]))),128)),Ve])),_:1})],512),[[a.F8,e.show_filter]])])),_:1})}var Ge=s(0),Le=s(4197),Ye=s(999),Ue=s(4637),Ne=s(7564),Me=s(65),ze={props:{fields:{type:Array,required:!0,default(){return[]}},sortedFields:{type:Array,required:!0,default(){return[]}},tableConfig:{type:Object}},components:{FilterNumber:Ge.Z,FilterText:Le.Z,FilterList:Ye.Z,FilterDate:Ue.Z,FilterFlag:Ne.Z},data(){return{filtersValue:[],categories_options:[],isConfirmFilters:!1,filter:{}}},computed:{...(0,Me.Se)(["show_filter"]),oneC(){return this.$store.state.account.account?.config?.g_enabled},productsParams(){return this.$store.state.products.productsParams}},async mounted(){await this.$store.dispatch("get_fields_properties"),this.get_categories_options(),this.feelFilters()},watch:{sortedFields:{handler:function(){this.feelFilters()},deep:!0}},methods:{clearFilters(){this.feelFilters()},confirmFilters(){this.isConfirmFilters=!0;const e={};this.filtersValue.filter((e=>null!=e.value&&""!==e.value)).forEach((t=>{if(1!=t.type&&2!=t.type||(e[t.code]={compare:t.option,query:t.value}),3!=t.type&&4!=t.type||(e[t.code]={compare:t.option,query:t.value}),5!=t.type&&6!=t.type&&12!=t.type||t.value?.length&&(e[t.code]={compare:"in",query:t.value}),7==t.type){const s=t.value.split("~");s.forEach(((e,t)=>s[t]=e.split("-").join("."))),e[t.code]={from:s[0],to:s[1]}}if(8==t.type){const s=t.value.split("~");s.forEach(((e,t)=>{const i=e.split("T");i[0]=i[0].split("-").join("."),s[t]=i.join(" ")})),e[t.code]={from:s[0],to:s[1]}}})),this.filter=e,this.$store.commit("updateProductsParams",{filter:e,page:1}),this.$store.dispatch("get_products",this.productsParams)},change_filter_value(e,t){Object.assign(this.filtersValue[t],e)},setFalseIsConfirmFilters(){this.isConfirmFilters=!1},setTrueIsConfirmFilters(){this.isConfirmFilters=!0},feelFilters(){this.filtersValue=[];const e=[];this.sortedFields.forEach((t=>{let s={};s={...this.fields.filter((e=>e.code.split(".")[0]==t[0].split(".")[0]))[0]},s.type=t[1].type,s.code=t[0],e.push(s)})),e.forEach((e=>{const t=e=>{const t=[];return null!=e&&e.forEach(((e,s)=>t.push({name:e,value:s}))),t};let s=null;5!=e.type&&6!=e.type||(s=[]),9==e.type&&(s=1),12==e.type&&(s=[]);const i={type:e.type,code:e.code,option:"=",selector_options:t(e.data),value:s,table_config:e.table_config};this.filtersValue.push(i)}))},get_categories_options(){this.$store.state.categories.fields_properties.forEach((e=>{let t="";for(let s=1;s<e.level;s++)t+="-    ";this.categories_options.push({name:t+e.name,value:e.id})}))}}};const Ke=(0,ye.Z)(ze,[["render",Ae],["__scopeId","data-v-296b627f"]]);var Re=Ke;const Xe=e=>((0,i.dD)("data-v-045f5422"),e=e(),(0,i.Cn)(),e),Je={class:"bar_row"},Qe={key:0,class:"bar_item item"},et=Xe((()=>(0,i._)("label",{for:"all"},null,-1))),tt=["onClick"],st={class:"bar_item_group"},it={class:"bar_item item",style:{"min-width":"80px"}},ot=Xe((()=>(0,i._)("span",{class:"material-icons"}," settings ",-1))),at=[ot],lt=["disabled"],rt=Xe((()=>(0,i._)("span",{class:"material-icons-outlined"}," upload_file ",-1))),nt=[rt];function dt(e,t,s,l,r,n){return(0,i.wg)(),(0,i.iD)("tr",Je,[l.oneC?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("th",Qe,[(0,i.wy)((0,i._)("input",{type:"checkbox",class:"checkbox",id:"all","onUpdate:modelValue":t[0]||(t[0]=e=>l.allSelectedProducts=e),onChange:t[1]||(t[1]=e=>l.changeAllSelectedProducts())},null,544),[[a.e8,l.allSelectedProducts]]),et])),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.sortedFields,((e,t)=>((0,i.wg)(),(0,i.iD)("th",{class:"bar_item item",style:(0,o.j5)({minWidth:0!=l.width[t]?l.width[t]+"px":(l.collsCount>=8?100:l.collsCount>3?90:80)/l.collsCount+"%"}),onClick:t=>e[1].sortable&&9!=e[1].type?l.sort(e[0]):null,key:e},[(0,i._)("div",st,[(0,i._)("label",null,(0,o.zw)(e[1].name),1),e[1].sortable&&9!=e[1].type?((0,i.wg)(),(0,i.iD)("button",{key:0,class:(0,o.C_)(["bar_item_icon",{bar_item_icon_up:l.order.code===e[0]&&"desc"===l.order.prev_order,bar_item_icon_down:l.order.code===e[0]&&"asc"===l.order.prev_order}])},null,2)):(0,i.kq)("",!0)])],12,tt)))),128)),(0,i._)("th",it,[(0,i._)("div",null,[(0,i._)("button",{class:"settings_btn",onClick:t[2]||(t[2]=e=>l.openTableSettings()),title:"Настройка таблицы"},at),(0,i._)("button",{class:"test_btn",title:"Экспорт таблицы в xlsx",disabled:l.disableExportXlsx,onClick:t[3]||(t[3]=e=>l.exportXlsx())},nt,8,lt)])])])}var ct=s(2524),ut=s(9299),_t=s(4870),pt={props:{fields:{type:Array,required:!0,default(){return[]}},sortedFields:{type:Array,required:!0,default(){return[]}},tableConfig:{type:Object}},setup(e,t){const s=(0,_t.qj)({code:"",prev_order:""}),i=()=>{Object.assign(s,{code:"",prev_order:""})},o=e=>{const i=["asc","desc"];let o="";o=s.code===e&&s.prev_order==i[0]?i[1]:i[0],Object.assign(s,{code:e,prev_order:o}),e.split(".").length>1&&(e=e.split(".").join("->")),t.emit("sort",e,o)},a=(0,_t.Fl)((()=>e.tableConfig.length)),l=(0,_t.Fl)((()=>ut.Z.state.account.account?.config?.g_enabled)),r=(0,_t.Fl)((()=>1==ut.Z.state.account?.account?.id)),n=(0,_t.Fl)((()=>{let t=[];return e.fields.forEach((e=>{let s=0;9==e.type&&(s=90),7!=e.type&&8!=e.type||(s=150),t.push(s)})),t})),{addNotification:d}=(0,ct.l)(),c=(0,_t.Fl)((()=>ut.Z.state.products.productsParams)),u=(0,_t.iH)(!1),_=async()=>{u.value=!0;const{sort:t,filter:s,warehouse:i="",is_service:o=0}=c.value,a=[];Object.entries(e.tableConfig).filter((e=>e[1].visible)).sort(((e,t)=>e[1].sort>t[1].sort?1:e[1].sort==t[1].sort?0:e[1].sort<t[1].sort?-1:void 0)).forEach((e=>a.push(e[0])));const l={sort:t,filter:s,config:a,warehouse:i,is_service:o};ut.Z.dispatch("exportXlsx",l),d(0,"Добавлена задача","Экспорт списка товаров в xlsx"),u.value=!1},p=(0,_t.iH)(!1),h=()=>{t.emit("changeAllSelectedProducts",p.value)},m=()=>{p.value=!1},g=()=>{ut.Z.commit("open_table_settings")};return{order:s,sort:o,collsCount:a,oneC:l,isTest:r,width:n,productsParams:c,disableExportXlsx:u,exportXlsx:_,allSelectedProducts:p,changeAllSelectedProducts:h,dropAllSelectedProducts:m,openTableSettings:g,dropOrder:i}}};const ht=(0,ye.Z)(pt,[["render",dt],["__scopeId","data-v-045f5422"]]);var mt=ht;const gt=e=>((0,i.dD)("data-v-1d2f97db"),e=e(),(0,i.Cn)(),e),ft={class:"wrapper"},vt={key:0,class:"container"},wt={class:"header"},bt={class:"content"},yt=gt((()=>(0,i._)("label",null,"Цена:",-1))),Ct={class:"footer"},kt=(0,i.Uk)("Назад"),Pt={key:1,class:"container"},Ft={class:"header"},xt=gt((()=>(0,i._)("label",null,"Изменить цену этого товара в открытых сделках?",-1))),St={class:"footer"},$t=(0,i.Uk)("Нет");function Dt(e,t,s,l,r,n){const d=(0,i.up)("btns-save-close");return(0,i.wg)(),(0,i.iD)("div",ft,[(0,i._)("div",{class:"backdrop_with_filter",onClick:t[0]||(t[0]=e=>n.close())}),r.isAccept?((0,i.wg)(),(0,i.iD)("div",Pt,[(0,i._)("div",Ft,[xt,(0,i._)("button",{class:"btn cross",onClick:t[4]||(t[4]=e=>n.closeAccept())})]),(0,i._)("div",St,[(0,i.Wm)(d,{onClose:n.dismiss,show_save:!1},{close:(0,i.w5)((()=>[$t])),other_btns:(0,i.w5)((()=>[(0,i._)("button",{class:"btn btn_dark_blue",onClick:t[5]||(t[5]=e=>n.confirm())},"Да")])),_:1},8,["onClose"])])])):((0,i.wg)(),(0,i.iD)("div",vt,[(0,i._)("div",wt,[(0,i._)("label",null,'Изменение цены "'+(0,o.zw)(r.copyEditPrice?.name)+'"',1),(0,i._)("button",{class:"btn cross",onClick:t[1]||(t[1]=e=>n.close())})]),(0,i._)("div",bt,[yt,(0,i.wy)((0,i._)("input",{type:"number",class:"input","onUpdate:modelValue":t[2]||(t[2]=e=>r.copyEditPrice.price=e)},null,512),[[a.nr,r.copyEditPrice.price]])]),(0,i._)("div",Ct,[(0,i.Wm)(d,{onClose:n.close,show_save:!1},{close:(0,i.w5)((()=>[kt])),other_btns:(0,i.w5)((()=>[(0,i._)("button",{class:"btn btn_dark_blue",onClick:t[3]||(t[3]=e=>n.accept())}," Сохранить ")])),_:1},8,["onClose"])])]))])}var qt={components:{BtnsSaveClose:ie.Z},props:{editPrice:{type:Object}},data(){return{isAccept:!1,copyEditPrice:{name:"",price:0,product_id:null,is_update_leads:!1,price_field_code:null}}},mounted(){Object.assign(this.copyEditPrice,this.editPrice)},methods:{accept(){this.isAccept=!0},close(){this.$store.commit("openCloseEditPrice",!1)},closeAccept(){this.isAccept=!1},dismiss(){this.copyEditPrice.is_update_leads=!1,this.save()},confirm(){this.copyEditPrice.is_update_leads=!0,this.save()},async save(){const e={...this.copyEditPrice};e.is_update_leads=e.is_update_leads?1:0,delete e.name,await this.$store.dispatch("setPrice",e),this.close(),this.$emit("close")}}};const Et=(0,ye.Z)(qt,[["render",Dt],["__scopeId","data-v-1d2f97db"]]);var Wt=Et,Ht={name:"Main_grid",components:{EditItem:Ze,GridBottom:Ie.Z,MainGridFilters:Re,MainGridBar:mt,GridEditPrice:Wt},props:{selectedWH:{type:Object}},inject:["isServicePage"],data(){return{updateKey:0,selectedProducts:[],edit_data:{},showArrow:!1,editPrice:{}}},created(){window.addEventListener("scroll",this.handleScroll),this.$store.commit("updateIsLoading",!0)},unmounted(){window.removeEventListener("scroll",this.handleScroll),this.$store.commit("open_close_buttons",!1)},async mounted(){this.$store.commit("toggleIsNavBarDisabled",!0),await Promise.all([this.$store.dispatch("get_fields_properties"),this.$store.dispatch("getTableConfig","whs"!=this.selectedWH.value?this.selectedWH.value:""),this.$store.dispatch("get_all_fields"),this.get_products(this.productsParams)]),this.setSelectedProducts(),this.bar?.dropAllSelectedProducts(),this.$store.commit("toggleIsNavBarDisabled",!1)},computed:{sortedFields(){const e=Object.entries(this.tableConfig);return e.sort(((e,t)=>e[1].sort>t[1].sort?1:e[1].sort==t[1].sort?0:e[1].sort<t[1].sort?-1:void 0)).filter((e=>e[1].visible))},tableConfig(){return this.$store.state.account.tableConfig},categories(){const e={};return this.$store.state.categories.fields_properties.forEach((t=>e[t.id]=t.name)),e},oneC(){return this.$store.state.account.account?.config?.g_enabled},count(){return this.$store.state.account.user.config?.per_page},meta(){return this.$store.state.products.meta},all_fields(){return this.$store.state.fields.all_fields},filters(){return this.$refs.filters},show_buttons(){const e=this.selectedProducts.filter((e=>e.value)).length>0;return e},showEditPrice(){return this.$store.state.shows.showEditPrice},products(){return this.$store.state.products.products},bar(){return this.$refs.bar},page(){const e={first:this.getPageFromLink(this.meta?.links?.first),prev:this.getPageFromLink(this.meta?.links?.prev),current:this.meta?.meta?.current_page,next:this.getPageFromLink(this.meta?.links?.next),last:this.getPageFromLink(this.meta?.links?.last)};return e},showGridBottom(){return this.meta.meta.total>=this.meta.meta.per_page},table(){return this.$refs.table},productsParams(){return this.$store.state.products.productsParams},isDataLoading(){return this.$store.state.products.isLoading},isServicePageValue(){return this.isServicePage.value},...(0,Me.Se)(["show_edit_modal"])},watch:{isServicePageValue(){this.$store.commit("updateProductsParams",{is_service:this.isServicePageValue?1:0})},products:{handler:function(){this.updateKey+=1,(0,i.Y3)((()=>{this.filters?.isConfirmFilters||this.filters?.clearFilters(),this.filters?.setFalseIsConfirmFilters()}))},deep:!0},show_buttons(){this.$store.commit("open_close_buttons",this.show_buttons)},async selectedWH(){await this.$store.dispatch("getTableConfig","whs"!=this.selectedWH.value?this.selectedWH.value:""),this.bar?.dropOrder(),this.get_products(this.productsParams)}},methods:{getPageFromLink(e){return e?e.split("?page=")[1]:null},scrollUp(){window.scrollTo(0,0)},handleScroll(){const e=Math.round(this.bar?.$el?.getBoundingClientRect()?.y)-Math.round(this.table?.getBoundingClientRect()?.y)>10;this.showArrow=!!e},async clearFilters(){await(this.filters?.clearFilters()),this.filters?.confirmFilters()},confirmFilters(){this.filters?.confirmFilters()},isShow(e){const t={value:!1,second:""};return Object.entries(this.tableConfig).forEach((s=>{s[0].split(".")[0]==e&&s[1]?.visible&&(t.value=!0,t.second=s[0].split(".")[1])})),t},async changeCount(e){this.setTrueIsConfirmFilters(),await this.$store.dispatch("update_user",{per_page:e}),this.drop_page()},changePage(e){this.setTrueIsConfirmFilters();const t={page:e};this.$store.commit("updateProductsParams",t),this.get_products(this.productsParams)},setSelectedProducts(){this.selectedProducts=[];for(let e=0;e<this.count;e++)this.selectedProducts.push({value:!1,item:{}})},changeAllSelectedProducts(e){this.selectedProducts.map(((t,s)=>{t.value=e,t.item=e?this.products[s]:{}}))},async get_products(e){this.isServicePage.value&&(e={...e,is_service:1}),await this.$store.dispatch("get_products",e),this.setSelectedProducts(),this.bar?.dropAllSelectedProducts()},drop_page(){this.changePage(1)},open_edit_modal(e){this.setTrueIsConfirmFilters(),this.edit_data={...e},this.$store.commit("open_edit_modal",e.fields.category)},openGridEditPrice(e,t){this.editPrice={name:e.fields.name,price:void 0==e.fields?.[t]?.cost?0:e.fields[t].cost,product_id:e.id,price_field_code:t},this.$store.commit("openCloseEditPrice",!0)},setTrueIsConfirmFilters(){(0,i.Y3)((()=>this.filters?.setTrueIsConfirmFilters()))},sort(e,t){this.setTrueIsConfirmFilters();const s={page:1,sort:{by:e,order:t}};this.$store.commit("updateProductsParams",s),this.get_products(this.productsParams)}}};const jt=(0,ye.Z)(Ht,[["render",T],["__scopeId","data-v-f4200e3e"]]);var Zt=jt;const It=e=>((0,i.dD)("data-v-6f976e86"),e=e(),(0,i.Cn)(),e),Bt={class:"header"},Ot={class:"sort"},Tt=It((()=>(0,i._)("span",null,"Сортировать по:",-1))),Vt={class:"grid",ref:"grid"},At={key:0,class:"text"},Gt={class:"name"},Lt=It((()=>(0,i._)("span",null," :",-1))),Yt={class:"value"},Ut={key:0},Nt={key:1},Mt=(0,i.Uk)("   "),zt=["onClick"],Kt={class:"card_footer"},Rt=["id","onUpdate:modelValue","onChange"],Xt=["for"],Jt=["onClick"];function Qt(e,t,s,l,r,n){const d=(0,i.up)("edit-item"),c=(0,i.up)("GridEditPrice"),u=((0,i.up)("card-grid-filters"),(0,i.up)("SelectorVue")),_=(0,i.up)("CardGridCategories"),p=(0,i.up)("grid-bottom");return(0,i.wg)(),(0,i.iD)(i.HY,null,[((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[e.show_edit_modal?((0,i.wg)(),(0,i.j4)(d,{key:0,edit_data:r.edit_data},null,8,["edit_data"])):(0,i.kq)("",!0)])),((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[n.showEditPrice?((0,i.wg)(),(0,i.j4)(c,{key:0,editPrice:e.editPrice,onClose:t[0]||(t[0]=e=>n.get_products(n.productsParams))},null,8,["editPrice"])):(0,i.kq)("",!0)])),(0,i._)("div",{class:(0,o.C_)(["wrapper",{blur:e.show_edit_modal||n.isDataLoading}])},[(0,i._)("div",Bt,[(0,i.Wm)(a.uT,{name:"mdl"},{default:(0,i.w5)((()=>[(0,i.kq)("",!0)])),_:1}),(0,i._)("div",Ot,[Tt,(0,i.Wm)(u,{options_props:n.sortedFieldsForSort,selected_option:r.selectedSort.value,onSelect:n.selectSort},null,8,["options_props","selected_option","onSelect"]),(0,i._)("button",{class:(0,o.C_)(["bar_item_icon",{bar_item_icon_up:0===r.selectedSort?.order,bar_item_icon_down:1===r.selectedSort?.order}]),onClick:t[1]||(t[1]=e=>n.selectOrder())},null,2),(0,i._)("button",{class:"btn btn_blue",onClick:t[2]||(t[2]=e=>n.sort())},"Применить")])]),(0,i.Wm)(_,{onSelectCat:n.selectCat},null,8,["onSelectCat"]),(0,i._)("div",Vt,[0==n.products.length?((0,i.wg)(),(0,i.iD)("label",At," Ничего не найдено ")):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.products,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"card shadow-lg",key:e.id},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.sortedFields,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"row",key:t},[(0,i._)("div",Gt,[(0,i.Uk)((0,o.zw)(t[1].name),1),Lt]),(0,i._)("div",Yt,[t[0].split(".").length<2?((0,i.wg)(),(0,i.iD)("span",Ut,(0,o.zw)("free_4_reserve"===t[0]&&-1==e.fields[t[0]]?"∞":"category"==t[0]?n.categories[e.fields[t[0]]]:9==t[1].type?e.fields[t[0]]?"Да":"Нет":"cost_price"==t[0]?e.fields[t[0]]?Math.round(100*e.fields[t[0]])/100:"0":e.fields[t[0]]),1)):((0,i.wg)(),(0,i.iD)("span",Nt,(0,o.zw)("cost"==t[0].split(".")[1]?void 0==e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]?"0":e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]+" "+(void 0==e.fields?.[t[0].split(".")[0]]?.currency||null==e.fields?.[t[0].split(".")[0]]?.currency?"":e.fields?.[t[0].split(".")[0]]?.currency):9==t[1].type?e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]?"Да":"Нет":e.fields?.[t[0].split(".")[0]]?.[t[0].split(".")[1]]),1)),Mt,"cost"==t[0].split(".")[1]?((0,i.wg)(),(0,i.iD)("button",{key:2,class:"edit_icon",style:{width:"16px",heigth:"16px"},onClick:(0,a.iM)((s=>n.openGridEditPrice(e,t[0].split(".")[0])),["stop"]),title:"Редактирование цены"},null,8,zt)):(0,i.kq)("",!0)])])))),128)),(0,i._)("div",Kt,[n.oneC?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[void 0!=r.selectedProducts[t]?(0,i.wy)(((0,i.wg)(),(0,i.iD)("input",{key:0,type:"checkbox",class:"checkbox",id:e.id,"onUpdate:modelValue":e=>r.selectedProducts[t].value=e,onChange:s=>r.selectedProducts[t].item=e},null,40,Rt)),[[a.e8,r.selectedProducts[t].value]]):(0,i.kq)("",!0),(0,i._)("label",{for:e.id},null,8,Xt)],64)),(0,i._)("div",{class:"edit_icon",onClick:(0,a.iM)((t=>n.open_edit_modal(e)),["stop"]),title:"Редактирование товара"},null,8,Jt)])])))),128))],512),(0,i.Wm)(p,{page:n.page,blur:e.show_edit_modal,show:0!=n.products.length,count:n.count,showBtns:n.showGridBottom,onChangePage:n.changePage,onChangeCount:n.changeCount},null,8,["page","blur","show","count","showBtns","onChangePage","onChangeCount"])],2),r.showArrow?((0,i.wg)(),(0,i.iD)("button",{key:0,class:"arrow",onClick:t[3]||(t[3]=e=>n.scrollUp())})):(0,i.kq)("",!0)],64)}const es={key:0,class:"filters"},ts={class:"title"};function ss(e,t,s,l,r,n){const d=(0,i.up)("filter-number"),c=(0,i.up)("filter-text"),u=(0,i.up)("filter-list"),_=(0,i.up)("filter-date"),p=(0,i.up)("filter-flag");return e.show_filter?((0,i.wg)(),(0,i.iD)("div",es,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.filtersValue,((e,t)=>(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",{class:"item",key:t},[(0,i._)("div",ts,(0,o.zw)(e.name),1),1==e.type||2==e.type?((0,i.wg)(),(0,i.j4)(d,{key:0,item:e,idx:t,onChange_filter_value:n.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),3==e.type||4==e.type?((0,i.wg)(),(0,i.j4)(c,{key:1,item:e,idx:t,onChange_filter_value:n.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),5==e.type||6==e.type?((0,i.wg)(),(0,i.j4)(u,{key:2,item:e,idx:t,selector_options:e.selector_options,onChange_filter_value:n.change_filter_value},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,i.kq)("",!0),12==e.type?((0,i.wg)(),(0,i.j4)(u,{key:3,item:e,idx:t,selector_options:r.categories_options,onChange_filter_value:n.change_filter_value},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,i.kq)("",!0),7==e.type||8==e.type?((0,i.wg)(),(0,i.j4)(_,{key:4,item:e,idx:t,onChange_filter_value:n.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0),9==e.type?((0,i.wg)(),(0,i.j4)(p,{key:5,item:e,idx:t,onChange_filter_value:n.change_filter_value},null,8,["item","idx","onChange_filter_value"])):(0,i.kq)("",!0)])),[[a.F8,e.table_config?.filtered]]))),128))])):(0,i.kq)("",!0)}var is={props:{fields:{type:Array,required:!0,default(){return[]}},sortedFields:{type:Array,required:!0,default(){return[]}},tableConfig:{type:Object}},components:{FilterNumber:Ge.Z,FilterText:Le.Z,FilterList:Ye.Z,FilterDate:Ue.Z,FilterFlag:Ne.Z},data(){return{filtersValue:[],categories_options:[],isConfirmFilters:!1,filter:{}}},computed:{...(0,Me.Se)(["show_filter"]),oneC(){return this.$store.state.account.account?.config?.g_enabled},productsParams(){return this.$store.state.products.productsParams}},async mounted(){await this.$store.dispatch("get_fields_properties"),this.get_categories_options(),this.feelFilters()},methods:{clearFilters(){this.feelFilters()},confirmFilters(){this.isConfirmFilters=!0;const e={};this.filtersValue.filter((e=>null!=e.value)).forEach((t=>{if(1!=t.type&&2!=t.type||(e[t.code]={compare:t.option,query:t.value}),3!=t.type&&4!=t.type||(e[t.code]={compare:t.option,query:t.value}),5!=t.type&&6!=t.type&&12!=t.type||t.value?.length&&(e[t.code]={compare:"in",query:t.value}),7==t.type){const s=t.value.split("~");s.forEach(((e,t)=>s[t]=e.split("-").join("."))),e[t.code]={from:s[0],to:s[1]}}if(8==t.type){const s=t.value.split("~");s.forEach(((e,t)=>{const i=e.split("T");i[0]=i[0].split("-").join("."),s[t]=i.join(" ")})),e[t.code]={from:s[0],to:s[1]}}})),this.filter=e,this.$store.commit("updateProductsParams",{filter:e,page:1}),this.$store.dispatch("get_products",this.productsParams)},change_filter_value(e,t){Object.assign(this.filtersValue[t],e)},setFalseIsConfirmFilters(){this.isConfirmFilters=!1},setTrueIsConfirmFilters(){this.isConfirmFilters=!0},feelFilters(){this.filtersValue=[];const e=[];this.sortedFields.forEach((t=>{let s={};s={...this.fields.filter((e=>e.code.split(".")[0]==t[0].split(".")[0]))[0]},s.type=t[1].type,s.name=t[1].name,s.code=t[0],e.push(s)})),e.forEach((e=>{const t=e=>{const t=[];return null!=e&&e.forEach(((e,s)=>t.push({name:e,value:s}))),t};let s=null;5!=e.type&&6!=e.type||(s=[]),9==e.type&&(s=1),12==e.type&&(s=[]);const i={type:e.type,code:e.code,name:e.name,option:"=",selector_options:t(e.data),value:s,table_config:e.table_config};this.filtersValue.push(i)}))},get_categories_options(){this.$store.state.categories.fields_properties.forEach((e=>{let t="";for(let s=1;s<e.level;s++)t+="    ";this.categories_options.push({name:e.name,value:e.id})}))}}};const os=(0,ye.Z)(is,[["render",ss],["__scopeId","data-v-073c3f04"]]);var as=os;const ls=e=>((0,i.dD)("data-v-0b62f35a"),e=e(),(0,i.Cn)(),e),rs={class:"mb-6"},ns={class:"links"},ds=["disabled","onClick"],cs={class:"path"},us={class:"categories sls_grid"},_s=["onClick"],ps=ls((()=>(0,i._)("div",{class:"name"},null,-1))),hs={class:"value"},ms={key:0,class:"sls_row"},gs={key:1,class:"w-full h-full bg-black/30 absolute left-0 top-0 z-10"},fs=["src"],vs=["src"],ws={key:1,class:"sls_row"};function bs(e,t,s,a,l,r){return(0,i.wg)(),(0,i.iD)("div",rs,[(0,i._)("div",ns,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.categories.selected,((e,t)=>((0,i.wg)(),(0,i.iD)("button",{class:(0,o.C_)(["triangle",{triangle_last:!a.categories.filteredList.length&&a.categories.selected.length-1==t}]),disabled:a.categories.selected.length-1==t,key:e,onClick:t=>a.categories.select(e)},(0,o.zw)(e?.name),11,ds)))),128))]),(0,i._)("div",cs,[(0,i._)("div",us,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.categories.filteredList,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"card group/card relative",key:e,onClick:t=>a.categories.select(e)},[(0,i._)("div",{class:(0,o.C_)(["sls_row title relative z-20",{"text-white":e.img_url}])},[ps,(0,i._)("div",hs,(0,o.zw)(e.name),1)],2),a.isTest?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[e.img_url?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",ms)),e.img_url?((0,i.wg)(),(0,i.iD)("div",gs)):(0,i.kq)("",!0),e.img_url?((0,i.wg)(),(0,i.iD)("img",{key:2,src:e.img_url,class:"aspect-auto w-3/4 z-[3] absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 transition-all duration-300 group-hover/card:scale-[0.6]"},null,8,fs)):(0,i.kq)("",!0),e.img_url?((0,i.wg)(),(0,i.iD)("img",{key:3,src:e.img_url,class:"aspect-auto w-3/4 z-[2] blur2 absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 transition-all duration-300 group-hover/card:scale-[0.6]"},null,8,vs)):(0,i.kq)("",!0)],64)):((0,i.wg)(),(0,i.iD)("div",ws))],8,_s)))),128))])])])}var ys={emits:{selectCat:null},setup(e,t){const s=(0,_t.qj)({selected:[],list:[],filteredList:(0,i.Fl)((()=>s.list.filter((e=>e.parent_id===s.selected.at(-1).id)))),select:function(e){const s=this.selected.indexOf(e);-1==s?this.selected.push(e):this.selected.splice(s+1),t.emit("selectCat",this.selected.at(-1))},getList:async function(){this.list=await ut.Z.dispatch("get_fields_properties");const e=this.list.find((e=>0===e.parent_id));this.selected.push(e)}});(0,i.bv)((()=>{s.getList()}));const o=(0,i.Fl)((()=>1===ut.Z.state.account.account?.id));return{categories:s,isTest:o}}};const Cs=(0,ye.Z)(ys,[["render",bs],["__scopeId","data-v-0b62f35a"]]);var ks=Cs,Ps={name:"CardGrid",components:{EditItem:Ze,GridBottom:Ie.Z,CardGridFilters:as,GridEditPrice:Wt,SelectorVue:se.Z,CardGridCategories:ks},props:{selectedWH:{type:Object}},inject:["isServicePage"],emits:{},data(){return{edit_data:{},selectedProducts:[],showArrow:!1,orderList:["desc","asc"],selectedSort:{value:{name:"Не выбрано",value:-1},order:1}}},created(){window.addEventListener("scroll",this.handleScroll),this.$store.commit("updateIsLoading",!0)},unmounted(){window.removeEventListener("scroll",this.handleScroll),this.$store.commit("open_close_buttons",!1)},async mounted(){await Promise.all([this.$store.dispatch("get_fields_properties"),this.$store.dispatch("getTableConfig","whs"!=this.selectedWH.value?this.selectedWH.value:""),this.$store.dispatch("get_all_fields"),this.get_products(this.productsParams)]),this.setSelectedProducts()},computed:{sortedFields(){return this.sortedFieldsRow.filter((e=>e[1].visible))},sortedFieldsRow(){const e=Object.entries(this.tableConfig);return e.sort(((e,t)=>e[1].sort>t[1].sort?1:e[1].sort==t[1].sort?0:e[1].sort<t[1].sort?-1:void 0))},sortedFieldsForSort(){const e=[{name:"Не выбрано",value:-1}];return this.sortedFieldsRow.filter((e=>e[1].sortable&&9!=e[1].type)).forEach((t=>e.push({name:t[1].name,value:t[0]}))),e},tableConfig(){return this.$store.state.account.tableConfig},categories(){const e={};return this.$store.state.categories.fields_properties.forEach((t=>e[t.id]=t.name)),e},oneC(){return this.$store.state.account.account?.config?.g_enabled},count(){return this.$store.state.account.user.config?.per_page},meta(){return this.$store.state.products.meta},page(){const e={first:this.getPageFromLink(this.meta?.links?.first),prev:this.getPageFromLink(this.meta?.links?.prev),current:this.meta?.meta?.current_page,next:this.getPageFromLink(this.meta?.links?.next),last:this.getPageFromLink(this.meta?.links?.last)};return e},all_fields(){return this.$store.state.fields.all_fields},filters(){return this.$refs.filters},show_buttons(){const e=this.selectedProducts.filter((e=>e.value)).length>0;return e},showEditPrice(){return this.$store.state.shows.showEditPrice},products(){return this.$store.state.products.products},bar(){return this.$refs.bar},showGridBottom(){return this.meta.meta.total>=this.meta.meta.per_page},grid(){return this.$refs.grid},productsParams(){return this.$store.state.products.productsParams},isDataLoading(){return this.$store.state.products.isLoading},...(0,Me.Se)(["show_edit_modal"]),ref_links(){return this.$refs.links}},watch:{products:{handler:function(){this.updateKey+=1,(0,i.Y3)((()=>{this.filters?.isConfirmFilters||this.filters?.clearFilters(),this.filters?.setFalseIsConfirmFilters()}))},deep:!0},show_buttons(){this.$store.commit("open_close_buttons",this.show_buttons)},async selectedWH(){await this.$store.dispatch("getTableConfig","whs"!=this.selectedWH.value?this.selectedWH.value:""),this.bar?.dropOrder(),this.get_products(this.productsParams)}},methods:{getPageFromLink(e){return e?e.split("?page=")[1]:null},scrollUp(){window.scrollTo(0,0)},handleScroll(){const e=Math.round(this.grid?.getBoundingClientRect()?.y)<0;this.showArrow=!!e},async clearFilters(){await(this.filters?.clearFilters()),this.filters?.confirmFilters()},confirmFilters(){this.filters?.confirmFilters()},isShow(e){const t={value:!1,second:""};return Object.entries(this.tableConfig).forEach((s=>{s[0].split(".")[0]==e&&s[1]?.visible&&(t.value=!0,t.second=s[0].split(".")[1])})),t},async changeCount(e){this.setTrueIsConfirmFilters(),await this.$store.dispatch("update_user",{per_page:e}),this.drop_page()},changePage(e){this.setTrueIsConfirmFilters();const t={page:e};this.$store.commit("updateProductsParams",t),this.get_products(this.productsParams)},setSelectedProducts(){this.selectedProducts=[];for(let e=0;e<this.count;e++)this.selectedProducts.push({value:!1,item:{}})},async get_products(e){this.isServicePage.value&&(e={...e,is_service:1}),await this.$store.dispatch("get_products",e),this.setSelectedProducts()},drop_page(){this.changePage(1)},open_edit_modal(e){this.setTrueIsConfirmFilters(),this.edit_data={...e},this.$store.commit("open_edit_modal",e.fields.category)},openGridEditPrice(e,t){this.editPrice={name:e.fields.name,price:void 0==e.fields?.[t]?.cost?0:e.fields[t].cost,product_id:e.id,price_field_code:t},this.$store.commit("openCloseEditPrice",!0)},setTrueIsConfirmFilters(){(0,i.Y3)((()=>this.filters?.setTrueIsConfirmFilters()))},selectSort(e){this.selectedSort.value=e},selectOrder(){this.selectedSort.order?this.selectedSort.order=0:this.selectedSort.order=1},sort(){let e,t;-1!=this.selectedSort.value.value?(e=this.selectedSort.value.value,t=this.orderList[this.selectedSort.order]):(e="",t=""),this.setTrueIsConfirmFilters();const s={page:1,sort:{by:e,order:t}};this.$store.commit("updateProductsParams",s),this.get_products(this.productsParams)},emit_link(e){Object.assign(this.link,e)},selectCat(e){const t={filter:{category:{compare:"in",query:[e.id]}}};this.$store.commit("updateProductsParams",t),this.get_products(this.productsParams)}}};const Fs=(0,ye.Z)(Ps,[["render",Qt],["__scopeId","data-v-6f976e86"]]);var xs=Fs,Ss=s(2145),$s=s(6833);const Ds=e=>((0,i.dD)("data-v-0d2a00a9"),e=e(),(0,i.Cn)(),e),qs={key:0,class:"old"},Es={key:0},Ws=Ds((()=>(0,i._)("p",null," Внимание, обнаружены данные вашего аккаунта предыдущей версии склада. Для загрузки данных нажмите на кнопку ЗАГРУЗИТЬ. Загрузка может занять некоторое время. ",-1)));function Hs(e,t,s,o,a,l){return o.account?.is_exist_old_data&&!o.account?.is_old_data_loaded?((0,i.wg)(),(0,i.iD)("div",qs,[o.account?.is_old_data_load_start?((0,i.wg)(),(0,i.iD)("p",Es," Внимание! Идет загурзка данных аккаунта. Это может занять несколько минут ")):((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[Ws,(0,i._)("button",{class:"btn btn_yellow",onClick:t[0]||(t[0]=e=>o.importOldData("click"))}," Загрузить ")],64))])):(0,i.kq)("",!0)}var js={emits:["importComplete"],setup(e,t){const s=(0,i.Fl)((()=>ut.Z.state.account.account)),o=async e=>{if(s.value?.is_exist_old_data&&!s.value?.is_old_data_loaded&&(s.value?.is_old_data_load_start||"click"!=e||await ut.Z.dispatch("importOldData"),s.value?.is_old_data_load_start||"click"==e)){ut.Z.dispatch("get_account");const e=setInterval((async()=>{await ut.Z.dispatch("get_account"),(s.value?.is_old_data_loaded??!s.value?.is_old_data_load_start)&&(clearInterval(e),t.emit("importComplete"))}),5e3)}};return{account:s,importOldData:o}}};const Zs=(0,ye.Z)(js,[["render",Hs],["__scopeId","data-v-0d2a00a9"]]);var Is=Zs;const Bs={class:"whs"},Os={class:"radio_btns"},Ts=["value","id","checked","onChange"],Vs=["for"];function As(e,t,s,a,l,r){const n=(0,i.up)("AppInputSelect");return(0,i.wg)(),(0,i.iD)("div",Bs,[(0,i._)("div",Os,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.systemWhs,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"radio_btn",key:e},[(0,i._)("input",{type:"radio",value:e.value,id:e.name,name:"selected_storage",checked:s.selectedWH.value==e.value,onChange:t=>a.selectWH(e)},null,40,Ts),(0,i._)("label",{for:e.name},(0,o.zw)(e.name),9,Vs)])))),128)),a.customWhs.length?((0,i.wg)(),(0,i.j4)(n,{key:0,list:a.sortedCustomWhs,selected:s.selectedWH,requestDelay:0,placeholder:a.customWhs.includes(s.selectedWH)?s.selectedWH.name:"Выберите склад",input_uderline:!0,onChangeInputValue:a.changeInputValueWhs,onSelect:a.selectWH},null,8,["list","selected","placeholder","onChangeInputValue","onSelect"])):(0,i.kq)("",!0)])])}var Gs=s(5477),Ls={components:{AppInputSelect:Gs.Z},props:{selectedWH:Object},setup(e,t){const s=(0,_t.iH)([]),o=(0,_t.iH)([]),a=(0,_t.iH)([]),l=(0,i.Fl)((()=>ut.Z.state.account.account.whs));(0,i.YP)(l,(()=>r()));const r=()=>n(),n=()=>{s.value=[],o.value=[],a.value=[];const{system:e,custom:t}=ut.Z.state.account.account.whs2;e.forEach((e=>{o.value.push({name:e.name,value:e.code}),s.value.push({name:e.name,value:e.code})})),o.value.push({name:"Услуги",value:"services"}),s.value.push({name:"Услуги",value:"services"}),t.forEach((e=>{a.value.push({name:e.name,value:e.code}),s.value.push({name:e.name,value:e.code})}))},d=e=>t.emit("update:selectedWH",e),c=(0,_t.iH)(""),u=e=>c.value=e,_=(0,i.Fl)((()=>a.value.filter((e=>e?.name?.toLowerCase()?.includes(c.value?.toLowerCase())))));return{whs:s,changeStoreWhs:r,selectWH:d,systemWhs:o,customWhs:a,changeInputValueWhs:u,sortedCustomWhs:_}}};const Ys=(0,ye.Z)(Ls,[["render",As],["__scopeId","data-v-cbd4be46"]]);var Us=Ys,Ns=s(1624);const Ms={key:0,class:"buttons"},zs=["disabled"];function Ks(e,t,s,o,l,r){return(0,i.wg)(),(0,i.j4)(a.uT,{name:"btns"},{default:(0,i.w5)((()=>[o.show_buttons&&!o.oneC?((0,i.wg)(),(0,i.iD)("div",Ms,[s.isServicePage?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i._)("button",{class:"btn btn_tempest smallBtn",onClick:t[0]||(t[0]=e=>o.addCurrentProducts()),disabled:o.oneC}," Добавить ",8,zs),(0,i._)("button",{class:"btn btn_pink smallBtn",onClick:t[1]||(t[1]=e=>o.openCancelPosition())}," Списать "),(0,i._)("button",{class:"btn btn_light_yellow smallBtn",onClick:t[2]||(t[2]=e=>o.openMoveProductsBetweenWhs())}," Перемещение ")],64)),(0,i._)("button",{class:"btn btn_grey smallBtn",onClick:t[3]||(t[3]=e=>o.archive_data())}," Архивировать ")])):(0,i.kq)("",!0)])),_:1})}var Rs={props:{isServicePage:Boolean},emits:["setCurrentItems","archive_data"],setup(e,t){const s=(0,i.Fl)((()=>ut.Z.state.shows.show_buttons)),o=(0,i.Fl)((()=>ut.Z.state.account.account?.config?.g_enabled)),a=(0,i.Fl)((()=>1==ut.Z.state.account?.account?.id)),l=()=>{d(),ut.Z.commit("open_close_new_position",!0)},r=()=>{d(),ut.Z.commit("open_close_cancel_position",!0)},n=()=>{d(),ut.Z.commit("openCloseMoveProductsBetweenWhs",!0)},d=()=>t.emit("setCurrentItems"),c=()=>t.emit("archive_data");return{show_buttons:s,oneC:o,isTest:a,addCurrentProducts:l,openCancelPosition:r,openMoveProductsBetweenWhs:n,archive_data:c}}};const Xs=(0,ye.Z)(Rs,[["render",Ks],["__scopeId","data-v-0071b370"]]);var Js=Xs;const Qs=e=>((0,i.dD)("data-v-21503428"),e=e(),(0,i.Cn)(),e),ei={class:"filter_group"},ti=Qs((()=>(0,i._)("label",{for:"filter"},"Фильтр",-1))),si={key:0,class:"btns"};function ii(e,t,s,o,l,r){return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",ei,[(0,i.wy)((0,i._)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>o.filterValue=e),name:"filter",id:"filter",class:"checkbox"},null,512),[[a.e8,o.filterValue]]),ti]),o.filterValue?((0,i.wg)(),(0,i.iD)("div",si,[(0,i._)("button",{class:"btn btn_tempest",onClick:t[1]||(t[1]=e=>o.confirmFilters())},"Применить"),(0,i._)("button",{class:"btn btn_rusty_red",onClick:t[2]||(t[2]=e=>o.clearFilters())},"Очистить")])):(0,i.kq)("",!0)],64)}var oi={emits:["confirmFilters","clearFilters"],setup(e,t){const s=(0,_t.iH)(!1);(0,i.YP)(s,(()=>ut.Z.commit("open_close_filter",s.value)));const o=()=>t.emit("confirmFilters"),a=()=>t.emit("clearFilters");return{filterValue:s,confirmFilters:o,clearFilters:a}}};const ai=(0,ye.Z)(oi,[["render",ii],["__scopeId","data-v-21503428"]]);var li=ai,ri={components:{MainGrid:Zt,CardGrid:xs,HomeModals:Ss.Z,NavBar:$s.Z,HomeImportOldData:Is,HomeWhs:Us,HomeMenu:Ns.Z,HomeBtns:Js,HomeFilter:li},provide(){return{isServicePage:(0,i.Fl)((()=>this.isServicePage))}},data(){return{is_in_wh:!0,paginatedData:[],paginatedParams:[],selectedWH:{name:"Все склады",value:"whs"},isGrid:!1,currentItems:[],isUpdateProducts:!1}},computed:{date(){const e=new Date;let t=e.getDate(),s=e.getMonth()+1;const i=e.getFullYear();s<10&&(s="0"+s),t<10&&(t="0"+t);const o=i+"-"+s+"-"+t;return o},isServicePage(){return"services"===this.selectedWH.value},...(0,Me.Se)(["home_blur","show_modals","disabled_for_modals","show_edit_modal"]),totalCountProducts(){return this.$store.state.products.meta.meta.total},oneC(){return this.$store.state.account.account?.config?.g_enabled},account(){return this.$store.state.account.account},user(){return this.$store.state.account.user},ref_main(){return this.$refs.main},ref_card(){return this.$refs.card},ref_homeWhs(){return this.$refs.homeWhs},isTest(){return 1==this.$store.state.account?.account?.id},filteredSelectedProducts(){let e=[];return e=this.isGrid?[...this.ref_card?.selectedProducts.filter((e=>e.value&&e.item))]:[...this.ref_main?.selectedProducts.filter((e=>e.value&&e.item))],e}},async mounted(){await this.$store.dispatch("get_account"),this.ref_homeWhs?.changeStoreWhs(),this.$refs?.oldData?.importOldData("start"),this.is_in_wh=this.user?.config?.is_in_wh},watch:{show_modals(){this.show_modals?(window.scrollTo(0,0),document.body.style.overflowX="hidden"):document.body.style.overflowX="auto"},selected_storage(){this.$store.commit("updateIsLoading",!0),this.isGrid?this.ref_card.drop_page():this.ref_main.drop_page()},async is_in_wh(){await this.$store.dispatch("update_user",{is_in_wh:this.is_in_wh}),this.updateProducts()},selectedWH(){this.$store.commit("updateProductsParams",{warehouse:"whs"===this.selectedWH.value||this.isServicePage?"":this.selectedWH.value})}},methods:{confirmFilters(){this.isGrid?this.ref_card?.confirmFilters():this.ref_main?.confirmFilters()},clearFilters(){this.isGrid?this.ref_card?.clearFilters():this.ref_main?.clearFilters()},importComplete(){this.ref_homeWhs?.changeStoreWhs(),this.clearFilters(),this.updateProducts()},async archive_data(){const e={products:[]};this.filteredSelectedProducts?.forEach((t=>{t.item.is_archive=1,e.products.push(t.item)})),await this.$store.dispatch("update_product",e);const t=this.$store.state.products.meta.meta.current_page;this.isGrid?this.ref_card?.changePage(t):this.ref_main?.changePage(t)},setCurrentItems(){let e=JSON.parse(JSON.stringify(this.filteredSelectedProducts));e=e.filter((e=>void 0!==e.item)),this.currentItems=[...e.map((e=>e.item))]},dropCurrentItems(){this.currentItems=[]},open_close_new_position(e){this.$store.commit("open_close_new_position",e)},openTableSettings(){this.$store.commit("open_table_settings")},updateProducts(){this.isUpdateProducts=!0,setTimeout((()=>{this.isUpdateProducts=!1}),2250),this.isGrid?(this.ref_card?.changePage(this.$store.state.products.meta.meta.current_page),this.ref_card?.setSelectedProducts()):(this.ref_main?.changePage(this.$store.state.products.meta.meta.current_page),this.ref_main?.setSelectedProducts()),this.dropCurrentItems()}}};const ni=(0,ye.Z)(ri,[["render",x],["__scopeId","data-v-46388382"]]);var di=ni}}]);
//# sourceMappingURL=501.3a79f08b.js.map