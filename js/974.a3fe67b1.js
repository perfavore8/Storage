"use strict";(self["webpackChunkstorage"]=self["webpackChunkstorage"]||[]).push([[974],{1738:function(e,t,l){function s(){function e(e,t,l){l/=100;const s=t*Math.min(l,1-l)/100,a=t=>{const a=(t+e/30)%12,n=l-s*Math.max(Math.min(a-3,9-a,1),-1);return Math.round(255*n).toString(16).padStart(2,"0")};return`#${a(0)}${a(8)}${a(4)}`}function t(){for(var e="0123456789ABCDEF",t="#",l=0;l<6;l++)t+=e[Math.floor(16*Math.random())];return t}function l(){for(var e="0123456789ABCD",t="#",l=0;l<6;l++)t+=e[Math.floor(14*Math.random())];return t}function s(t){const l=Math.floor(256*Math.random());let s=e(l,100,50);return t&&(s+=t),s}return{getRandomColor:t,getRandomColor2:l,getRandomColor3:s}}l.d(t,{r:function(){return s}})},7614:function(e,t,l){l.d(t,{M:function(){return a}});var s=l(6413);function a(e="timer",t=3e3,l=!1){const[a,n]=(0,s.OT)(l),i=async(l=e,s,a)=>{if(n(!0),"timer"===l)setTimeout((()=>n(!1)),s||t);else if("async"===l&&a)await a,n(!1);else if("asyncWithTimer"===l&&a)setTimeout((async()=>{await a,n(!1)}),s||t);else if("handle"===l)return},r=()=>n(!1);return{isLocked:a,lockBtn:i,handleUnLock:r}}},6515:function(e,t,l){l.d(t,{Z:function(){return u}});var s=l(3396),a=l(7139);function n(e,t,l,n,i,r){const o=(0,s.up)("AppPaginator"),d=(0,s.up)("selector-vue");return l.show?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(["bottom",{blur:l.blur}])},[l.showBtns?((0,s.wg)(),(0,s.j4)(o,{key:0,page:l.page,disabled:l.disabled,onChangePage:r.changePage},null,8,["page","disabled","onChangePage"])):(0,s.kq)("",!0),l.showSelector?((0,s.wg)(),(0,s.j4)(d,{key:1,disabled:l.disabled,class:"count",options_props:i.count_values,selected_option:{name:l.count,value:-1},onSelect:r.change_count},null,8,["disabled","options_props","selected_option","onSelect"])):(0,s.kq)("",!0)],2)):(0,s.kq)("",!0)}var i=l(7720),r=l(7570),o={components:{SelectorVue:i.Z,AppPaginator:r.Z},props:{previous:{type:Boolean,required:!1},next:{type:Boolean,required:!1},page:{type:Object,required:!1,default(){return{first:1,prev:null,current:1,next:null,last:1}}},count:{type:Number,required:!0},blur:{type:Boolean,required:!1,default:!1},show:{type:Boolean,required:!1,default:!0},showBtns:{type:Boolean,required:!1,default:!0},showSelector:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1}},emits:{changePage:null,changeCount:null},data(){return{count_values:[]}},async mounted(){await this.$store.dispatch("get_account"),this.$store.state.account.user.config.per_pages&&(this.count_values=[...this.$store.state.account.user.config.per_pages].map(((e,t)=>({name:e,value:t}))))},computed:{},methods:{changePage(e){this.$emit("changePage",e)},change_count(e){this.$emit("changeCount",e.name)}}},d=l(89);const c=(0,d.Z)(o,[["render",n],["__scopeId","data-v-4bee144d"]]);var u=c},4974:function(e,t,l){l.r(t),l.d(t,{default:function(){return ct}});var s=l(3396),a=l(9242),n=l(7139);const i=e=>((0,s.dD)("data-v-5f099650"),e=e(),(0,s.Cn)(),e),r={class:"app"},o={class:"header pt-[20px] bg-white pb-3 px-2 md:px-[30px] static w-full md:w-[calc(100vw-20px)] md:sticky max-w-[100vw] md:max-w-none"},d={key:0,class:"filters md:sticky md:left-[30px] w-[calc(100vw-16px)] md:w-[calc(100vw-70px)] flex flex-col md:flex-row justify-between items-center relative gap-2"},c={class:"flex flex-row flex-wrap sm:flex-nowrap items-center gap-2 h-fit basis-1/3 order-2 md:order-1"},u={class:"flex flex-row items-center gap-2 w-full"},p={key:0,class:"flex items-center w-full"},m={for:"hideFinalSteps",class:"whitespace-pre-wrap"},f={class:"basis-1/3 flex justify-end order-3"},g={class:"absolute -bottom-[42px] right-0 flex flex-row gap-3 items-center"},_=["disabled","title"],v=i((()=>(0,s._)("span",{class:"material-icons-outlined"}," sync ",-1))),w=[v],h=i((()=>(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 512 512"},[(0,s._)("path",{fill:"#757575",d:"M495.9 166.6c3.2 8.7.5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4l-55.6 17.8c-8.8 2.8-18.6.3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4c-1.1-8.4-1.7-16.9-1.7-25.5s.6-17.1 1.7-25.4l-43.3-39.4c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160a80 80 0 1 0 0 160z"})],-1))),b=[h],y={key:0,class:"absolute -bottom-[42px] left-0 flex flex-row gap-3 items-center"};function x(e,t,l,i,v,h){const x=(0,s.up)("AppHeader"),k=(0,s.up)("OrdersKanbanPipelineSelect"),F=(0,s.up)("AppSearchWithFilters");(0,s.up)("OrdersFilters");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",o,[(0,s.Wm)(x,{selectedWH:{name:i.t("orders.ors"),value:"kanban"===i.displayType.selected.name?"ordersKanBan":"orders",maxCountSelected:"kanban"===i.displayType.selected.name?5:999999}},null,8,["selectedWH"])]),((0,s.wg)(),(0,s.iD)("div",{class:"wrapper mt-4 md:mt-[80px] px-2 md:px-[30px] max-w-[100vw] md:max-w-none",key:i.OrderViewKey},[i.isTest2?((0,s.wg)(),(0,s.iD)("div",d,[(0,s._)("div",c,[(0,s._)("div",u,[(0,s._)("button",{class:"cursor-pointer h-7",onClick:t[0]||(t[0]=e=>i.displayType.selectNext())},[(0,s.Wm)(a.uT,{name:"modal",mode:"out-in",duration:100},{default:(0,s.w5)((()=>[((0,s.wg)(),(0,s.iD)("span",{class:"material-icons-round !font-semibold !text-[28px] !text-[#757575] select-none",key:i.displayType.selected.name},(0,n.zw)(i.displayType.nextItem.icon),1))])),_:1})]),((0,s.wg)(),(0,s.j4)(k,{class:"w-full",key:i.displayType.selected.name,needAll:"grid"===i.displayType.selected.name},null,8,["needAll"]))]),e.isMain||i.isTest2?((0,s.wg)(),(0,s.iD)("div",p,[(0,s.wy)((0,s._)("input",{type:"checkbox",id:"hideFinalSteps",class:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>i.hideFinalSteps=e)},null,512),[[a.e8,i.hideFinalSteps]]),(0,s._)("label",m,(0,n.zw)(e.$t("orders.hfs")),1)])):(0,s.kq)("",!0),(0,s._)("button",{class:"btn btn_dark_blue md:hidden whitespace-nowrap w-full",onClick:t[2]||(t[2]=e=>i.addToDeal())},(0,n.zw)(e.$t("orders.cre")),1)]),((0,s.wg)(),(0,s.j4)(F,{class:"grow basis-1/3 order-1 md:order-2 w-full",setOfInstructions:"orders",key:e.selectedTabComp,onEmitParams:i.emitParams},null,8,["onEmitParams"])),(0,s._)("div",f,[(0,s._)("button",{class:"btn btn_dark_blue hidden md:block",onClick:t[3]||(t[3]=e=>i.addToDeal())},(0,n.zw)(e.$t("orders.cre")),1)]),(0,s._)("div",g,[(0,s._)("button",{class:"sync_icon btn",disabled:i.isLocked,onClick:t[4]||(t[4]=e=>i.updateList()),title:e.$t("orders.up")},w,8,_),i.isTest2&&i.currentSetSettingsInFolder.tableSettingsBtn?((0,s.wg)(),(0,s.iD)("div",{key:0,onClick:t[5]||(t[5]=e=>i.openTableSettings()),class:"tableSettings"},b)):(0,s.kq)("",!0)]),"grid"===i.displayType.selected.name?((0,s.wg)(),(0,s.iD)("div",y,(0,n.zw)(e.$t("orders.sd"))+" "+(0,n.zw)(i.grid?.meta?.meta?.total||0)+" | "+(0,n.zw)(i.formatNumber(i.grid?.meta?.meta?.sum))+" ₽ ",1)):(0,s.kq)("",!0)])):(0,s.kq)("",!0),(0,s.kq)("",!0),(0,s.Wm)(a.uT,{name:"modal"},{default:(0,s.w5)((()=>[((0,s.wg)(),(0,s.j4)((0,s.LL)(i.displayType.selected.component),{ref:"grid",key:i.displayType.selected.name,hideFinalSteps:i.hideFinalSteps},null,8,["hideFinalSteps"]))])),_:1})]))])}var k=l(9240);const F=e=>((0,s.dD)("data-v-e771e992"),e=e(),(0,s.Cn)(),e),C={class:"flex flex-col gap-2"},D={class:"filters"},T={class:"title"},S={key:7,class:"selected"},Z=["onClick"],q=F((()=>(0,s._)("div",{class:"icon"},null,-1))),O={class:"btns self-end"};function P(e,t,l,a,i,r){const o=(0,s.up)("filter-number"),d=(0,s.up)("filter-text"),c=(0,s.up)("filter-list"),u=(0,s.up)("filter-date"),p=(0,s.up)("filter-flag"),m=(0,s.up)("AppInputSelect");return(0,s.wg)(),(0,s.iD)("div",C,[(0,s._)("div",D,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.filtersValue,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["item",{item_wide:14==e.type}]),key:t},[(0,s._)("div",T,(0,n.zw)(e.name),1),1==e.type||2==e.type?((0,s.wg)(),(0,s.j4)(o,{key:0,item:e,idx:t,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","onChange_filter_value"])):(0,s.kq)("",!0),3==e.type||4==e.type?((0,s.wg)(),(0,s.j4)(d,{key:1,item:e,idx:t,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","onChange_filter_value"])):(0,s.kq)("",!0),5==e.type||6==e.type?((0,s.wg)(),(0,s.j4)(c,{key:2,item:e,idx:t,selector_options:e.selector_options,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,s.kq)("",!0),12==e.type?((0,s.wg)(),(0,s.j4)(c,{key:3,item:e,idx:t,selector_options:e.selector_options,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","selector_options","onChange_filter_value"])):(0,s.kq)("",!0),7==e.type||8==e.type?((0,s.wg)(),(0,s.j4)(u,{key:4,item:e,idx:t,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","onChange_filter_value"])):(0,s.kq)("",!0),9==e.type?((0,s.wg)(),(0,s.j4)(p,{key:5,item:e,idx:t,onChange_filter_value:e=>a.change_filter_value(e,t)},null,8,["item","idx","onChange_filter_value"])):(0,s.kq)("",!0),14==e.type?((0,s.wg)(),(0,s.j4)(m,{key:6,list:e.selector_options,countLettersReq:e.minLength,onChangeInputValue:t=>a.changeInputValue(t,e),onSelect:t=>a.selectField(t,e),onFocusin:t=>e.inFocus=!0,onFocusout:t=>e.inFocus=!1},null,8,["list","countLettersReq","onChangeInputValue","onSelect","onFocusin","onFocusout"])):(0,s.kq)("",!0),e.value.length&&14===e.type?((0,s.wg)(),(0,s.iD)("div",S,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.value,((t,l)=>((0,s.wg)(),(0,s.iD)("div",{key:t.value,class:"item",onClick:t=>a.deleteField(e,l)},[(0,s.Uk)((0,n.zw)(t.value)+" ",1),q],8,Z)))),128))])):(0,s.kq)("",!0)],2)))),128))]),(0,s._)("div",O,[(0,s._)("button",{class:"btn btn_blue",onClick:t[0]||(t[0]=e=>a.apply())},(0,n.zw)(e.$t("global.apply2")),1),(0,s._)("button",{class:"btn btn_grey",onClick:t[1]||(t[1]=e=>a.clearAllFields())},(0,n.zw)(e.$t("global.clear")),1)])])}var z=l(8701),L=l(4197),j=l(7438),I=l(6323),A=l(602),R=l(8890),B=l(4581),M=l(4870),$={components:{FilterNumber:z.Z,FilterText:L.Z,FilterList:j.Z,FilterDate:I.Z,FilterFlag:A.Z,AppInputSelect:R.Z},setup(){const e=(0,M.qj)([{name:"Дата создания",code:"date_create",type:7,value:"~"},{name:"Ответственые",code:"responsible",type:14,minLength:0,inFocus:!1,value:[],selector_options:[]},{name:"Статус заказа",code:"status",type:12,value:[],selector_options:[{name:"Открытый",value:1},{name:"Закрытый",value:0}]}]),t=(0,s.Fl)((()=>{const t=[];return e.forEach((e=>t.push(e.inFocus))),t}));(0,s.YP)(t,((t,l)=>{l.some((e=>e))&&t.every((e=>!e))&&(e[l.indexOf(!0)].selector_options=[])}));const l=async(t,l)=>{const s=e=>" "!=e.split("").at(-1)&&" "!=e.split("")[0],a=t=>e.find((e=>e.name==t));if(l.selector_options=[],s(t)&&a(l.name).inFocus){await B.Z.dispatch("getAutocompleteAnalytics",{field:l.code,value:{query:t}});const e=B.Z.state.analytics.autocomplete;void 0!=e&&(e.map((e=>e.name=e.value)),l.selector_options=[...e])}},a=(e,t)=>{t.value.some((t=>t.value==e.value))||t.value.push(e)},n=(e,t)=>e.value.splice(t,1),i=(t,l)=>{Object.assign(e[l],t)},r=()=>{const t={},l=e.find((e=>"date_create"===e.code)).value?.split("~")[0];l&&(t.date_create_from=l);const s=e.find((e=>"date_create"===e.code)).value?.split("~")[1];s&&(t.date_create_to=s);const a=[];e.find((e=>"responsible"===e.code))?.value?.forEach((e=>e.id?a.push(e.id):null)),a&&(t.responsible_id=a);const n=[];e.find((e=>"status"===e.code))?.value?.forEach((e=>""!==e?n.push(e):null)),n&&(t.status_id=n)},o=()=>{e.map((e=>{1!==e.type&&1!==e.type||(e.value=0),3!==e.type&&4!==e.type||(e.value=""),5!==e.type&&6!==e.type&&12!==e.type&&14!==e.type||(e.value=[]),7!==e.type&&8!==e.type||(e.value="~"),9===e.type&&(e.value=1)})),r()};return{filtersValue:e,changeInputValue:l,selectField:a,deleteField:n,change_filter_value:i,apply:r,clearAllFields:o}}},H=l(89);const E=(0,H.Z)($,[["render",P],["__scopeId","data-v-e771e992"]]);var Y=E;const K={class:"main mt-20 relative overflow-y-scroll"},V={key:1,class:"table relative",ref:"table"},N={class:"bar_row"},W=["onClick","colspan"],G={class:"bar_item_group"},U={key:0},Q={key:0,class:"item",style:{padding:"5px 10px 5px 15px"}},X={class:"stat"},J={class:"img_wrapper"},ee=["href"],te=["src"],le={key:0,class:"handle_cross"},se=["href","onClick"],ae={key:1},ne={key:1,class:"item"},ie={class:"flex flex-row gap-4 items-center"},re={class:""},oe=["onClick"],de={key:2,class:"item"},ce={key:2,class:"text"};function ue(e,t,l,a,i,r){const o=(0,s.up)("AppTablePreloader"),d=(0,s.up)("grid-bottom");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",K,[a.isDataLoading?((0,s.wg)(),(0,s.j4)(o,{key:0,titles:a.titlesForPreloader},null,8,["titles"])):((0,s.wg)(),(0,s.iD)("table",V,[(0,s._)("thead",null,[(0,s._)("tr",N,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.products.titles,(e=>((0,s.wg)(),(0,s.iD)("th",{class:(0,n.C_)(["bar_item item",{cursor_pointer:e.sortable}]),style:(0,n.j5)({width:(a.collsCount>=8?100:a.collsCount>3?90:80)/a.collsCount*e.width+"%"}),onClick:t=>e.sortable?a.sort(e.value):null,key:e,colspan:e.isGroup?2:1},[(0,s._)("div",G,[(0,s._)("label",null,(0,n.zw)(e.name),1),e.sortable&&e.isOrder?((0,s.wg)(),(0,s.iD)("button",{key:0,class:(0,n.C_)(["bar_item_icon",{bar_item_icon_up:"desc"==a.sorting.order&&e.value.split(/_(.*)/s)[1]===a.sorting.order_by,bar_item_icon_down:"asc"==a.sorting.order&&e.value.split(/_(.*)/s)[1]===a.sorting.order_by}])},null,2)):(0,s.kq)("",!0)])],14,W)))),128))])]),a.products.list.length?((0,s.wg)(),(0,s.iD)("tbody",U,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.products.list,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t,class:"row"},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.products.titles,(l=>((0,s.wg)(),(0,s.iD)(s.HY,{key:l},["order_name"===l.value?((0,s.wg)(),(0,s.iD)("td",Q,[(0,s._)("div",X,[(0,s._)("div",J,[(0,s._)("a",{href:4!==t.fieldsForRender.statusType&&t.lead_id?"https://"+a.accountSubdomain+".amocrm.ru/leads/detail/"+t.lead_id:null,target:"_blank"},[(0,s._)("img",{src:t.fieldsForRender.img,class:"img"},null,8,te)],8,ee),4===t.fieldsForRender.statusType?((0,s.wg)(),(0,s.iD)("div",le)):(0,s.kq)("",!0)]),4!==t.fieldsForRender.statusType?((0,s.wg)(),(0,s.iD)("a",{key:0,target:"_blank",class:"underline text-[#8cb4ff] decoration-[#3f3f3faf] underline-offset-2 hover:no-underline cursor-pointer",href:t.lead_id?"https://"+a.accountSubdomain+".amocrm.ru/leads/detail/"+t.lead_id:null,onClick:e=>t.lead_id?null:a.routeToOrder(t.id)},(0,n.zw)((t.fieldsForRender?.[l.value]||"")+(t.lead_id?` (${t.lead_id})`:"")),9,se)):((0,s.wg)(),(0,s.iD)("span",ae,(0,n.zw)((t.fieldsForRender?.[l.value]||"")+` (${t.lead_id||""})`),1))])])):"status"===l.code&&2===t.fieldsForRender.statusType?((0,s.wg)(),(0,s.iD)("td",ne,[(0,s._)("div",ie,[(0,s._)("span",re,(0,n.zw)(t.fieldsForRender?.[l.value]),1),(0,s._)("button",{class:"btn small_btn order-1 max-h-[34px] pointer-events-auto relative inline-flex whitespace-nowrap w-fit rounded-md bg-white text-[0.8125rem] font-normal leading-5 text-slate-700 shadow-sm ring-1 ring-slate-700/10 hover:bg-slate-50 hover:text-slate-900 hover:disabled:bg-white disabled:opacity-30 disabled:cursor-not-allowed",onClick:e=>a.refundOrder(t.id)},(0,n.zw)(e.$t("orders.woz")),9,oe)])])):((0,s.wg)(),(0,s.iD)("td",de,(0,n.zw)(t.fieldsForRender?.[l.value]),1))],64)))),128))])))),128))])):(0,s.kq)("",!0)],512)),0==a.products.length?((0,s.wg)(),(0,s.iD)("label",ce,(0,n.zw)(e.$t("global.nothingFound")),1)):(0,s.kq)("",!0)]),!a.isDataLoading&&a.products.list.length?((0,s.wg)(),(0,s.j4)(d,{key:0,page:a.page,show:0!=a.products.list.length,showSelector:!1,count:a.meta?.per_page,onChangePage:a.changePage},null,8,["page","show","count","onChangePage"])):(0,s.kq)("",!0)],64)}var pe=l(6515),me=l(3704),fe=l(678),ge=l(2532),_e=l(4547),ve={name:"Main_grid",components:{GridBottom:pe.Z,AppTablePreloader:_e.Z},setup(){const e=(0,fe.tv)(),t=(0,M.iH)(10),l=(0,M.qj)({order_by:null,order:""}),a=(0,M.qj)({titles:[],list:(0,s.Fl)((()=>o.value))});(0,s.bv)((()=>{n()}));const n=async()=>{await Promise.all([w(),B.Z.dispatch("get_account"),g()])},i=(0,s.Fl)((()=>a.titles.length)),r=(0,s.Fl)((()=>B.Z.state.orders.meta)),o=(0,s.Fl)((()=>B.Z.state.orders.orders)),d=(0,s.Fl)((()=>B.Z.state.account.account.subdomain)),c=(0,s.Fl)((()=>B.Z.state.orders.filters)),u=(0,s.Fl)((()=>{const e={first:p(r.value?.links?.first||r.value?.first_page_url),prev:p(r.value?.links?.prev||r.value?.prev_page_url),current:r.value?.meta?.current_page||r.value?.current_page,next:p(r.value?.links?.next||r.value?.next_page_url),last:p(r.value?.links?.last||r.value?.last_page_url)};return e})),p=e=>e?e.split("?page=")[1]:null,m=e=>{const t={page:e};B.Z.commit("updateOrdersFilters",t),g()},{pipelines:f}=(0,ge.p)(),g=async()=>{const e={};-1!==f.selected.id&&(e.pipeline_id=f.selected.id),await B.Z.dispatch("getOrders",{...e,...c.value})},_=e=>{l.order_by!=e.split(/_(.*)/s)[1]&&(l.order="",l.order_by=e.split(/_(.*)/s)[1]),"desc"!==l.order&&l.order?"asc"===l.order&&(l.order="desc"):l.order="asc",B.Z.commit("updateOrdersFilters",l),g()},v=e=>{B.Z.commit("updateOrdersFilters",e),g()},w=async()=>{await B.Z.dispatch("getOrdersTableConfig",{for:"table"}),a.titles=(0,s.Fl)((()=>B.Z.getters.sortedFilteredTableConfig))},h=t=>{e.push("addToDeal?order_id="+t)},b=async e=>{await B.Z.dispatch("refundOrder",{order_id:e}),g()},y=(0,s.Fl)((()=>B.Z.state.orders.isLoading)),x=(0,s.Fl)((()=>a.titles.reduce(((e,t)=>(t.visible&&e.push(t.name),e)),[])));return{maxCount:t,sorting:l,products:a,collsCount:i,meta:r,orders:o,accountSubdomain:d,isTest2:me.h,page:u,changePage:m,getOrders:g,sort:_,emitParams:v,routeToOrder:h,refundOrder:b,updateList:n,isDataLoading:y,titlesForPreloader:x}}};const we=(0,H.Z)(ve,[["render",ue],["__scopeId","data-v-4be075ff"]]);var he=we;const be={class:"w-full flex flex-row gap-2"},ye={class:"h10 flex flex-row items-baseline p-2 px-4 gap-2"},xe={class:"font-semibold text-lg"},ke={class:"text-slate-700"},Fe=["onDragstart"],Ce={class:"absolute top-0 left-0 w-full bg-transparent flex justify-center items-center handle"},De={key:0,class:"material-icons-outlined cursor-move text-slate-500"},Te={class:"card-header flex flex-row justify-between"},Se=["onClick"],Ze={class:"font-medium"},qe={class:"text-end text-xs"},Oe={class:"card-wrapper flex flex-col gap-0.5 leading-5 text-sm"},Pe={class:"text-base mb-0.5"},ze={class:"text-base mb-0.5"},Le={class:"text-base mb-0.5"},je={class:"text-base mb-0.5"},Ie={class:"card-futter flex flex-row justify-between items-center"},Ae={class:"img_wrapper"},Re=["src"];function Be(e,t,a,i,r,o){const d=(0,s.up)("draggable");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["w-fit mt-12 pb-2 md:mt-20 md:pb-10 mx-auto text-left overflow-x-scroll max-w-[95vw] limit_height",{blur:i.isDataLoading}])},[(0,s._)("div",be,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.pipelines.selected.statuses,(r=>((0,s.wg)(),(0,s.iD)(s.HY,{key:r.id},[3===r.type||a.hideFinalSteps&&(2===r.type||1==r.type)?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",{key:0,class:"flex flex-col shrink-0 w-80 rounded-md h-fit bg-slate-900/10",style:(0,n.j5)({"background-color":1===r.type?"rgba(68, 255, 0, 0.19)":2===r.type?"rgba(255, 13, 0, 0.19)":3===r.type?"rgba(68, 68, 68, 0.19)":"rgba(255, 170, 0, 0.19)"})},[(0,s._)("div",ye,[(0,s._)("h2",xe,(0,n.zw)(r.name),1),(0,s._)("small",ke," ("+(0,n.zw)(e.$t("orders.sd"))+" "+(0,n.zw)(r?.res?.meta?.total)+" | "+(0,n.zw)(i.formatNumber(r?.res?.meta?.sum))+" ₽) ",1)]),r.res?((0,s.wg)(),(0,s.j4)(d,{key:0,class:"flex flex-col gap-2 h-full p-2 pt-0 overflow-y-scroll max-h-[87vh] min-h-[20px]",list:r.res.data,group:"people",handle:e.isMobile?".handle":null,"item-key":e.id,ref_for:!0,ref:e=>r.ref=e},{item:(0,s.w5)((({element:a,index:o})=>[(0,s._)("div",{class:(0,n.C_)(["p-2 rounded-md bg-white flex flex-col gap-1 relative",{collapse:o>r.lastVisibleElIdx+5||o<r.lastVisibleElIdx-10,"cursor-move":!e.isMobile,"pt-5":e.isMobile}]),ref_for:!0,ref:e=>a.visible.ref=e,onDragend:t[0]||(t[0]=()=>i.move()),onDragstart:()=>i.saveDragEl(a)},[(0,s._)("div",Ce,[e.isMobile?((0,s.wg)(),(0,s.iD)("span",De," drag_handle ")):(0,s.kq)("",!0)]),(0,s._)("div",Te,[(0,s._)("a",{target:"_self",class:"underline text-[#8cb4ff] decoration-[#3f3f3faf] underline-offset-2 hover:no-underline cursor-pointer",onClick:e=>i.routeToOrder(a.id)},[(0,s._)("h4",Ze,(0,n.zw)(a.fieldsForRender.order_name),1)],8,Se),(0,s._)("span",qe,(0,n.zw)(a.fieldsForRender.order_created_at),1)]),(0,s._)("div",Oe,[(0,s._)("span",Pe,(0,n.zw)(a.fieldsForRender.order_responsible),1),(0,s._)("span",ze,(0,n.zw)(a.fieldsForRender.contact_name),1),(0,s._)("span",Le,(0,n.zw)(a.fieldsForRender.company_name),1),(0,s._)("span",je,(0,n.zw)(a.fieldsForRender.order_user),1),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.castomFields,(e=>((0,s.wg)(),(0,s.iD)("span",{key:e},(0,n.zw)(a.fieldsForRender?.[e]),1)))),128))]),(0,s._)("div",Ie,[(0,s._)("span",null,(0,n.zw)(i.formatNumber(a.sum||a.budget||0))+" ₽ ",1),(0,s._)("div",Ae,[(0,s._)("img",{src:a.lead_id?"https://www.digiseller.ru/preview/571523/p1_3380359_3410fdc6.png":l(4399),class:"img"},null,8,Re),(0,s.kq)("",!0)])])],42,Fe)])),_:2},1032,["list","handle","item-key"])):(0,s.kq)("",!0)],4))],64)))),128))])],2)}var Me=l(6983),$e=l.n(Me),He=l(1738),Ee=l(6367),Ye=l(6413),Ke=l(1120),Ve=l(5970),Ne=l(277),We={components:{draggable:$e()},props:{hideFinalSteps:Boolean},setup(){const{getRandomColor3:e}=(0,He.r)(),{pipelines:t,startPromise:l}=(0,ge.p)(),{formatNumber:a}=(0,Ve._)(),n=(0,s.Fl)((()=>B.Z.state.orders.filters)),i=(0,s.Fl)((()=>B.Z.state.orders.orders)),r=async()=>{f(!0),await l;const e=[];t.selected.statuses.forEach((t=>{e.push(o(t))})),await Promise.all(e),f(!1)},o=async e=>{const t=await B.Z.dispatch("getOrders",{...n.value,dontSaveMeta:!0,hide_final_statuses:!1,status_id:e.id});e.res=t,e.ref=null,e.res.data.map((e=>e.visible={ref:null,value:null})),e.lastVisibleElIdx=(0,s.Fl)((()=>{const t=e.res.data.toReversed(),l=t.find((e=>e.visible.value)),s=e.res.data.indexOf(l);return s})),e.needDownloadNext=(0,s.Fl)((()=>e.res.data.length<e.lastVisibleElIdx+5&&e.res.total>e.res.data.length))},d=async e=>{if(e.isLoading=!0,e.res.next_page_url){const t=await B.Z.dispatch("getOrders",{...n.value,dontSaveMeta:!0,status_id:e.id,page:e.res.current_page+1}),l=e.res.data;e.res=t,e.res.data.map((e=>e.visible={ref:null,value:null})),e.res.data=[...l,...e.res.data]}e.isLoading=!1};(0,s.bv)((async()=>{await B.Z.dispatch("getOrdersTableConfig",{for:"pipeline"}),c()}));const c=async()=>{await r(),(0,s.Y3)((()=>{u(),p()}))},u=()=>{t.selected.statuses.map((t=>t.bgColor=(0,s.Fl)((()=>e("30")))))},p=()=>{t.selected.statuses.forEach((e=>e.res?.data?.forEach((t=>{null===t.visible.value&&(t.visible.value=(0,Ee.CDf)(t.visible.ref,{scrollTarget:e.ref}))}))))};(0,Ye.H)((()=>t.selected.statuses),(()=>{t.selected.statuses.forEach((async e=>{e.needDownloadNext&&!e.isLoading&&(await d(e),(0,s.Y3)((()=>p())))}))}),{deep:!0,throttle:500});const[m,f]=(0,Ye.OT)(!1),g=(0,s.Fl)((()=>B.Z.state.orders.isLoading||m.value)),_=(0,M.iH)(null),v=(0,M.iH)(null),w=e=>{const l=t.selected.statuses.find((t=>t.res.data.includes(e)));l&&(v.value=l),_.value=e},h=()=>{const e=t.selected.statuses.find((e=>e.res.data.includes(_.value)));e&&_.value&&B.Z.dispatch("updateOrderStatus",{order_id:_.value.id,status_id:e.id}),t.selected.statuses.forEach((e=>{e.res.data.map((e=>e.visible.value=null))})),(0,s.Y3)((()=>p())),_.value=null},b=(0,s.Fl)((()=>B.Z.state.account.account?.config?.kanBanConfig)),y=e=>{Ke.Z.push("addToDeal?order_id="+e)},x=e=>{B.Z.commit("updateOrdersFilters",e),c()};return{isDataLoading:g,updateList:c,params:n,orders:i,pipelines:t,move:h,saveDragEl:w,castomFields:b,routeToOrder:y,emitParams:x,formatNumber:a,...(0,Ne.Z)()}}};const Ge=(0,H.Z)(We,[["render",Be],["__scopeId","data-v-1123cf1e"]]);var Ue=Ge,Qe=l(9211);function Xe(e,t,l,a,n,i){const r=(0,s.up)("AppInputSelect");return(0,s.wg)(),(0,s.j4)(r,{list:l.needAll?a.pipelines.listWithAll:a.pipelines.list,selected:a.pipelines.selected,SelectedInTitle:!0,onSelect:t[0]||(t[0]=e=>a.pipelines.select(e))},null,8,["list","selected"])}var Je={components:{AppInputSelect:R.Z},props:{needAll:{type:Boolean,req:!1}},setup(e){const{pipelines:t}=(0,ge.p)(!0);return(0,s.YP)(e.needAll,(e=>{-1!==t.selected.value||e||(t.selected={},t.dropToDefault())})),{pipelines:t}}};const et=(0,H.Z)(Je,[["render",Xe]]);var tt=et,lt=l(7614),st=l(7449),at=l(8216),nt=l(7165),it=l(2489),rt=l(7048),ot={components:{AppHeader:k.Z,OrdersFilters:Y,OrdersGrid:he,KanbanBoard:Ue,AppSearchWithFilters:Qe.Z,OrdersKanbanPipelineSelect:tt},setup(){const{t:e}=(0,it.j)();(0,nt.L)();const{currentSetSettingsInFolder:t}=(0,at.h)("orders"),{saveAllQueryParams:l,saveLSParam:a,getSavedLSParam:n}=(0,st.t)();l();const{formatNumber:i}=(0,Ve._)(),{OrderViewKey:r}=(0,rt.X)(),o=()=>Ke.Z.push({name:"addToDeal",params:{pipelineId:-1===g.selected.id?null:g.selected.id,isNew:!0}}),d=(0,M.iH)(null),c=e=>d.value.emitParams(e),u=(0,M.qj)({selected:{},list:[{name:"grid",component:"OrdersGrid",default:!0,icon:"format_list_bulleted"},{name:"kanban",component:"KanbanBoard",icon:"view_kanban"}],select:function(e){this.selected=e,a("ordersDT",this.selected.name)},nextItem:(0,s.Fl)((()=>{const e=u.list.find((e=>e==u.selected));if(!e)return;let t=u.list.indexOf(e)+1;t==u.list.length&&(t=0);const l=u.list[t];return l})),selectNext:function(){this.select(this.nextItem)},dropToDefault:function(){const e=this.list.find((e=>e.default));e&&this.select(e)},dropToSaved:function(){const e=n("ordersDT"),t=this.list.find((t=>t.name===e));t?this.select(t):this.dropToDefault()}});u.dropToSaved();const{isLocked:p,lockBtn:m}=(0,lt.M)(),f=()=>{m("timer",2250),d.value?.updateList()},{pipelines:g}=(0,ge.p)();(0,s.YP)((()=>g.selected.id),((e,t)=>void 0===t||f()));const _=()=>B.Z.commit("open_table_settings"),[v]=(0,Ye.OT)(n("hide_final_statuses")||!1);(0,s.YP)(v,(()=>w()));const w=()=>{B.Z.commit("updateOrdersFilters",{hide_final_statuses:v.value}),a("hide_final_statuses",v.value),"kanban"!==u.selected.name&&d.value?.updateList()};return w(),{addToDeal:o,isTest2:me.h,grid:d,emitParams:c,displayType:u,updateList:f,isLocked:p,openTableSettings:_,hideFinalSteps:v,currentSetSettingsInFolder:t,formatNumber:i,OrderViewKey:r,t:e}}};const dt=(0,H.Z)(ot,[["render",x],["__scopeId","data-v-5f099650"]]);var ct=dt}}]);
//# sourceMappingURL=974.a3fe67b1.js.map